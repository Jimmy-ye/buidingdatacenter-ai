# è´¦å·æƒé™ç®¡ç†æ’ä»¶å®æ–½æ€»ç»“

> **å®æ–½æ—¥æœŸ**: 2026-01-26 ~ 2026-01-27
> **åˆ†æ”¯**: `feature/admin-management-plugin`
> **åŠŸèƒ½ç±»å‹**: åå°ç®¡ç†ç³»ç»Ÿ
> **çŠ¶æ€**: âœ… MVP ç‰ˆæœ¬å·²å®Œæˆ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä¸º BDC-AI ç³»ç»Ÿå¼€å‘äº†ä¸€å¥—å®Œæ•´çš„**è´¦å·æƒé™ç®¡ç†æ’ä»¶**ï¼Œæä¾›åŸºäº Web çš„åå°ç®¡ç†ç•Œé¢ï¼Œå®ç°ç”¨æˆ·ã€è§’è‰²ã€æƒé™çš„ç»Ÿä¸€ç®¡ç†å’Œå®¡è®¡æ—¥å¿—åŠŸèƒ½ã€‚

### æ ¸å¿ƒç›®æ ‡

1. **RBAC æƒé™æ¨¡å‹** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
2. **Web ç®¡ç†ç•Œé¢** - å‹å¥½çš„å¯è§†åŒ–æ“ä½œç•Œé¢
3. **å®¡è®¡æ—¥å¿—** - å®Œæ•´çš„æ“ä½œè®°å½•è¿½è¸ª
4. **å®‰å…¨è®¤è¯** - JWT ä»¤ç‰Œæœºåˆ¶
5. **è°ƒè¯•æ”¯æŒ** - è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—å’Œé”™è¯¯å¤„ç†

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| **å‰ç«¯æ¡†æ¶** | NiceGUI | Python Web UI æ¡†æ¶ |
| **åç«¯æ¡†æ¶** | FastAPI | é«˜æ€§èƒ½ Python Web æ¡†æ¶ |
| **æ•°æ®åº“ ORM** | SQLAlchemy | Python SQL å·¥å…·åŒ… |
| **æ•°æ®åº“** | PostgreSQL | å…³ç³»å‹æ•°æ®åº“ |
| **è®¤è¯æ–¹å¼** | JWT | Access Token + Refresh Token |

### ç«¯å£é…ç½®

| æœåŠ¡ | åœ°å€ | ç”¨é€” |
|------|------|------|
| **åç«¯ API** | `http://localhost:8000` | RESTful API æœåŠ¡ |
| **ç®¡ç†ç•Œé¢** | `http://localhost:8082` | Web ç®¡ç†ç•Œé¢ |
| **ç§»åŠ¨ç«¯ Web** | `http://localhost:8080-8081` | ç§»åŠ¨ç«¯ï¼ˆç‹¬ç«‹ï¼‰ |

**è®¾è®¡å†³ç­–**: ç®¡ç†ç•Œé¢ä½¿ç”¨ 8082 ç«¯å£ï¼Œé¿å…ä¸ç§»åŠ¨ç«¯ Web æœåŠ¡å†²çªã€‚

---

## ğŸ¯ åŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·ç®¡ç†

**æ–‡ä»¶**: `services/backend/app/admin/pages/users.py`

#### åŠŸèƒ½åˆ—è¡¨
- âœ… ç”¨æˆ·åˆ—è¡¨å±•ç¤ºï¼ˆåˆ†é¡µï¼š20/50/100 æ¯é¡µï¼‰
- âœ… åˆ›å»ºæ–°ç”¨æˆ·
- âœ… ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
- âœ… åˆ†é…è§’è‰²åˆ°ç”¨æˆ·
- âœ… å¯ç”¨/ç¦ç”¨ç”¨æˆ·è´¦å·
- âœ… åˆ é™¤ç”¨æˆ·
- âœ… æœç´¢å’Œç­›é€‰

#### æ•°æ®å­—æ®µ
```python
{
    "id": "uuid",
    "username": "ç”¨æˆ·å",           # ç™»å½•è´¦å·
    "full_name": "å§“å",            # çœŸå®å§“å
    "email": "é‚®ç®±",
    "phone": "ç”µè¯",
    "is_active": "æ˜¯å¦æ¿€æ´»",        # å¸ƒå°”å€¼
    "is_superuser": "æ˜¯å¦è¶…çº§ç”¨æˆ·", # å¸ƒå°”å€¼
    "roles": ["è§’è‰²1", "è§’è‰²2"],     # å…³è”è§’è‰²åˆ—è¡¨
    "created_at": "åˆ›å»ºæ—¶é—´",
    "last_login_at": "æœ€åç™»å½•æ—¶é—´"
}
```

#### API ç«¯ç‚¹
- `GET /api/v1/auth/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/v1/auth/users` - åˆ›å»ºç”¨æˆ·
- `PUT /api/v1/auth/users/{id}` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/v1/auth/users/{id}` - åˆ é™¤ç”¨æˆ·

---

### 2. è§’è‰²ç®¡ç†

**æ–‡ä»¶**: `services/backend/app/admin/pages/roles.py`

#### åŠŸèƒ½åˆ—è¡¨
- âœ… è§’è‰²åˆ—è¡¨å±•ç¤º
- âœ… åˆ›å»ºæ–°è§’è‰²
- âœ… ç¼–è¾‘è§’è‰²ä¿¡æ¯
- âœ… åˆ†é…æƒé™åˆ°è§’è‰²
- âœ… è®¾ç½®è§’è‰²çº§åˆ«
- âœ… åˆ é™¤è§’è‰²

#### æ•°æ®å­—æ®µ
```python
{
    "id": "uuid",
    "name": "superadmin",           # è§’è‰²ä»£ç ï¼ˆå†…éƒ¨æ ‡è¯†ï¼‰
    "display_name": "è¶…çº§ç®¡ç†å‘˜",    # æ˜¾ç¤ºåç§°
    "description": "è§’è‰²æè¿°",
    "level": 999,                    # è§’è‰²çº§åˆ«ï¼ˆæ•°å­—è¶Šå¤§æƒé™è¶Šé«˜ï¼‰
    "permissions": ["permission1"],  # æƒé™åˆ—è¡¨ï¼ˆè¯¦æƒ…æ¥å£è¿”å›ï¼‰
    "created_at": "åˆ›å»ºæ—¶é—´"
}
```

#### é¢„è®¾è§’è‰²
| è§’è‰²ä»£ç  | æ˜¾ç¤ºåç§° | çº§åˆ« | è¯´æ˜ |
|---------|---------|------|------|
| `superuser` | è¶…çº§ç®¡ç†å‘˜ | 999 | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| `admin` | ç®¡ç†å‘˜ | 100 | ç³»ç»Ÿç®¡ç†æƒé™ |
| `project_manager` | é¡¹ç›®ç»ç† | 60 | é¡¹ç›®ç®¡ç†æƒé™ |
| `engineer` | å·¥ç¨‹å¸ˆ | 40 | åŸºç¡€æ“ä½œæƒé™ |
| `viewer` | æŸ¥çœ‹è€… | 20 | åªè¯»æƒé™ |

#### API ç«¯ç‚¹
- `GET /api/v1/auth/roles` - è·å–è§’è‰²åˆ—è¡¨
- `GET /api/v1/auth/roles/{id}` - è·å–è§’è‰²è¯¦æƒ…
- `POST /api/v1/auth/roles` - åˆ›å»ºè§’è‰²
- `PUT /api/v1/auth/roles/{id}` - æ›´æ–°è§’è‰²
- `DELETE /api/v1/auth/roles/{id}` - åˆ é™¤è§’è‰²

---

### 3. æƒé™ç®¡ç†

**æ–‡ä»¶**: `services/backend/app/admin/pages/permissions.py`

#### åŠŸèƒ½åˆ—è¡¨
- âœ… æƒé™åˆ—è¡¨æŸ¥çœ‹ï¼ˆåªè¯»ï¼‰
- âœ… æƒé™åˆ†å±‚å±•ç¤º
- âœ… æŸ¥çœ‹æƒé™å…³è”çš„è§’è‰²
- âœ… æƒé™åˆ†ç±»å±•ç¤º

#### æƒé™åˆ†ç±»

**é¡¹ç›®ç›¸å…³** (`projects:*`)
- `projects:create` - åˆ›å»ºé¡¹ç›®
- `projects:read` - æŸ¥çœ‹é¡¹ç›®
- `projects:update` - æ›´æ–°é¡¹ç›®
- `projects:delete` - åˆ é™¤é¡¹ç›®

**èµ„äº§ç›¸å…³** (`assets:*`)
- `assets:create` - åˆ›å»ºèµ„äº§
- `assets:read` - æŸ¥çœ‹èµ„äº§
- `assets:update` - æ›´æ–°èµ„äº§
- `assets:delete` - åˆ é™¤èµ„äº§

**ç»“æ„ç›¸å…³** (`structures:*`)
- `structures:create` - åˆ›å»ºç»“æ„
- `structures:read` - æŸ¥çœ‹ç»“æ„
- `structures:update` - æ›´æ–°ç»“æ„
- `structures:delete` - åˆ é™¤ç»“æ„

**ç³»ç»Ÿç›¸å…³** (`system:*`)
- `system:config` - ç³»ç»Ÿé…ç½®
- `system:monitor` - ç³»ç»Ÿç›‘æ§

**ç”¨æˆ·ç›¸å…³** (`users:*`)
- `users:create` - åˆ›å»ºç”¨æˆ·
- `users:read` - æŸ¥çœ‹ç”¨æˆ·
- `users:update` - æ›´æ–°ç”¨æˆ·
- `users:delete` - åˆ é™¤ç”¨æˆ·

**å®¡è®¡ç›¸å…³** (`audit:*`)
- `audit:read` - æŸ¥çœ‹å®¡è®¡æ—¥å¿—

**æ€»è®¡**: 33 ä¸ªæƒé™ç‚¹

#### API ç«¯ç‚¹
- `GET /api/v1/auth/permissions` - è·å–æƒé™åˆ—è¡¨

---

### 4. å®¡è®¡æ—¥å¿—

**æ–‡ä»¶**: `services/backend/app/admin/pages/audit.py`

#### åŠŸèƒ½åˆ—è¡¨
- âœ… æŸ¥çœ‹æ‰€æœ‰æ“ä½œæ—¥å¿—
- âœ… æŒ‰æ—¶é—´å€’åºæ’åˆ—
- âœ… æ˜¾ç¤ºæ“ä½œè¯¦ç»†ä¿¡æ¯
- âœ… è®°å½• IP åœ°å€å’Œæ—¶é—´æˆ³
- âœ… åˆ†é¡µå±•ç¤º

#### æ—¥å¿—å†…å®¹
```python
{
    "id": "uuid",
    "user": {
        "id": "uuid",
        "username": "yerui",
        "full_name": "å¶ç‘"
    },
    "action": "create_user",          # æ“ä½œç±»å‹
    "entity_type": "user",            # æ“ä½œå®ä½“ç±»å‹
    "entity_id": "uuid",              # æ“ä½œå®ä½“ ID
    "details": "åˆ›å»ºç”¨æˆ·: test_user", # è¯¦ç»†ä¿¡æ¯
    "ip_address": "127.0.0.1",       # IP åœ°å€
    "user_agent": "Mozilla/...",     # ç”¨æˆ·ä»£ç†
    "created_at": "2026-01-27T10:30:00"
}
```

#### è®°å½•çš„æ“ä½œ
- âœ… ç”¨æˆ·ç™»å½•/ç™»å‡º
- âœ… åˆ›å»º/ä¿®æ”¹/åˆ é™¤ç”¨æˆ·
- âœ… åˆ›å»º/ä¿®æ”¹/åˆ é™¤è§’è‰²
- âœ… ä¿®æ”¹æƒé™åˆ†é…
- âœ… ä¿®æ”¹ç”¨æˆ·è§’è‰²

#### API ç«¯ç‚¹
- `GET /api/v1/auth/audit-logs` - è·å–å®¡è®¡æ—¥å¿—

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. API å®¢æˆ·ç«¯

**æ–‡ä»¶**: `services/backend/app/admin/services/api_client.py`

#### åŠŸèƒ½
- ç»Ÿä¸€çš„ HTTP è¯·æ±‚å°è£…
- è‡ªåŠ¨æ·»åŠ  JWT Token åˆ°è¯·æ±‚å¤´
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæç¤º
- è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º

#### è°ƒè¯•è¾“å‡º
```python
[API RESPONSE] URL: http://localhost:8000/api/v1/auth/users
[API RESPONSE] Status: 200
[API RESPONSE] Content-Type: application/json
[API SUCCESS] Data keys: ['data']
```

#### å…³é”®æ–¹æ³•
```python
class APIClient:
    def login(username, password) -> bool
    def logout() -> bool
    def get_current_user() -> dict
    def get_users(skip, limit) -> list
    def create_user(user_data) -> dict
    def update_user(user_id, user_data) -> dict
    def delete_user(user_id) -> bool
    def get_roles() -> list
    def create_role(role_data) -> dict
    def get_permissions() -> list
    def get_audit_logs(skip, limit) -> list
```

---

### 2. ä¸»åº”ç”¨å…¥å£

**æ–‡ä»¶**: `services/backend/app/admin/main.py`

#### é¡µé¢è·¯ç”±
- `/` - ç™»å½•é¡µé¢
- `/admin` - ç®¡ç†ä¸»é¡µï¼ˆéœ€è®¤è¯ï¼‰
- `/admin/users` - ç”¨æˆ·ç®¡ç†
- `/admin/roles` - è§’è‰²ç®¡ç†
- `/admin/permissions` - æƒé™æŸ¥çœ‹
- `/admin/audit` - å®¡è®¡æ—¥å¿—

#### ç•Œé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: BDC-AI è´¦å·ç®¡ç†    [ç™»å‡ºæŒ‰é’®]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚                               â”‚
â”‚ å¯¼èˆªèœå• â”‚       ä¸»å†…å®¹åŒº               â”‚
â”‚        â”‚                               â”‚
â”‚ ğŸ“‹ ç”¨æˆ·ç®¡ç†â”‚                               â”‚
â”‚ ğŸ‘¥ è§’è‰²ç®¡ç†â”‚     [ç»Ÿè®¡å¡ç‰‡]              â”‚
â”‚ ğŸ” æƒé™æŸ¥çœ‹â”‚     ç”¨æˆ·: 10                 â”‚
â”‚ ğŸ“ å®¡è®¡æ—¥å¿—â”‚     è§’è‰²: 5                  â”‚
â”‚        â”‚     æƒé™: 33                 â”‚
â”‚        â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” è®¤è¯ä¸å®‰å…¨

### JWT è®¤è¯æµç¨‹

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. åç«¯éªŒè¯ç”¨æˆ·åå¯†ç 
   â†“
3. è¿”å› access_token (15åˆ†é’Ÿ) + refresh_token (7å¤©)
   â†“
4. å‰ç«¯å­˜å‚¨ tokens
   â†“
5. æ¯æ¬¡è¯·æ±‚æºå¸¦ access_token
   â†“
6. Token è¿‡æœŸæ—¶ä½¿ç”¨ refresh_token åˆ·æ–°
   â†“
7. refresh_token ä¹Ÿè¿‡æœŸåˆ™é‡æ–°ç™»å½•
```

### å®‰å…¨ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å¯†ç å­˜å‚¨** | bcrypt å“ˆå¸Œï¼Œå•å‘åŠ å¯† |
| **Token è¿‡æœŸ** | Access Token 15åˆ†é’Ÿï¼ŒRefresh Token 7å¤© |
| **HTTPS æ”¯æŒ** | ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ HTTPS |
| **å®¡è®¡æ—¥å¿—** | è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œ |
| **æƒé™æ£€æŸ¥** | æ¯ä¸ªç«¯ç‚¹éƒ½æœ‰æƒé™éªŒè¯ |
| **SQL æ³¨å…¥é˜²æŠ¤** | ORM å‚æ•°åŒ–æŸ¥è¯¢ |

---

## ğŸ› é—®é¢˜ä¿®å¤è®°å½•

### ä¿®å¤ 1: JSON åºåˆ—åŒ–é”™è¯¯

**é—®é¢˜**: `TypeError: Type is not JSON serializable`

**åŸå› **: SQLAlchemy å¯¹è±¡åŒ…å«ï¼š
- å…³ç³»å±æ€§ï¼ˆrelationshipï¼‰æ— æ³•åºåˆ—åŒ–
- å»¶è¿ŸåŠ è½½å±æ€§å¯èƒ½å¯¼è‡´é”™è¯¯
- æ–¹æ³•ï¼ˆ`__repr__` ç­‰ï¼‰ä¸æ˜¯æ•°æ®

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ‰‹åŠ¨è½¬æ¢ä¸ºå­—å…¸ï¼Œç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½æ˜¯åŸºæœ¬ç±»å‹
def user_to_dict(user):
    return {
        "id": str(user.id),              # UUID â†’ str
        "username": user.username,
        "created_at": user.created_at.isoformat(),  # datetime â†’ str
        "is_active": bool(user.is_active), # æ˜¾å¼è½¬æ¢
    }
```

**å½±å“ç«¯ç‚¹**:
- âœ… `/api/v1/auth/me` - ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
- âœ… `/api/v1/auth/users` - ç”¨æˆ·åˆ—è¡¨ç«¯ç‚¹
- âœ… `/api/v1/auth/roles` - è§’è‰²åˆ—è¡¨ç«¯ç‚¹
- âœ… `/api/v1/auth/permissions` - æƒé™åˆ—è¡¨ç«¯ç‚¹
- âœ… `/api/v1/auth/audit-logs` - å®¡è®¡æ—¥å¿—ç«¯ç‚¹

---

### ä¿®å¤ 2: æ¨¡å—å¯¼å…¥é”™è¯¯

**é—®é¢˜**: `ModuleNotFoundError: No module named 'services.backend'`

**åŸå› **: Python è·¯å¾„é…ç½®é—®é¢˜ï¼Œæ— æ³•æ‰¾åˆ°é¡¹ç›®æ¨¡å—

**è§£å†³æ–¹æ¡ˆ**:
1. æ·»åŠ  `services/__init__.py`
2. æ·»åŠ  `services/backend/__init__.py`
3. åœ¨ `main.py` ä¸­è®¾ç½®é¡¹ç›®æ ¹ç›®å½•è·¯å¾„ï¼š
```python
PROJECT_ROOT = Path(__file__).resolve().parents[4]
sys.path.insert(0, str(PROJECT_ROOT))
```

---

### ä¿®å¤ 3: å‰ç«¯å­—æ®µæ˜ å°„é”™è¯¯

**é—®é¢˜**: è§’è‰²ç®¡ç†é¡µé¢æ˜¾ç¤ºé”™è¯¯ï¼Œè®¿é—®ä¸å­˜åœ¨çš„å­—æ®µ

**åŸå› **: å‰ç«¯æœŸæœ›çš„å­—æ®µåä¸åç«¯è¿”å›çš„ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
```python
# é”™è¯¯çš„è®¿é—®æ–¹å¼
role.get('code')  # åç«¯ä¸è¿”å›æ­¤å­—æ®µ

# æ­£ç¡®çš„è®¿é—®æ–¹å¼
role.get('name')          # è§’è‰²å†…éƒ¨æ ‡è¯†
role.get('display_name')  # è§’è‰²æ˜¾ç¤ºåç§°
```

---

### ä¿®å¤ 4: AdminApp å±æ€§é”™è¯¯

**é—®é¢˜**: `AttributeError: 'AdminApp' object has no attribute 'user_count_label'`

**åŸå› **: `load_statistics()` æ–¹æ³•åœ¨ `__init__` å®Œæˆå‰è¢«è°ƒç”¨

**è§£å†³æ–¹æ¡ˆ**:
```python
def __init__(self):
    # å…ˆåˆå§‹åŒ–æ‰€æœ‰æ ‡ç­¾å¼•ç”¨
    self.user_count_label = None
    self.role_count_label = None
    self.permission_count_label = None

def load_statistics(self):
    # æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²åˆå§‹åŒ–
    if not self.user_count_label:
        return
    # åŠ è½½æ•°æ®...
```

---

## ğŸ“– è°ƒè¯•æŒ‡å—

### åç«¯è°ƒè¯•

#### å¯åŠ¨åç«¯æœåŠ¡
```batch
cd D:\BDC-AI
venv\Scripts\python.exe -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload
```

#### æŸ¥çœ‹åç«¯æ—¥å¿—
åç«¯æœåŠ¡çª—å£ä¼šæ˜¾ç¤ºï¼š
```
[DEBUG] /me called for user: yerui
[DEBUG] Found 1 roles
[DEBUG] Superuser yerui, permissions count: 33
[DEBUG] Returning user_dict for yerui
```

#### å…¨å±€å¼‚å¸¸å¤„ç†
æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸éƒ½ä¼šæ˜¾ç¤ºå®Œæ•´å †æ ˆè·Ÿè¸ªï¼š
```
============================================================
[SERVER ERROR] TypeError: Type is not JSON serializable
[SERVER ERROR] Method: GET
[SERVER ERROR] URL: http://localhost:8000/api/v1/auth/users
[SERVER ERROR] Traceback:
  (å®Œæ•´çš„å †æ ˆè·Ÿè¸ª)
============================================================
```

---

### å‰ç«¯è°ƒè¯•

#### å¯åŠ¨ç®¡ç†ç•Œé¢
```batch
cd D:\BDC-AI
venv\Scripts\python.exe services\backend\app\admin\main.py
```

#### æŸ¥çœ‹å‰ç«¯æ—¥å¿—
ç®¡ç†ç•Œé¢çª—å£ä¼šæ˜¾ç¤ºï¼š
```
[FRONTEND] Loading users...
[API RESPONSE] URL: http://localhost:8000/api/v1/auth/users
[API RESPONSE] Status: 200
[API SUCCESS] Data keys: ['data']
[FRONTEND] Loaded 2 users
[FRONTEND] First user data: {'id': '...', 'username': 'yerui', ...}
```

#### å¸¸è§é”™è¯¯

**é”™è¯¯ 1: 500 Internal Server Error**
- **åŸå› **: NiceGUI æœåŠ¡å™¨ç«¯é”™è¯¯
- **è§£å†³**: æŸ¥çœ‹ç®¡ç†ç•Œé¢çª—å£çš„å®Œæ•´é”™è¯¯å †æ ˆ

**é”™è¯¯ 2: 401 Unauthorized**
- **åŸå› **: Token è¿‡æœŸæˆ–æ— æ•ˆ
- **è§£å†³**: é‡æ–°ç™»å½•è·å–æ–° Token

**é”™è¯¯ 3: KeyError / AttributeError**
- **åŸå› **: å‰ç«¯è®¿é—®äº†ä¸å­˜åœ¨çš„å­—æ®µ
- **è§£å†³**: æ£€æŸ¥åç«¯è¿”å›çš„å®é™…æ•°æ®ç»“æ„

---

### è°ƒè¯•æ­¥éª¤

#### 1. é‡å¯æœåŠ¡
```batch
# åœæ­¢å½“å‰æœåŠ¡ï¼ˆCtrl+Cï¼‰
# æ¸…é™¤ Python ç¼“å­˜
del /s /q "*.pyc"
# é‡æ–°å¯åŠ¨
venv\Scripts\python.exe services\backend\app\admin\main.py
```

#### 2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
æŒ‰ `Ctrl+Shift+R` å¼ºåˆ¶åˆ·æ–°é¡µé¢

#### 3. æŸ¥çœ‹å®Œæ•´é”™è¯¯è¾“å‡º
ç‚¹å‡»èœå•è§¦å‘é”™è¯¯åï¼Œ**ç«‹å³æŸ¥çœ‹**ï¼š
- ç®¡ç†ç•Œé¢çª—å£ï¼ˆå‰ç«¯é”™è¯¯ï¼‰
- åç«¯æœåŠ¡çª—å£ï¼ˆåç«¯é”™è¯¯ï¼‰

#### 4. æä¾›é”™è¯¯ä¿¡æ¯
æŠ¥å‘Šé—®é¢˜æ—¶è¯·æä¾›ï¼š
1. å®Œæ•´çš„å‰ç«¯è¾“å‡º
2. å®Œæ•´çš„åç«¯è¾“å‡º
3. å…·ä½“æ“ä½œæ­¥éª¤
4. æµè§ˆå™¨é”™è¯¯ï¼ˆå¦‚æœ‰ï¼‰

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### é¦–æ¬¡ä½¿ç”¨

#### 1. å¯åŠ¨æœåŠ¡

**ç»ˆç«¯ 1 - åç«¯æœåŠ¡**:
```batch
cd D:\Huawei Files\åä¸ºå®¶åº­å­˜å‚¨\Programs\program-bdc-ai
venv\Scripts\python.exe -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload
```

**ç»ˆç«¯ 2 - ç®¡ç†ç•Œé¢**:
```batch
cd D:\Huawei Files\åä¸ºå®¶åº­å­˜å‚¨\Programs\program-bdc-ai
venv\Scripts\python.exe services\backend\app\admin\main.py
```

#### 2. è®¿é—®ç®¡ç†ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:8082`

#### 3. ç™»å½•ç³»ç»Ÿ

**é»˜è®¤è´¦å·**:
- è¶…çº§ç”¨æˆ·: `yerui` / `ye123456`
- ç®¡ç†å‘˜: `admin` / `admin123`

### åŠŸèƒ½æ¼”ç¤ºæµç¨‹

#### åˆ›å»ºç”¨æˆ·æµç¨‹
1. ç‚¹å‡»å·¦ä¾§èœå• "ğŸ“‹ ç”¨æˆ·ç®¡ç†"
2. ç‚¹å‡» "åˆ›å»ºç”¨æˆ·" æŒ‰é’®
3. å¡«å†™ç”¨æˆ·ä¿¡æ¯ï¼š
   - ç”¨æˆ·å*: `test_user`
   - å¯†ç *: `password123`
   - å§“å: `æµ‹è¯•ç”¨æˆ·`
   - é‚®ç®±: `test@example.com`
   - è§’è‰²: `viewer`
4. ç‚¹å‡» "åˆ›å»º" æŒ‰é’®
5. æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨æ˜¯å¦æ–°å¢

#### åˆ›å»ºè§’è‰²æµç¨‹
1. ç‚¹å‡»å·¦ä¾§èœå• "ğŸ‘¥ è§’è‰²ç®¡ç†"
2. ç‚¹å‡» "åˆ›å»ºè§’è‰²" æŒ‰é’®
3. å¡«å†™è§’è‰²ä¿¡æ¯ï¼š
   - è§’è‰²ä»£ç *: `custom_role`
   - è§’è‰²åç§°*: `è‡ªå®šä¹‰è§’è‰²`
   - çº§åˆ«: `50`
   - æè¿°: `è‡ªå®šä¹‰æµ‹è¯•è§’è‰²`
   - æƒé™: `projects:read, assets:read`
4. ç‚¹å‡» "åˆ›å»º" æŒ‰é’®
5. æŸ¥çœ‹è§’è‰²åˆ—è¡¨æ˜¯å¦æ–°å¢

#### æŸ¥çœ‹å®¡è®¡æ—¥å¿—
1. ç‚¹å‡»å·¦ä¾§èœå• "ğŸ“ å®¡è®¡æ—¥å¿—"
2. æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½•
3. å¯ä»¥çœ‹åˆ°åˆšæ‰åˆ›å»ºç”¨æˆ·ã€è§’è‰²çš„è®°å½•

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### ç”¨æˆ· (User)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| username | String | ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ |
| password_hash | String | å¯†ç å“ˆå¸Œ |
| full_name | String | å§“å |
| email | String | é‚®ç®± |
| phone | String | ç”µè¯ |
| is_active | Boolean | æ˜¯å¦æ¿€æ´» |
| is_superuser | Boolean | æ˜¯å¦è¶…çº§ç”¨æˆ· |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |
| last_login_at | DateTime | æœ€åç™»å½•æ—¶é—´ |

### è§’è‰² (Role)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| name | String | è§’è‰²ä»£ç ï¼ˆå”¯ä¸€ï¼‰ |
| display_name | String | æ˜¾ç¤ºåç§° |
| description | String | æè¿° |
| level | Integer | çº§åˆ« |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |

### æƒé™ (Permission)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| code | String | æƒé™ä»£ç ï¼ˆå”¯ä¸€ï¼‰ |
| name | String | æƒé™åç§° |
| category | String | åˆ†ç±» |
| description | String | æè¿° |

### ç”¨æˆ·è§’è‰²å…³è” (UserRole)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| user_id | UUID | ç”¨æˆ· ID |
| role_id | UUID | è§’è‰² ID |

### è§’è‰²æƒé™å…³è” (RolePermission)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| role_id | UUID | è§’è‰² ID |
| permission_id | UUID | æƒé™ ID |

### å®¡è®¡æ—¥å¿— (AuditLog)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| user_id | UUID | æ“ä½œç”¨æˆ· ID |
| action | String | æ“ä½œç±»å‹ |
| entity_type | String | å®ä½“ç±»å‹ |
| entity_id | UUID | å®ä½“ ID |
| details | String | è¯¦ç»†ä¿¡æ¯ |
| ip_address | String | IP åœ°å€ |
| user_agent | String | ç”¨æˆ·ä»£ç† |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |

---

## ğŸ“ˆ åç»­è§„åˆ’

### çŸ­æœŸä¼˜åŒ–ï¼ˆP1ï¼‰
- [ ] æ·»åŠ æ‰¹é‡å¯¼å…¥ç”¨æˆ·åŠŸèƒ½
- [ ] æ·»åŠ è§’è‰²å¤åˆ¶åŠŸèƒ½
- [ ] ä¼˜åŒ–è¡¨æ ¼æ’åºå’Œç­›é€‰
- [ ] æ·»åŠ æ“ä½œç¡®è®¤å¯¹è¯æ¡†

### ä¸­æœŸæ‰©å±•ï¼ˆP2ï¼‰
- [ ] æ·»åŠ æ•°æ®å¤‡ä»½/æ¢å¤åŠŸèƒ½
- [ ] æ·»åŠ ç³»ç»Ÿç›‘æ§é¢æ¿
- [ ] æ·»åŠ æ“ä½œæ—¥å¿—å¯¼å‡º
- [ ] å®ç°æƒé™ç»„åŠŸèƒ½

### é•¿æœŸè®¡åˆ’ï¼ˆP3ï¼‰
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] è‡ªå®šä¹‰æƒé™æ¨¡æ¿
- [ ] é«˜çº§å®¡è®¡åŠŸèƒ½
- [ ] æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦

---

## ğŸ“ å¼€å‘æ—¥å¿—

ç›¸å…³æäº¤è®°å½•:
- `c9fa2b7` - feat: æ·»åŠ è´¦å·æƒé™ç®¡ç†æ’ä»¶ï¼ˆMVPç‰ˆæœ¬ï¼‰
- `38b01ba` - fix: ä¿®æ”¹ç®¡ç†ç•Œé¢ç«¯å£ä¸º8082ï¼Œé¿å…ä¸ç§»åŠ¨ç«¯å†²çª
- `20148f4` - fix: ä¿®å¤ç®¡ç†ç•Œé¢å¯åŠ¨é—®é¢˜
- `01b8429` - fix: ä¿®å¤æ‰€æœ‰é¡µé¢æ–‡ä»¶çš„å¯¼å…¥è·¯å¾„
- `5a16b36` - fix: ä¿®å¤è´¦å·ç®¡ç†æ’ä»¶å¯åŠ¨å’Œåºåˆ—åŒ–é—®é¢˜

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•ç®¡ç†ç•Œé¢
- [x] ç”¨æˆ·ç®¡ç†åŠŸèƒ½å®Œæ•´å¯ç”¨
- [x] è§’è‰²ç®¡ç†åŠŸèƒ½å®Œæ•´å¯ç”¨
- [x] æƒé™æŸ¥çœ‹åŠŸèƒ½æ­£å¸¸æ˜¾ç¤º
- [x] å®¡è®¡æ—¥å¿—æ­£ç¡®è®°å½•æ“ä½œ
- [x] API è¿”å›æ­£ç¡®çš„ JSON æ ¼å¼
- [x] å‰ç«¯é¡µé¢æ— åºåˆ—åŒ–é”™è¯¯
- [x] è°ƒè¯•æ—¥å¿—è¯¦ç»†ä¸”æœ‰ç”¨
- [x] é»˜è®¤è´¦å·å¯ä»¥æ­£å¸¸ä½¿ç”¨

---

## ğŸ¯ æ€»ç»“

è´¦å·æƒé™ç®¡ç†æ’ä»¶å·²æˆåŠŸå®ç° MVP ç‰ˆæœ¬ï¼Œæä¾›äº†ï¼š
- âœ… **å®Œæ•´çš„ç”¨æˆ·ç®¡ç†**
- âœ… **çµæ´»çš„è§’è‰²ç®¡ç†**
- âœ… **ç»†ç²’åº¦çš„æƒé™æ§åˆ¶**
- âœ… **å…¨é¢çš„å®¡è®¡æ—¥å¿—**
- âœ… **å‹å¥½çš„ Web ç•Œé¢**
- âœ… **è¯¦ç»†çš„è°ƒè¯•æ”¯æŒ**

è¯¥æ’ä»¶ä¸º BDC-AI ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„åå°ç®¡ç†èƒ½åŠ›ï¼Œé€‚åˆç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨ï¼
