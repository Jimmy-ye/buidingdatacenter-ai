# BDC-AI åç«¯æœåŠ¡å™¨éƒ¨ç½²ä¸ç¯å¢ƒé…ç½®å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²æ¦‚è¿°](#éƒ¨ç½²æ¦‚è¿°)
2. [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
3. [ç¯å¢ƒå®‰è£…](#ç¯å¢ƒå®‰è£…)
4. [é¡¹ç›®éƒ¨ç½²](#é¡¹ç›®éƒ¨ç½²)
5. [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
6. [API é…ç½®](#api-é…ç½®)
7. [æœåŠ¡å¯åŠ¨](#æœåŠ¡å¯åŠ¨)
8. [éªŒè¯æµ‹è¯•](#éªŒè¯æµ‹è¯•)
9. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
10. [è¿ç»´ç®¡ç†](#è¿ç»´ç®¡ç†)

---

## ğŸ¯ éƒ¨ç½²æ¦‚è¿°

### ç›®æ ‡è¯»è€…

- ç³»ç»Ÿç®¡ç†å‘˜
- DevOps å·¥ç¨‹å¸ˆ
- åç«¯å¼€å‘äººå‘˜

### éƒ¨ç½²æ¶æ„

```
æ–°æœåŠ¡å™¨ï¼ˆWindows/Linuxï¼‰
â”œâ”€â”€ Python 3.11+ ç¯å¢ƒ
â”œâ”€â”€ PostgreSQL 18 æ•°æ®åº“
â”œâ”€â”€ BDC-AI é¡¹ç›®
â”œâ”€â”€ FastAPI åç«¯æœåŠ¡ï¼ˆç«¯å£ 8000ï¼‰
â””â”€â”€ GLM Worker æœåŠ¡
```

### é¢„è®¡æ—¶é—´

- **å…¨æ–°éƒ¨ç½²**ï¼š2-3 å°æ—¶
- **å·²æœ‰ç¯å¢ƒ**ï¼š30-60 åˆ†é’Ÿ

---

## ğŸ”§ å‰ç½®å‡†å¤‡

### ç¡¬ä»¶è¦æ±‚

| é…ç½® | æœ€ä½é…ç½® | æ¨èé…ç½® | è¯´æ˜ |
|------|---------|---------|------|
| CPU | 4æ ¸ | 8æ ¸ | å¤„ç†å›¾ç‰‡åˆ†æä»»åŠ¡ |
| å†…å­˜ | 8GB | 16GB | PostgreSQL + FastAPI + Worker |
| å­˜å‚¨ | 100GB SSD | 500GB SSD | æ•°æ®åº“ + æ–‡ä»¶å­˜å‚¨ |
| ç½‘ç»œ | - | 100Mbps | ç§»åŠ¨ç«¯è®¿é—® |

### æ“ä½œç³»ç»Ÿæ”¯æŒ

- âœ… **Windows 10/11**ï¼ˆæ¨èï¼Œæ˜“äºç®¡ç†ï¼‰
- âœ… **Ubuntu 22.04 LTS**ï¼ˆæ¨èï¼Œç¨³å®šæ€§å¥½ï¼‰
- âœ… **Windows Server 2019+**
- âš ï¸ **macOS**ï¼ˆå¯ä»¥ï¼Œä½†æœªå……åˆ†æµ‹è¯•ï¼‰

### ç½‘ç»œè¦æ±‚

- å›ºå®š IP åœ°å€ï¼ˆæ¨èï¼‰æˆ– DDNS
- å¼€æ”¾ç«¯å£ï¼š8000ï¼ˆåç«¯ï¼‰ã€5432ï¼ˆæ•°æ®åº“ï¼Œä»…æœ¬åœ°ï¼‰
- é˜²ç«å¢™é…ç½®å…è®¸å…¥ç«™è¿æ¥

---

## ğŸ“¦ ç¯å¢ƒå®‰è£…

### Windows ç¯å¢ƒå®‰è£…

#### æ­¥éª¤ 1ï¼šå®‰è£… Python 3.11

**ä¸‹è½½åœ°å€**ï¼šhttps://www.python.org/downloads/

**å®‰è£…æ­¥éª¤**ï¼š

1. ä¸‹è½½ Windows installer (64-bit)
2. è¿è¡Œå®‰è£…ç¨‹åº
3. **é‡è¦**ï¼šå‹¾é€‰ "Add Python to PATH"
4. é€‰æ‹© "Install for all users"
5. ç‚¹å‡» "Install Now"

**éªŒè¯å®‰è£…**ï¼š

```powershell
# æ‰“å¼€ PowerShell æˆ– Command Prompt
python --version
# åº”è¯¥è¾“å‡ºï¼šPython 3.11.x æˆ–æ›´é«˜
```

#### æ­¥éª¤ 2ï¼šå®‰è£… PostgreSQL 18

**ä¸‹è½½åœ°å€**ï¼šhttps://www.postgresql.org/download/windows/

**å®‰è£…æ­¥éª¤**ï¼š

1. ä¸‹è½½ PostgreSQL 18 (64-bit)
2. è¿è¡Œå®‰è£…ç¨‹åº
3. é»˜è®¤ç«¯å£ï¼š`5432`
4. è®¾ç½®è¶…çº§ç”¨æˆ·å¯†ç ï¼ˆ**è¯·è®°ä½ï¼**ï¼‰
5. é€‰æ‹©ç»„ä»¶ï¼š
   - âœ… PostgreSQL Server
   - âœ… pgAdmin 4ï¼ˆå¯é€‰ï¼Œå›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼‰
   - âœ… Command Line Tools
6. è®¾ç½®ç¯å¢ƒå˜é‡
7. å®Œæˆå®‰è£…

**éªŒè¯å®‰è£…**ï¼š

```powershell
psql --version
# åº”è¯¥è¾“å‡ºï¼špsql (PostgreSQL) 18.x
```

#### æ­¥éª¤ 3ï¼šå®‰è£… Git

**ä¸‹è½½åœ°å€**ï¼šhttps://git-scm.com/download/win

**å®‰è£…æ­¥éª¤**ï¼š

1. ä¸‹è½½ Windows installer
2. ä½¿ç”¨é»˜è®¤é€‰é¡¹å®‰è£…
3. é€‰æ‹©é»˜è®¤ç¼–è¾‘å™¨ï¼ˆå¯é€‰ï¼‰

**éªŒè¯å®‰è£…**ï¼š

```powershell
git --version
# åº”è¯¥è¾“å‡ºï¼šgit version 2.x.x
```

#### æ­¥éª¤ 4ï¼šå®‰è£…ä»£ç ç¼–è¾‘å™¨ï¼ˆå¯é€‰ï¼‰

**æ¨è**ï¼šVisual Studio Code

**ä¸‹è½½åœ°å€**ï¼šhttps://code.visualstudio.com/

---

### Ubuntu/Linux ç¯å¢ƒå®‰è£…

#### æ­¥éª¤ 1ï¼šæ›´æ–°ç³»ç»Ÿ

```bash
sudo apt update
sudo apt upgrade -y
```

#### æ­¥éª¤ 2ï¼šå®‰è£… Python 3.11

```bash
# å®‰è£…ä¾èµ–
sudo apt install -y software-properties-common

# æ·»åŠ  deadsnakes PPA
sudo add-apt-repository ppa:deadsnakes/ppa -y

# å®‰è£… Python 3.11
sudo apt install -y python3.11 python3.11-venv python3.11-dev

# è®¾ç½®ä¸ºé»˜è®¤ python3
sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1

# éªŒè¯å®‰è£…
python3 --version
```

#### æ­¥éª¤ 3ï¼šå®‰è£… PostgreSQL 18

```bash
# æ·»åŠ  PostgreSQL å®˜æ–¹ä»“åº“
sudo apt install -y wget gnupg

# æ·»åŠ ä»“åº“å¯†é’¥
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

# æ·»åŠ ä»“åº“
echo "deb http://apt.postgresql.org/pub/repos/apt/ jammy-pgdg main" | sudo tee /etc/apt/sources.list.d/pgdg.list

# æ›´æ–°å¹¶å®‰è£…
sudo apt update
sudo apt install -y postgresql-18 postgresql-contrib-18

# å¯åŠ¨æœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# éªŒè¯å®‰è£…
sudo -u postgres psql --version
```

#### æ­¥éª¤ 4ï¼šå®‰è£… Git

```bash
sudo apt install -y git

# éªŒè¯å®‰è£…
git --version
```

#### æ­¥éª¤ 5ï¼šå®‰è£…å…¶ä»–ä¾èµ–

```bash
# å®‰è£… pip
sudo apt install -y python3-pip

# å®‰è£… venv
sudo apt install -y python3.11-venv

# å®‰è£…ç¼–è¯‘å·¥å…·ï¼ˆæŸäº› Python åŒ…éœ€è¦ï¼‰
sudo apt install -y build-essential libpq-dev
```

---

## ğŸš€ é¡¹ç›®éƒ¨ç½²

### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®

**åˆ›å»ºé¡¹ç›®ç›®å½•**ï¼ˆå¯é€‰ï¼‰ï¼š

```bash
# Windows
mkdir D:\BDC-AI
cd D:\BDC-AI

# Linux
mkdir -p /opt/bdc-ai
cd /opt/bdc-ai
```

**å…‹éš†ä»“åº“**ï¼š

```bash
git clone https://github.com/Jimmy-ye/buidingdatacenter-ai.git
cd buidingdatacenter-ai
```

**æŸ¥çœ‹é¡¹ç›®ç»“æ„**ï¼š

```bash
# Windows
dir

# Linux
ls -la
```

### æ­¥éª¤ 2ï¼šåˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ

**åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**ï¼š

```bash
# Windows
python -m venv venv

# Linux
python3 -m venv venv
```

**æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ**ï¼š

```bash
# Windows (Command Prompt)
venv\Scripts\activate

# Windows (PowerShell)
venv\Scripts\Activate.ps1

# Linux/Mac
source venv/bin/activate
```

**éªŒè¯æ¿€æ´»**ï¼ˆå‘½ä»¤è¡Œå‰ç¼€ä¼šæ˜¾ç¤º `(venv)`ï¼‰ï¼š

```bash
(venv) python --version
```

### æ­¥éª¤ 3ï¼šå®‰è£… Python ä¾èµ–

**å‡çº§ pip**ï¼š

```bash
pip install --upgrade pip
```

**å®‰è£…é¡¹ç›®ä¾èµ–**ï¼š

```bash
# å®‰è£…åç«¯ä¾èµ–
pip install -r services/backend/requirements.txt

# éªŒè¯å…³é”®ä¾èµ–
pip list | grep -E "fastapi|uvicorn|sqlalchemy|passlib|python-jose"
```

**é¢„æœŸè¾“å‡º**ï¼š

```
fastapi           0.104.1
uvicorn           0.24.0
sqlalchemy        2.0.23
passlib           1.7.4
python-jose       3.3.0
```

### æ­¥éª¤ 4ï¼šé…ç½®ç¯å¢ƒå˜é‡

**æ–¹å¼ Aï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰â­â­â­â­â­**

```bash
# è¿è¡Œé…ç½®è„šæœ¬
python scripts/setup_api_keys.py

# æŒ‰ç…§æç¤ºæ“ä½œï¼š
# 1. è‡ªåŠ¨ç”Ÿæˆ JWT å¯†é’¥
# 2. è¾“å…¥åç«¯ API KEY
# 3. è¾“å…¥ Worker API KEYï¼ˆå¯é€‰ï¼‰
# 4. ç¡®è®¤é…ç½®
```

**æ–¹å¼ Bï¼šæ‰‹åŠ¨é…ç½®**

1. **å¤åˆ¶é…ç½®æ¨¡æ¿**ï¼š

```bash
# Windows
copy .env.example .env

# Linux
cp .env.example .env
```

2. **ç¼–è¾‘ `.env` æ–‡ä»¶**ï¼š

```bash
# Windows
notepad .env

# Linux
nano .env
```

3. **æ›´æ–°é…ç½®**ï¼š

```bash
# ================= æ•°æ®åº“é…ç½® =================
BDC_DATABASE_URL=postgresql://postgres:your-password@localhost:5432/bdc_ai

# ================= JWT è®¤è¯ =================
# è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¯†é’¥ï¼š
python -c "import secrets; print(secrets.token_hex(32))"
BDC_JWT_SECRET_KEY=<ç”Ÿæˆçš„64å­—ç¬¦hex>

# ================= GLM API =================
GLM_API_KEY=<ä» https://open.bigmodel.cn/ è·å–>
GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
GLM_VISION_MODEL=glm-4v
```

4. **åˆ›å»º Worker é…ç½®**ï¼š

```bash
cd services/worker
cp .env.example .env
notepad .env  # Windows
nano .env     # Linux
```

æ›´æ–°ï¼š
```bash
BDC_BACKEND_BASE_URL=http://localhost:8000
GLM_API_KEY=<Workerçš„API KEYï¼ˆå»ºè®®ç‹¬ç«‹ï¼‰>
```

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### æ­¥éª¤ 1ï¼šåˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

**Windowsï¼ˆä½¿ç”¨ pgAdminï¼‰**ï¼š

1. æ‰“å¼€ pgAdmin 4
2. è¿æ¥åˆ°æœ¬åœ°æœåŠ¡å™¨
3. å³é”® "Databases" â†’ "Create" â†’ "Database"
4. åç§°ï¼š`bdc_ai`
5. ç‚¹å‡» "Save"

**Windowsï¼ˆä½¿ç”¨å‘½ä»¤è¡Œï¼‰**ï¼š

```powershell
# æ‰“å¼€ PostgreSQL å‘½ä»¤è¡Œå·¥å…·
# å¼€å§‹èœå• â†’ PostgreSQL 18 â†’ psql

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE bdc_ai;

# é€€å‡º
\q
```

**Linux**ï¼š

```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -u postgres psql

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE bdc_ai;

# åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER bdc_ai WITH PASSWORD 'your-password';
GRANT ALL PRIVILEGES ON DATABASE bdc_ai TO bdc_ai;

# é€€å‡º
\q
```

### æ­¥éª¤ 2ï¼šéªŒè¯æ•°æ®åº“è¿æ¥

```bash
# Windows
psql -U postgres -d bdc_ai

# Linux
sudo -u postgres psql -d bdc_ai
```

**æµ‹è¯•æŸ¥è¯¢**ï¼š

```sql
SELECT current_database(), current_user;
-- é¢„æœŸè¾“å‡ºï¼š
--  current_database | current_user
-- ------------------+--------------
--  bdc_ai            | postgres
```

### æ­¥éª¤ 3ï¼šåˆå§‹åŒ–æ•°æ®åº“è¡¨

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•

# è¿è¡Œåˆå§‹åŒ–è„šæœ¬
python scripts/init_auth_db.py

# æˆ–è€…ï¼šå¯åŠ¨åç«¯æœåŠ¡ï¼Œè‡ªåŠ¨åˆ›å»ºè¡¨
python -m uvicorn services.backend.app.main:app --host localhost --port 8000
```

**éªŒè¯è¡¨åˆ›å»º**ï¼š

```sql
\dt

-- é¢„æœŸè¾“å‡ºï¼š
--               List of relations
--  Schema |       Name        |   Type   |  Owner
# --------+-------------------+----------+----------
--  public | audit_logs        | table    | postgres
--  public | permissions       | table    | postgres
--  public | project_members   | table    | postgres
--  public | role_permissions  | table    | postgres
--  public | roles             | table    | postgres
--  public | user_roles        | table    | postgres
--  public | users             | table    | postgres
```

---

## ğŸ”‘ API é…ç½®

### æ­¥éª¤ 1ï¼šè·å– GLM API KEY

1. **è®¿é—®æ™ºè°± AI å¼€æ”¾å¹³å°**ï¼šhttps://open.bigmodel.cn/

2. **æ³¨å†Œ/ç™»å½•**
   - æ‰‹æœºå·æ³¨å†Œ
   - æˆ–å¾®ä¿¡æ‰«ç ç™»å½•

3. **åˆ›å»º API KEY**
   - å¯¼èˆªï¼šæ§åˆ¶å° â†’ API KEY
   - ç‚¹å‡»"åˆ›å»ºæ–°çš„ API KEY"
   - å»ºè®®åˆ›å»º 2 ä¸ªç‹¬ç«‹çš„ KEYï¼š
     - `BDC-AI-Backend`ï¼ˆåç«¯æœåŠ¡ï¼‰
     - `BDC-AI-Worker`ï¼ˆWorker æœåŠ¡ï¼‰

4. **å¤åˆ¶ API KEY**
   - ç‚¹å‡» KEY å³ä¾§çš„"å¤åˆ¶"æŒ‰é’®
   - **é‡è¦**ï¼šä¿å­˜åˆ°å¯†ç ç®¡ç†å™¨

### æ­¥éª¤ 2ï¼šé…ç½®åç«¯ API

**ç¼–è¾‘ `.env` æ–‡ä»¶**ï¼š

```bash
# æ›´æ–° GLM API é…ç½®
GLM_API_KEY=<åç«¯API KEY>
GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
GLM_VISION_MODEL=glm-4v
```

### æ­¥éª¤ 3ï¼šé…ç½® Worker API

**ç¼–è¾‘ `services/worker/.env` æ–‡ä»¶**ï¼š

```bash
GLM_API_KEY=<Worker API KEY>
BDC_BACKEND_BASE_URL=http://localhost:8000
```

### æ­¥éª¤ 4ï¼šæµ‹è¯• API è¿é€šæ€§

```python
# åˆ›å»ºæµ‹è¯•è„šæœ¬ test_glm_api.py
import os
from openai import OpenAI

api_key = os.getenv("GLM_API_KEY")
client = OpenAI(api_key=api_key, base_url="https://open.bigmodel.cn/api/paas/v4/")

try:
    response = client.chat.completions.create(
        model="glm-4-flash",
        messages=[{"role": "user", "content": "ä½ å¥½"}],
        max_tokens=10
    )
    print("âœ“ GLM API è¿æ¥æˆåŠŸ")
    print(f"å“åº”: {response.choices[0].message.content}")
except Exception as e:
    print(f"âŒ GLM API è¿æ¥å¤±è´¥: {e}")
```

**è¿è¡Œæµ‹è¯•**ï¼š

```bash
python test_glm_api.py
```

---

## ğŸš€ æœåŠ¡å¯åŠ¨

### æ–¹å¼ Aï¼šå¼€å‘æ¨¡å¼ï¼ˆæ¨èæµ‹è¯•ï¼‰

**å¯åŠ¨åç«¯æœåŠ¡**ï¼š

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•

# å¯åŠ¨æœåŠ¡
python -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload

# æˆ–ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆ0.0.0.0ï¼‰
python -m uvicorn services.backend.app.main:app --host 0.0.0.0 --port 8000 --reload
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š

```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using WatchFiles
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

**å¯åŠ¨ Worker æœåŠ¡ï¼ˆæ–°ç»ˆç«¯ï¼‰**ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux

# å¯åŠ¨ Worker
python services/worker/scene_issue_glm_worker.py
```

### æ–¹å¼ Bï¼šç”Ÿäº§æ¨¡å¼ï¼ˆä½¿ç”¨ systemdï¼‰

**åˆ›å»º systemd æœåŠ¡æ–‡ä»¶**ï¼š

**Linux**ï¼š`/etc/systemd/system/bdc-backend.service`

```ini
[Unit]
Description=BDC-AI Backend Service
After=network.target postgresql.service
Requires=postgresql.service

[Service]
Type=simple
User=bdc_ai
Group=bdc_ai
WorkingDirectory=/opt/bdc-ai
Environment="PATH=/opt/bdc-ai/venv/bin"
EnvironmentFile=/opt/bdc-ai/.env
ExecStart=/opt/bdc-ai/venv/bin/uvicorn services.backend.app.main:app \
  --host 0.0.0.0 \
  --port 8000 \
  --workers 4 \
  --log-level info
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡**ï¼š

```bash
# é‡è½½ systemd
sudo systemctl daemon-reload

# å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl enable bdc-backend

# å¯åŠ¨æœåŠ¡
sudo systemctl start bdc-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status bdc-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u bdc-backend -f
```

### Windows æœåŠ¡ï¼ˆä½¿ç”¨ NSSMï¼‰

**å®‰è£… NSSM**ï¼š

1. ä¸‹è½½ï¼šhttps://nssm.cc/download
2. è§£å‹åˆ° `C:\nssm`
3. æ·»åŠ åˆ° PATH

**åˆ›å»ºæœåŠ¡**ï¼š

```powershell
# å®‰è£…æœåŠ¡
nssm install BDC-Backend "D:\BDC-AI\buidingdatacenter-ai\venv\Scripts\python.exe" "-m" "uvicorn services.backend.app.main:app" "--host 0.0.0.0" "--port 8000"

# è®¾ç½®å·¥ä½œç›®å½•
nssm set BDC-Backend AppDirectory "D:\BDC-AI\buidingdatacenter-ai"

# è®¾ç½®ç¯å¢ƒå˜é‡
nssm set BDC-Backend AppEnvironmentExtra "BDC_DATABASE_URL=postgresql://postgres:password@localhost:5432/bdc_ai"

# å¯åŠ¨æœåŠ¡
nssm start BDC-Backend

# è®¾ç½®å¼€æœºè‡ªå¯
nssm set BDC-Backend Start SERVICE_AUTO_START
```

---

## âœ… éªŒè¯æµ‹è¯•

### æµ‹è¯• 1ï¼šå¥åº·æ£€æŸ¥

```bash
curl http://localhost:8000/health
```

**é¢„æœŸè¾“å‡º**ï¼š

```json
{
  "status": "healthy",
  "database": "connected",
  "timestamp": "2026-01-24T10:00:00Z"
}
```

### æµ‹è¯• 2ï¼šAPI æ–‡æ¡£

**è®¿é—®**ï¼š
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### æµ‹è¯• 3ï¼šç”¨æˆ·è®¤è¯

```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"admin\",\"password\":\"admin123\"}"
```

**é¢„æœŸè¾“å‡º**ï¼š

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800
}
```

### æµ‹è¯• 4ï¼šé¡¹ç›® API

```bash
# ä½¿ç”¨è¿”å›çš„ access_token
TOKEN="<ä»ä¸Šä¸€æ­¥è·å–çš„access_token>"

# è·å–é¡¹ç›®åˆ—è¡¨
curl http://localhost:8000/api/v1/projects/ \
  -H "Authorization: Bearer $TOKEN"
```

### æµ‹è¯• 5ï¼šWorker æœåŠ¡

**æŸ¥çœ‹ Worker æ—¥å¿—**ï¼š

```
[INFO] Starting GLM-4V Scene Issue Worker...
[INFO] Worker initialized successfully
[INFO] Polling interval: 60 seconds
[INFO] Backend URL: http://localhost:8000
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š

```
Error: [Errno 48] Address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# Windows: æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8000
taskkill /PID <PID> /F

# Linux: æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :8000
sudo kill <PID>

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
python -m uvicorn services.backend.app.main:app --host 0.0.0.0 --port 8001
```

### é—®é¢˜ 2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š

```
Error: connection to server at "localhost:5432", port 5432 failed
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ PostgreSQL æœåŠ¡çŠ¶æ€
# Windows: æœåŠ¡ç®¡ç†å™¨
# Linux:
sudo systemctl status postgresql

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
psql -U postgres -d bdc_ai

# æ£€æŸ¥ .env é…ç½®
cat .env | grep DATABASE_URL
```

### é—®é¢˜ 3ï¼šæ¨¡å—æœªæ‰¾åˆ°

**é”™è¯¯ä¿¡æ¯**ï¼š

```
ModuleNotFoundError: No module named 'fastapi'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
# Windows: çœ‹åˆ° (venv) å‰ç¼€
# Linux: source venv/bin/activate

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r services/backend/requirements.txt
```

### é—®é¢˜ 4ï¼šAPI KEY æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯**ï¼š

```
Error: 401 Unauthorized
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. æ£€æŸ¥ API KEY æ˜¯å¦æ­£ç¡®é…ç½®
cat .env | grep GLM_API_KEY

# 2. éªŒè¯ API KEY æ˜¯å¦æœ‰æ•ˆ
# è®¿é—®ï¼šhttps://open.bigmodel.cn/apikeys

# 3. æ£€æŸ¥ KEY æ˜¯å¦è¢«ç¦ç”¨
# å°è¯•é‡æ–°ç”Ÿæˆ KEY
```

### é—®é¢˜ 5ï¼šWorker æ— æ³•è¿æ¥åç«¯

**é”™è¯¯ä¿¡æ¯**ï¼š

```
Error: Connection refused
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# 1. ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨
curl http://localhost:8000/health

# 2. æ£€æŸ¥ Worker é…ç½®
cat services/worker/.env | grep BACKEND_BASE_URL

# 3. å°è¯•ä½¿ç”¨ 127.0.0.1 è€Œé localhost
```

---

## ğŸ” è¿ç»´ç®¡ç†

### æ—¥å¿—ç®¡ç†

**åç«¯æ—¥å¿—ä½ç½®**ï¼š

```bash
# å¼€å‘æ¨¡å¼ï¼šæ§åˆ¶å°è¾“å‡º
# ç”Ÿäº§æ¨¡å¼ï¼šsystemd journal
sudo journalctl -u bdc-backend -f
```

**Worker æ—¥å¿—**ï¼š

```bash
# æ§åˆ¶å°è¾“å‡ºæˆ–é‡å®šå‘åˆ°æ–‡ä»¶
python services/worker/scene_issue_glm_worker.py > worker.log 2>&1
```

### æ•°æ®å¤‡ä»½

**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**ï¼š`scripts/backup_database.sh`

```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/postgres"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/bdc_ai_$DATE.sql.gz"

mkdir -p $BACKUP_DIR

# Windows (PowerShell)
$env:PGPASSWORD = "your-password"
pg_dump -U postgres bdc_ai | gzip > $BACKUP_FILE

# Linux
PGPASSWORD=your-password pg_dump -U postgres bdc_ai | gzip > $BACKUP_FILE

echo "Backup completed: $BACKUP_FILE"

# ä¿ç•™æœ€è¿‘ 30 å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "bdc_ai_*.sql.gz" -mtime +30 -delete
```

**å®šæ—¶å¤‡ä»½ï¼ˆLinux Cronï¼‰**ï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * /opt/bdc-ai/scripts/backup_database.sh >> /var/log/db_backup.log 2>&1
```

### æœåŠ¡ç›‘æ§

**å¥åº·æ£€æŸ¥è„šæœ¬**ï¼š

```bash
#!/bin/bash
# health_check.sh

HEALTH_URL="http://localhost:8000/health"
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" $HEALTH_URL)

if [ $RESPONSE -eq 200 ]; then
    echo "âœ“ Service is healthy"
else
    echo "âœ— Service is unhealthy (HTTP $RESPONSE)"
    # å¯ä»¥å‘é€å‘Šè­¦é€šçŸ¥
fi
```

**å®šæ—¶æ£€æŸ¥ï¼ˆCronï¼‰**ï¼š

```bash
# æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
*/5 * * * * /opt/bdc-ai/scripts/health_check.sh
```

### é…ç½®æ›´æ–°

**æ›´æ–°ä»£ç **ï¼š

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# å®‰è£…æ–°ä¾èµ–
pip install -r services/backend/requirements.txt

# é‡å¯æœåŠ¡
sudo systemctl restart bdc-backend  # Linux
nssm restart BDC-Backend             # Windows
```

**æ›´æ–°é…ç½®**ï¼š

```bash
# ç¼–è¾‘ .env æ–‡ä»¶
nano .env

# é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart bdc-backend
```

---

## ğŸ“š é™„å½•

### A. ç«¯å£è¯´æ˜

| ç«¯å£ | æœåŠ¡ | å¤–éƒ¨è®¿é—® |
|------|------|---------|
| 8000 | FastAPI åç«¯ | æ˜¯ |
| 5432 | PostgreSQL | å¦ï¼ˆä»…æœ¬åœ°ï¼‰ |
| 9000 | MinIOï¼ˆå¯é€‰ï¼‰ | å¦ |

### B. ç›®å½•ç»“æ„

```
/opt/bdc-ai/                      # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡
â”‚   â””â”€â”€ worker/                  # Worker æœåŠ¡
â”œâ”€â”€ shared/                      # å…±äº«ä»£ç 
â”œâ”€â”€ scripts/                     # å·¥å…·è„šæœ¬
â”œâ”€â”€ docs/                        # æ–‡æ¡£
â”œâ”€â”€ .env                         # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example                 # é…ç½®æ¨¡æ¿
â””â”€â”€ venv/                        # è™šæ‹Ÿç¯å¢ƒï¼ˆä¸æäº¤ï¼‰
```

### C. æœåŠ¡ç®¡ç†å‘½ä»¤

**Linux (systemd)**ï¼š

```bash
# å¯åŠ¨
sudo systemctl start bdc-backend

# åœæ­¢
sudo systemctl stop bdc-backend

# é‡å¯
sudo systemctl restart bdc-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status bdc-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u bdc-backend -f

# å¼€æœºè‡ªå¯
sudo systemctl enable bdc-backend
```

**Windows (NSSM)**ï¼š

```powershell
# å¯åŠ¨
nssm start BDC-Backend

# åœæ­¢
nssm stop BDC-Backend

# é‡å¯
nssm restart BDC-Backend

# æŸ¥çœ‹çŠ¶æ€
nssm status BDC-Backend

# æŸ¥çœ‹æ—¥å¿—
nssm edit BDC-Backend  # åœ¨æ—¥å¿—éƒ¨åˆ†é…ç½®
```

### D. é…ç½®æ–‡ä»¶å‚è€ƒ

**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š`scripts/.env.complete`

```bash
# ================= æ•°æ®åº“é…ç½® =================
BDC_DATABASE_URL=postgresql://postgres:strong-password@localhost:5432/bdc_ai

# ================= æœ¬åœ°å­˜å‚¨ =================
BDC_LOCAL_STORAGE_DIR=data/assets

# ================= JWT è®¤è¯ =================
BDC_JWT_SECRET_KEY=<64å­—ç¬¦hex>
BDC_ACCESS_TOKEN_EXPIRE_MINUTES=30
BDC_REFRESH_TOKEN_EXPIRE_DAYS=7

# ================= GLM API =================
GLM_API_KEY=<API-KEY>
GLM_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
GLM_VISION_MODEL=glm-4v

# ================= MinIOï¼ˆå¯é€‰ï¼‰=================
BDC_MINIO_ENDPOINT=localhost:9000
BDC_MINIO_ACCESS_KEY=minioadmin
BDC_MINIO_SECRET_KEY=minioadmin
BDC_MINIO_BUCKET=bdc-assets

# ================= æœåŠ¡é…ç½® =================
BDC_HOST=0.0.0.0
BDC_PORT=8000
BDC_LOG_LEVEL=INFO
BDC_DEBUG=false
```

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] Python 3.11+ å·²å®‰è£…
- [ ] PostgreSQL 18 å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] Git å·²å®‰è£…
- [ ] è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- [ ] ä¾èµ–å·²å®‰è£…

### é…ç½®æ£€æŸ¥

- [ ] æ•°æ®åº“å·²åˆ›å»º
- [ ] .env æ–‡ä»¶å·²é…ç½®
- [ ] JWT å¯†é’¥å·²ç”Ÿæˆ
- [ ] GLM API KEY å·²é…ç½®
- [ ] Worker é…ç½®å·²åˆ›å»º

### æœåŠ¡æ£€æŸ¥

- [ ] åç«¯æœåŠ¡å¯å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] API æ–‡æ¡£å¯è®¿é—®
- [ ] ç”¨æˆ·è®¤è¯æˆåŠŸ
- [ ] Worker å¯å¯åŠ¨

### è¿ç»´æ£€æŸ¥

- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] å¤‡ä»½è„šæœ¬å·²è®¾ç½®
- [ ] ç›‘æ§å‘Šè­¦å·²é…ç½®

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº

- **API KEY å®‰å…¨ç®¡ç†**ï¼š`docs/02-æŠ€æœ¯æ–‡æ¡£/API-KEYå®‰å…¨ç®¡ç†æ–¹æ¡ˆ.md`
- **å¿«é€Ÿé…ç½®æŒ‡å—**ï¼š`scripts/QUICK_SETUP.md`
- **Tailscale ç½‘ç»œæ–¹æ¡ˆ**ï¼š`docs/02-æŠ€æœ¯æ–‡æ¡£/Tailscaleè™šæ‹Ÿå±€åŸŸç½‘å®æ–½æ–¹æ¡ˆ.md`

### é—®é¢˜åé¦ˆ

- **GitHub Issues**ï¼šhttps://github.com/Jimmy-ye/buidingdatacenter-ai/issues
- **é¡¹ç›®æ–‡æ¡£**ï¼šæŸ¥çœ‹é¡¹ç›® README.md

---

**æ–‡æ¡£ç»´æŠ¤**ï¼šBDC-AI å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**ï¼š2026-01-24
**ç‰ˆæœ¬**ï¼šv1.0.0
