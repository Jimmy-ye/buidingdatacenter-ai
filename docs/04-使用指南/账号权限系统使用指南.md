# BDC-AI è´¦å·æƒé™ç³»ç»Ÿä½¿ç”¨æŒ‡å—

æœ€åæ›´æ–°ï¼š2026-01-26

---

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [Web API ä½¿ç”¨](#web-api-ä½¿ç”¨)
3. [Python è„šæœ¬è°ƒç”¨](#python-è„šæœ¬è°ƒç”¨)
4. [ç§»åŠ¨ç«¯é›†æˆ](#ç§»åŠ¨ç«¯é›†æˆ)
5. [PC ç«¯é›†æˆ](#pc-ç«¯é›†æˆ)
6. [ç”¨æˆ·å’Œæƒé™ç®¡ç†](#ç”¨æˆ·å’Œæƒé™ç®¡ç†)
7. [å¸¸è§åœºæ™¯](#å¸¸è§åœºæ™¯)

---

## å¿«é€Ÿå¼€å§‹

### é»˜è®¤ç®¡ç†å‘˜è´¦å·

ç³»ç»Ÿæä¾›ä¸¤ä¸ªè¶…çº§ç®¡ç†å‘˜è´¦å·ï¼ˆäºŒé€‰ä¸€å³å¯ï¼‰ï¼š

**ä¸»ç®¡ç†å‘˜**:
```
ç”¨æˆ·åï¼šyerui
é‚®ç®±ï¼šyerui@bdc-ai.com
å¯†ç ï¼šye123456
è§’è‰²ï¼šè¶…çº§ç®¡ç†å‘˜ï¼ˆSuper Administratorï¼‰
```

**å¤‡ç”¨ç®¡ç†å‘˜**:
```
ç”¨æˆ·åï¼šadmin
é‚®ç®±ï¼šadmin@bdc-ai.com
å¯†ç ï¼šadmin123
è§’è‰²ï¼šè¶…çº§ç®¡ç†å‘˜ï¼ˆSuper Administratorï¼‰
```

âš ï¸ **å®‰å…¨æç¤º**ï¼š
- ç”Ÿäº§ç¯å¢ƒè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼
- å»ºè®®åˆ é™¤ä¸éœ€è¦çš„ç®¡ç†å‘˜è´¦å·
- å®šæœŸæ›´æ¢å¯†ç å¹¶ä½¿ç”¨å¼ºå¯†ç 

### æƒé™ç³»ç»Ÿè¯´æ˜

ç³»ç»Ÿåˆå§‹åŒ–ååŒ…å« **26 ä¸ªæƒé™**ï¼Œæ¶µç›–ï¼š
- ç”¨æˆ·ç®¡ç†ï¼ˆuser:*, role:*ï¼‰
- é¡¹ç›®ç®¡ç†ï¼ˆproject:*ï¼‰
- èµ„äº§ç®¡ç†ï¼ˆasset:*, assets:*ï¼‰
- å·¥ç¨‹ç»“æ„ï¼ˆstructures:*ï¼‰
- ç³»ç»Ÿé…ç½®ï¼ˆsystem:configï¼‰
- åŠŸèƒ½æ“ä½œï¼ˆocr:run, llm:runï¼‰
- å®¡è®¡æ—¥å¿—ï¼ˆaudit:readï¼‰

è¶…çº§ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿä¸­çš„ä»»ä½•æ“ä½œã€‚

---

## Web API ä½¿ç”¨

### 1. ä½¿ç”¨ Swagger UIï¼ˆæœ€ç®€å•ï¼‰

**è®¿é—®åœ°å€**ï¼šhttp://localhost:8000/docs

#### æ­¥éª¤ 1ï¼šç™»å½•è·å– Token

1. æ‰“å¼€ http://localhost:8000/docs
2. æ‰¾åˆ° `/api/v1/auth/login` ç«¯ç‚¹
3. ç‚¹å‡» "Try it out"
4. è¾“å…¥å‡­è¯ï¼š
   ```json
   {
     "username": "admin",
     "password": "admin123"
   }
   ```
5. ç‚¹å‡» "Execute"
6. ä»å“åº”ä¸­å¤åˆ¶ `access_token`

#### æ­¥éª¤ 2ï¼šè®¾ç½®è®¤è¯

1. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ ğŸ”“ "Authorize" æŒ‰é’®
2. åœ¨å¼¹å‡ºæ¡†ä¸­è¾“å…¥ï¼š`Bearer ä½ çš„access_token`
   ```
   Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```
3. ç‚¹å‡» "Authorize"
4. å…³é—­å¯¹è¯æ¡†

#### æ­¥éª¤ 3ï¼šè°ƒç”¨å—ä¿æŠ¤çš„ API

ç°åœ¨ä½ å¯ä»¥è°ƒç”¨ä»»ä½•éœ€è¦è®¤è¯çš„ API äº†ï¼š
- è·å–é¡¹ç›®åˆ—è¡¨
- åˆ›å»ºé¡¹ç›®
- æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
- ç®¡ç†è§’è‰²æƒé™

---

### 2. ä½¿ç”¨ cURL

#### ç™»å½•

```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**å“åº”**ï¼š
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

#### ä¿å­˜ Token

```bash
# Linux/Mac
export TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# Windows PowerShell
$TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# Windows CMD
set TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### ä½¿ç”¨ Token è®¿é—® API

```bash
# è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
curl http://localhost:8000/api/v1/auth/me \
  -H "Authorization: Bearer $TOKEN"

# è·å–é¡¹ç›®åˆ—è¡¨
curl http://localhost:8000/api/v1/projects/ \
  -H "Authorization: Bearer $TOKEN"

# åˆ›å»ºé¡¹ç›®
curl -X POST http://localhost:8000/api/v1/projects/ \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æµ‹è¯•é¡¹ç›®",
    "client": "æµ‹è¯•å®¢æˆ·",
    "type": "commercial",
    "status": "planning"
  }'
```

---

## Python è„šæœ¬è°ƒç”¨

### åˆ›å»º API å®¢æˆ·ç«¯ç±»

```python
"""
BDC-AI API å®¢æˆ·ç«¯ç¤ºä¾‹
"""
import requests
from typing import Optional

class BDCAClient:
    """BDC-AI API å®¢æˆ·ç«¯"""

    def __init__(self, base_url: str = "http://localhost:8000"):
        self.base_url = base_url
        self.token: Optional[str] = None
        self.user_info: Optional[dict] = None

    def login(self, username: str, password: str) -> bool:
        """ç™»å½•"""
        response = requests.post(
            f"{self.base_url}/api/v1/auth/login",
            json={"username": username, "password": password}
        )

        if response.status_code == 200:
            data = response.json()
            self.token = data["access_token"]
            self.user_info = data.get("user", {})
            print(f"âœ“ ç™»å½•æˆåŠŸï¼š{self.user_info.get('username')}")
            return True
        else:
            print(f"âœ— ç™»å½•å¤±è´¥ï¼š{response.status_code}")
            return False

    def get_headers(self) -> dict:
        """è·å–è®¤è¯å¤´"""
        if not self.token:
            raise ValueError("æœªç™»å½•ï¼Œè¯·å…ˆè°ƒç”¨ login()")
        return {"Authorization": f"Bearer {self.token}"}

    def get_current_user(self) -> dict:
        """è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯"""
        response = requests.get(
            f"{self.base_url}/api/v1/auth/me",
            headers=self.get_headers()
        )
        response.raise_for_status()
        return response.json()

    def get_projects(self, **filters) -> list:
        """è·å–é¡¹ç›®åˆ—è¡¨"""
        response = requests.get(
            f"{self.base_url}/api/v1/projects/",
            headers=self.get_headers(),
            params=filters
        )
        response.raise_for_status()
        return response.json()

    def create_project(self, project_data: dict) -> dict:
        """åˆ›å»ºé¡¹ç›®"""
        response = requests.post(
            f"{self.base_url}/api/v1/projects/",
            headers=self.get_headers(),
            json=project_data
        )
        response.raise_for_status()
        return response.json()

    def update_project(self, project_id: str, project_data: dict) -> dict:
        """æ›´æ–°é¡¹ç›®"""
        response = requests.patch(
            f"{self.base_url}/api/v1/projects/{project_id}",
            headers=self.get_headers(),
            json=project_data
        )
        response.raise_for_status()
        return response.json()

    def delete_project(self, project_id: str) -> None:
        """åˆ é™¤é¡¹ç›®"""
        response = requests.delete(
            f"{self.base_url}/api/v1/projects/{project_id}",
            headers=self.get_headers()
        )
        response.raise_for_status()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºå®¢æˆ·ç«¯
    client = BDCAClient()

    # ç™»å½•
    if client.login("admin", "admin123"):
        # è·å–ç”¨æˆ·ä¿¡æ¯
        user = client.get_current_user()
        print(f"ç”¨æˆ·ä¿¡æ¯ï¼š{user}")

        # è·å–é¡¹ç›®åˆ—è¡¨
        projects = client.get_projects()
        print(f"é¡¹ç›®æ•°é‡ï¼š{len(projects)}")

        # åˆ›å»ºæ–°é¡¹ç›®
        new_project = client.create_project({
            "name": "ç¤ºä¾‹é¡¹ç›®",
            "client": "ç¤ºä¾‹å®¢æˆ·",
            "type": "commercial",
            "status": "planning",
            "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é¡¹ç›®"
        })
        print(f"åˆ›å»ºçš„é¡¹ç›®ï¼š{new_project}")
```

### ç®€å•è„šæœ¬ç¤ºä¾‹

```python
import requests

# 1. ç™»å½•
login_response = requests.post(
    "http://localhost:8000/api/v1/auth/login",
    json={"username": "admin", "password": "admin123"}
)
token = login_response.json()["access_token"]

# 2. ä½¿ç”¨ Token è®¿é—® API
headers = {"Authorization": f"Bearer {token}"}

# è·å–é¡¹ç›®åˆ—è¡¨
projects = requests.get(
    "http://localhost:8000/api/v1/projects/",
    headers=headers
).json()

print(f"æ‰¾åˆ° {len(projects)} ä¸ªé¡¹ç›®")
for project in projects:
    print(f"  - {project['name']} ({project['status']})")

# åˆ›å»ºæ–°é¡¹ç›®
new_project = requests.post(
    "http://localhost:8000/api/v1/projects/",
    headers=headers,
    json={
        "name": "æ–°é¡¹ç›®",
        "client": "å®¢æˆ·A",
        "type": "commercial",
        "status": "planning"
    }
).json()

print(f"åˆ›å»ºé¡¹ç›®æˆåŠŸï¼š{new_project['id']}")
```

---

## ç§»åŠ¨ç«¯é›†æˆ

### Flutter é›†æˆç¤ºä¾‹

#### 1. æ·»åŠ ä¾èµ–

```yaml
# pubspec.yaml
dependencies:
  flutter_secure_storage: ^8.0.0
  http: ^1.1.0
  shared_preferences: ^2.2.0
```

#### 2. åˆ›å»ºè®¤è¯æœåŠ¡

```dart
// lib/services/auth_service.dart
import 'dart:convert';
import 'package:http/http.dart' as http;
import 'package:flutter_secure_storage/flutter_secure_storage.dart';
import 'package:shared_preferences/shared_preferences.dart';

class AuthService {
  final String baseUrl;
  final FlutterSecureStorage _storage = const FlutterSecureStorage();

  String? _accessToken;
  String? _refreshToken;

  AuthService({this.baseUrl = 'http://localhost:8000'});

  // ç™»å½•
  Future<bool> login(String username, String password) async {
    final response = await http.post(
      Uri.parse('$baseUrl/api/v1/auth/login'),
      headers: {'Content-Type': 'application/json'},
      body: jsonEncode({
        'username': username,
        'password': password,
      }),
    );

    if (response.statusCode == 200) {
      final data = jsonDecode(response.body);
      _accessToken = data['access_token'];
      _refreshToken = data['refresh_token'];

      // ä¿å­˜ Token
      await _storage.write(key: 'access_token', value: _accessToken);
      await _storage.write(key: 'refresh_token', value: _refreshToken);

      return true;
    }

    return false;
  }

  // è·å–è®¤è¯å¤´
  Map<String, String> getAuthHeaders() {
    final token = _accessToken ?? '';
    return {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $token',
    };
  }

  // è·å–é¡¹ç›®åˆ—è¡¨
  Future<List<dynamic>> getProjects() async {
    final response = await http.get(
      Uri.parse('$baseUrl/api/v1/projects/'),
      headers: getAuthHeaders(),
    );

    if (response.statusCode == 200) {
      return jsonDecode(response.body);
    }

    throw Exception('è·å–é¡¹ç›®åˆ—è¡¨å¤±è´¥');
  }

  // ç™»å‡º
  Future<void> logout() async {
    await _storage.delete(key: 'access_token');
    await _storage.delete(key: 'refresh_token');
    _accessToken = null;
    _refreshToken = null;
  }
}
```

#### 3. ä½¿ç”¨ç¤ºä¾‹

```dart
// lib/screens/home_screen.dart
import 'package:flutter/material.dart';
import '../services/auth_service.dart';

class HomeScreen extends StatefulWidget {
  @override
  _HomeScreenState createState() => _HomeScreenState();
}

class _HomeScreenState extends State<HomeScreen> {
  final AuthService _authService = AuthService();
  List<dynamic> _projects = [];
  bool _loading = false;

  @override
  void initState() {
    super.initState();
    _loadProjects();
  }

  Future<void> _loadProjects() async {
    setState(() => _loading = true);

    try {
      final projects = await _authService.getProjects();
      setState(() => _projects = projects);
    } catch (e) {
      print('é”™è¯¯ï¼š$e');
    } finally {
      setState(() => _loading = false);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('BDC-AI'),
        actions: [
          IconButton(
            icon: Icon(Icons.logout),
            onPressed: () async {
              await _authService.logout();
              Navigator.pushReplacementNamed(context, '/login');
            },
          ),
        ],
      ),
      body: _loading
          ? Center(child: CircularProgressIndicator())
          : ListView.builder(
              itemCount: _projects.length,
              itemBuilder: (context, index) {
                final project = _projects[index];
                return ListTile(
                  title: Text(project['name']),
                  subtitle: Text(project['client']),
                  trailing: Text(project['status']),
                );
              },
            ),
    );
  }
}
```

---

## PC ç«¯é›†æˆ

### NiceGUI é›†æˆç¤ºä¾‹

```python
"""
BDC-AI PC ç«¯ - NiceGUI é›†æˆç¤ºä¾‹
"""
from nicegui import ui, app
import requests

API_BASE = "http://localhost:8000"

class AppState:
    """åº”ç”¨çŠ¶æ€"""
    def __init__(self):
        self.token = None
        self.user = None

state = AppState()

def login_page():
    """ç™»å½•é¡µé¢"""
    ui.label('BDC-AI å»ºç­‘èŠ‚èƒ½ç®¡ç†å¹³å°').classes('text-3xl font-bold')

    with ui.card().classes('w-96'):
        username = ui.input('ç”¨æˆ·å', placeholder='admin')
        password = ui.input('å¯†ç ', password=True, placeholder='admin123')

        async def do_login():
            try:
                response = requests.post(
                    f"{API_BASE}/api/v1/auth/login",
                    json={
                        "username": username.value,
                        "password": password.value
                    }
                )

                if response.status_code == 200:
                    data = response.json()
                    state.token = data['access_token']
                    state.user = data.get('user')

                    # ä¿å­˜åˆ° storage
                    app.storage.user['token'] = state.token

                    ui.notify('ç™»å½•æˆåŠŸ', type='positive')
                    main_page()
                else:
                    ui.notify('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ', type='negative')
            except Exception as e:
                ui.notify(f'ç™»å½•é”™è¯¯ï¼š{e}', type='negative')

        ui.button('ç™»å½•', on_click=do_login).classes('w-full mt-4')

def get_headers():
    """è·å–è®¤è¯å¤´"""
    return {"Authorization": f"Bearer {state.token}"}

def main_page():
    """ä¸»é¡µé¢"""
    ui.query('body').classes('bg-gray-50')

    with ui.header().classes('bg-blue-600 text-white p-4'):
        ui.label(f'BDC-AI - æ¬¢è¿ {state.user["username"]}').classes('text-xl font-bold')

        ui.button(on_click=lambda: ui.navigate('/login')) \
            .props('outline round').classes('ml-auto')

    with ui.column().classes('p-4 w-full max-w-6xl mx-auto'):
        ui.label('é¡¹ç›®ç®¡ç†').classes('text-2xl font-bold mb-4')

        # é¡¹ç›®åˆ—è¡¨
        async def load_projects():
            try:
                response = requests.get(
                    f"{API_BASE}/api/v1/projects/",
                    headers=get_headers()
                )
                projects = response.json()

                with ui.card().classes('w-full'):
                    ui.label(f'å…± {len(projects)} ä¸ªé¡¹ç›®').classes('text-lg font-bold')

                    for project in projects:
                        with ui.card().classes('mb-2'):
                            ui.label(project['name']).classes('text-lg font-bold')
                            ui.label(f"å®¢æˆ·ï¼š{project['client']}").classes('text-gray-600')
                            ui.label(f"çŠ¶æ€ï¼š{project['status']}").classes('text-sm')

            except Exception as e:
                ui.notify(f'åŠ è½½å¤±è´¥ï¼š{e}', type='negative')

        load_projects()

# åˆå§‹åŒ–
@ui.page('/')
def index():
    # æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
    if app.storage.user.get('token'):
        state.token = app.storage.user['token']
        main_page()
    else:
        login_page()

# å¯åŠ¨åº”ç”¨
ui.run(port=8080, title='BDC-AI ç®¡ç†å¹³å°')
```

---

## ç”¨æˆ·å’Œæƒé™ç®¡ç†

### 1. åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

```bash
# ä½¿ç”¨ç®¡ç†å‘˜ Token
export ADMIN_TOKEN="..."

# åˆ›å»ºæ–°ç”¨æˆ·
curl -X POST http://localhost:8000/api/v1/auth/users/ \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "engineer1",
    "email": "engineer1@example.com",
    "password": "Pass123!@#",
    "is_active": true,
    "is_superuser": false
  }'
```

### 2. ä¸ºç”¨æˆ·åˆ†é…è§’è‰²

```bash
# ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
USER_ID="ç”¨æˆ·UUID"
ROLE_ID="è§’è‰²UUID"

curl -X POST http://localhost:8000/api/v1/auth/users/{user_id}/roles \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"role_id": "$ROLE_ID"}'
```

### 3. æŸ¥çœ‹æ‰€æœ‰è§’è‰²å’Œæƒé™

```bash
# è·å–è§’è‰²åˆ—è¡¨
curl http://localhost:8000/api/v1/auth/roles/ \
  -H "Authorization: Bearer $TOKEN"

# è·å–æƒé™åˆ—è¡¨
curl http://localhost:8000/api/v1/auth/permissions/ \
  -H "Authorization: Bearer $TOKEN"
```

### 4. ä¿®æ”¹å¯†ç 

```bash
# ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç 
curl -X POST http://localhost:8000/api/v1/auth/me/change-password \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "old_password": "admin123",
    "new_password": "NewSecurePass456!"
  }'

# ç®¡ç†å‘˜ä¿®æ”¹å…¶ä»–ç”¨æˆ·å¯†ç 
curl -X POST http://localhost:8000/api/v1/auth/users/{user_id}/reset-password \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"new_password": "NewPass123!"}'
```

---

## å¸¸è§åœºæ™¯

### åœºæ™¯ 1ï¼šæ—¥å¸¸å¼€å‘æµ‹è¯•

```python
import requests

# ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•
response = requests.post(
    "http://localhost:8000/api/v1/auth/login",
    json={"username": "admin", "password": "admin123"}
)
token = response.json()["access_token"]

# åœ¨ä»£ç ä¸­ä½¿ç”¨
headers = {"Authorization": f"Bearer {token}"}

# æµ‹è¯•ä½ çš„ API
requests.get("http://localhost:8000/api/v1/projects/", headers=headers)
```

### åœºæ™¯ 2ï¼šè‡ªåŠ¨åŒ–è„šæœ¬

```python
"""
è‡ªåŠ¨åŒ–æ•°æ®å¯¼å…¥è„šæœ¬
"""
import requests
import csv

class BDC_AImporter:
    def __init__(self):
        self.client = requests.Session()
        self.token = None

    def login(self, username, password):
        """ç™»å½•"""
        response = self.client.post(
            "http://localhost:8000/api/v1/auth/login",
            json={"username": username, "password": password}
        )
        self.token = response.json()["access_token"]
        self.client.headers.update({
            "Authorization": f"Bearer {self.token}"
        })

    def import_projects(self, csv_file):
        """ä» CSV å¯¼å…¥é¡¹ç›®"""
        with open(csv_file) as f:
            reader = csv.DictReader(f)
            for row in reader:
                self.client.post(
                    "http://localhost:8000/api/v1/projects/",
                    json=row
                )
                print(f"âœ“ å¯¼å…¥é¡¹ç›®ï¼š{row['name']}")

# ä½¿ç”¨
importer = BDC_AImporter()
importer.login("admin", "admin123")
importer.import_projects("projects.csv")
```

### åœºæ™¯ 3ï¼šå¤šç¯å¢ƒéƒ¨ç½²

```python
import requests
import os

class Config:
    DEV = "http://localhost:8000"
    STAGING = "http://staging.example.com"
    PRODUCTION = "https://api.example.com"

# æ ¹æ®ç¯å¢ƒå˜é‡é€‰æ‹© API åœ°å€
API_BASE = os.getenv("BDC_API_URL", Config.DEV)

def get_client():
    """è·å–å·²è®¤è¯çš„å®¢æˆ·ç«¯"""
    client = requests.Session()

    # ä»ç¯å¢ƒå˜é‡è·å–å‡­è¯
    username = os.getenv("BDC_USERNAME")
    password = os.getenv("BDC_PASSWORD")

    # ç™»å½•
    response = client.post(
        f"{API_BASE}/api/v1/auth/login",
        json={"username": username, "password": password}
    )
    token = response.json()["access_token"]

    # è®¾ç½®è®¤è¯å¤´
    client.headers.update({"Authorization": f"Bearer {token}"})

    return client
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **ä¿®æ”¹é»˜è®¤å¯†ç **ï¼š
   ```bash
   curl -X POST http://localhost:8000/api/v1/auth/me/change-password \
     -H "Authorization: Bearer $TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"old_password":"admin123","new_password":"ä½ çš„æ–°å¯†ç "}'
   ```

2. **è®¿é—® API æ–‡æ¡£**ï¼šhttp://localhost:8000/docs

3. **æŸ¥çœ‹è®¤è¯æµ‹è¯•æŠ¥å‘Š**ï¼š`AUTH_TEST_REPORT.md`

4. **é˜…è¯»æ›´å¤šæ–‡æ¡£**ï¼š
   - åç«¯éƒ¨ç½²æŒ‡å—ï¼š`docs/02-æŠ€æœ¯æ–‡æ¡£/åç«¯æœåŠ¡å™¨éƒ¨ç½²å®Œæ•´æŒ‡å—.md`
   - å®‰å…¨å®¡æŸ¥æŠ¥å‘Šï¼š`docs/03-ä¼˜åŒ–è®°å½•/2026-01-24-è´¦å·æƒé™ç³»ç»Ÿå®‰å…¨å®¡æŸ¥.md`

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šç™»å½•åæƒé™æ•°é‡ä¸º 0

**ç—‡çŠ¶**ï¼š
- PC-UI ç™»å½•æˆåŠŸï¼Œä½†æ‰€æœ‰æŒ‰é’®éƒ½éšè—
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º "æƒé™æ•°é‡: 0"
- `/api/v1/auth/me` è¿”å›çš„ `permissions` æ•°ç»„ä¸ºç©º

**åŸå› åˆ†æ**ï¼š
1. åç«¯å¯åŠ¨è·¯å¾„ä¸æ­£ç¡®ï¼ˆæœ€å¸¸è§ï¼‰
2. æ•°æ®åº“æƒé™è¡¨æœªåˆå§‹åŒ–
3. Pydantic schema æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ 1ï¼šç¡®ä¿åç«¯ä»æ ¹ç›®å½•å¯åŠ¨**ï¼ˆæ¨èï¼‰
```bash
# æ­£ç¡®å¯åŠ¨æ–¹å¼ï¼ˆä»é¡¹ç›®æ ¹ç›®å½•ï¼‰
cd D:\BDC-AI
python -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload

# é”™è¯¯å¯åŠ¨æ–¹å¼ï¼ˆä¼šå¯¼è‡´æ‰¾ä¸åˆ° shared æ¨¡å—ï¼‰
cd services/backend
python -m uvicorn app.main:app --host localhost --port 8000  # âŒ é”™è¯¯
```

**æ–¹æ¡ˆ 2ï¼šé‡æ–°åˆå§‹åŒ–æƒé™**
```bash
# è¿è¡Œæƒé™åˆå§‹åŒ–è„šæœ¬
python scripts/Windows/init_auth_data.py

# åº”è¯¥çœ‹åˆ°ï¼š
# [åˆ›å»º] ç®¡ç†å‘˜ç”¨æˆ·: yerui
# [åˆ›å»º] æƒé™: structures:create
# ...
# æƒé™åˆå§‹åŒ–å®Œæˆï¼Œæ€»è®¡: 26 ä¸ªæƒé™
```

**æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ SQL å¿«é€Ÿä¿®å¤**ï¼ˆè¿œç¨‹æœåŠ¡å™¨ï¼‰
```bash
# è¿æ¥åˆ°è¿œç¨‹æ•°æ®åº“
psql -U admin -d bdc_ai -f scripts/æ•°æ®åº“/fix_yerui_permissions.sql
```

**æ–¹æ¡ˆ 4ï¼šéªŒè¯æƒé™é…ç½®**
```bash
# è¿è¡ŒéªŒè¯è„šæœ¬
python scripts/æµ‹è¯•/test_yerui_permissions.py

# é¢„æœŸè¾“å‡ºï¼š
# [OK] ç™»å½•
# [OK] è·å–ç”¨æˆ·ä¿¡æ¯
# [OK] is_superuser = True
# [OK] æƒé™åˆ—è¡¨ä¸ä¸ºç©º
# [OK] PC-UI å…³é”®æƒé™å®Œæ•´
# [SUCCESS] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

---

### é—®é¢˜ 2ï¼šæ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡

**ç—‡çŠ¶**ï¼š
- `requests.exceptions.ConnectionError`
- curl: `Failed to connect to localhost port 8000`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
netstat -ano | grep ":8000" | grep "LISTENING"

# 2. æ£€æŸ¥è¿›ç¨‹
tasklist | grep python

# 3. é‡å¯åç«¯ï¼ˆä»æ ¹ç›®å½•ï¼‰
cd D:\BDC-AI
python -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload
```

---

### é—®é¢˜ 3ï¼šToken è¿‡æœŸæˆ–æ— æ•ˆ

**ç—‡çŠ¶**ï¼š
- API è¿”å› `401 Unauthorized`
- å“åº”ï¼š`{"detail": "Invalid authentication credentials"}`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
import requests

# æ–¹æ¡ˆ 1ï¼šé‡æ–°ç™»å½•
response = requests.post(
    "http://localhost:8000/api/v1/auth/login",
    json={"username": "yerui", "password": "ye123456"}
)
token = response.json()["access_token"]

# æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ Refresh Token åˆ·æ–°
refresh_token = "your-refresh-token"
response = requests.post(
    "http://localhost:8000/api/v1/auth/refresh",
    json={"refresh_token": refresh_token}
)
new_token = response.json()["access_token"]
```

---

### é—®é¢˜ 4ï¼šPydantic éªŒè¯é”™è¯¯

**ç—‡çŠ¶**ï¼š
- API è¿”å› `422 Unprocessable Entity`
- æ—¥å¿—ï¼š`value is not a valid dict`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿åç«¯ä»£ç å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
2. æ¸…é™¤ Python ç¼“å­˜ï¼š
   ```bash
   find services/backend -name "__pycache__" -exec rm -rf {} +
   ```
3. é‡å¯åç«¯æœåŠ¡

---

### é—®é¢˜ 5ï¼šPC-UI æŒ‰é’®ä»ç„¶éšè—

**ç—‡çŠ¶**ï¼š
- API è¿”å›æƒé™æ­£å¸¸
- PC-UI ä¸­æŒ‰é’®ä»ç„¶ä¸æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**ï¼šæŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°
2. **æ£€æŸ¥ PC-UI æ—¥å¿—**ï¼šæŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
3. **éªŒè¯è®¤è¯ç®¡ç†å™¨**ï¼š
   ```python
   from desktop.nicegui_app.auth_manager import auth_manager

   # ç™»å½•
   auth_manager.login("yerui", "ye123456")

   # æ£€æŸ¥æƒé™
   print("æ˜¯å¦è¶…çº§ç”¨æˆ·:", auth_manager.is_superuser())
   print("æ‰€æœ‰æƒé™:", auth_manager.get_all_permissions())
   print("æœ‰ structures:create:", auth_manager.has_permission("structures:create"))
   ```
4. **é‡å¯ PC-UI**ï¼š
   ```bash
   python -m desktop.nicegui_app.pc_app
   ```

---

### é—®é¢˜ 6ï¼šModuleNotFoundError: No module named 'shared'

**ç—‡çŠ¶**ï¼š
- åç«¯å¯åŠ¨å¤±è´¥
- é”™è¯¯ï¼š`ModuleNotFoundError: No module named 'shared'`

**åŸå› **ï¼šä»é”™è¯¯çš„ç›®å½•å¯åŠ¨åç«¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¿…é¡»ä»é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨
cd D:\BDC-AI  # æˆ– cd /path/to/BDC-AI
python -m uvicorn services.backend.app.main:app --host localhost --port 8000

# ä¸è¦ä» services/backend ç›®å½•å¯åŠ¨ï¼
```

---

### è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   - åç«¯æ—¥å¿—ï¼šæ§åˆ¶å°è¾“å‡º
   - PC-UI æ—¥å¿—ï¼šæµè§ˆå™¨ F12 æ§åˆ¶å°
   - æ•°æ®åº“æ—¥å¿—ï¼šPostgreSQL æ—¥å¿—

2. **è¿è¡Œè¯Šæ–­è„šæœ¬**ï¼š
   ```bash
   python scripts/æµ‹è¯•/test_yerui_permissions.py
   ```

3. **æŸ¥çœ‹ç›¸å…³æ–‡æ¡£**ï¼š
   - æƒé™ä¿®å¤è®°å½•ï¼š`docs/03-ä¼˜åŒ–è®°å½•/æƒé™åˆå§‹åŒ–ä¿®å¤è®¡åˆ’.md`
   - æµ‹è¯•æŒ‡å—ï¼š`scripts/æµ‹è¯•/test_permission_control.md`
   - éƒ¨ç½²æŒ‡å—ï¼š`docs/04-ä½¿ç”¨æŒ‡å—/éƒ¨ç½²è¿ç»´æŒ‡å—.md`

4. **è”ç³»æ”¯æŒ**ï¼š
   - æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“
   - è”ç³» BDC-AI å¼€å‘å›¢é˜Ÿ

---

**æ–‡æ¡£ç»´æŠ¤**ï¼šBDC-AI å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**ï¼š2026-01-26
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼ˆå«æ•…éšœæ’æŸ¥ç« èŠ‚ï¼‰
