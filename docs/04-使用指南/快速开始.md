# BDC-AI å¿«é€Ÿå¼€å§‹

## ğŸ“– æ–‡æ¡£è¯´æ˜

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨ 5 åˆ†é’Ÿå†…å¿«é€Ÿå¯åŠ¨å¹¶ä½“éªŒ BDC-AI ç³»ç»Ÿã€‚

**é€‚ç”¨äººç¾¤**:
- æ–°æˆå‘˜å…¥èŒ
- é¡¹ç›®å¹²ç³»äººäº†è§£ç³»ç»Ÿ
- å¿«é€Ÿä½“éªŒæ ¸å¿ƒåŠŸèƒ½

**æ—¶é—´ä¼°ç®—**: 5 åˆ†é’Ÿ

---

## âœ… å‰ç½®è¦æ±‚

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **PostgreSQL**: 18.1 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: Windows / macOS / Linux
- **å†…å­˜**: è‡³å°‘ 4GB RAM
- **ç£ç›˜**: è‡³å°‘ 1GB å¯ç”¨ç©ºé—´

### æ£€æŸ¥ç¯å¢ƒ

```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
python --version

# æ£€æŸ¥ PostgreSQL ç‰ˆæœ¬
psql --version

# æ£€æŸ¥ pip
pip --version
```

---

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/program-bdc-ai.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd program-bdc-ai
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å®é™…é…ç½®
# Windows: notepad .env
# macOS/Linux: nano .env
```

**å¿…éœ€é…ç½®**:
```bash
# æ•°æ®åº“è¿æ¥ URL
BDC_DATABASE_URL=postgresql://admin:password@localhost:5432/bdc_ai

# JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ openssl rand -hex 32 ç”Ÿæˆï¼‰
BDC_JWT_SECRET_KEY=your-secret-key-change-in-production

# GLM API Keyï¼ˆç”¨äº AI åˆ†æï¼‰
GLM_API_KEY=your_glm_api_key_here
```

### æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# å®‰è£…åç«¯ä¾èµ–
pip install -r services/backend/requirements.txt

# éªŒè¯å®‰è£…
python -c "import fastapi; import sqlalchemy; print('ä¾èµ–å®‰è£…æˆåŠŸï¼')"
```

### æ­¥éª¤ 4ï¼šåˆå§‹åŒ–æ•°æ®åº“ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# åˆ›å»ºæ•°æ®åº“
psql -U postgres
CREATE DATABASE bdc_ai OWNER admin;
GRANT ALL PRIVILEGES ON DATABASE bdc_ai TO admin;
\q

# åˆå§‹åŒ–è®¤è¯ç³»ç»Ÿ
python scripts/init_auth_db.py

# éªŒè¯åˆå§‹åŒ–
# åº”è¯¥çœ‹åˆ°ï¼šåˆ›å»º 27 ä¸ªæƒé™ã€6 ä¸ªè§’è‰²ã€4 ä¸ªç”¨æˆ·çš„æç¤º
```

### æ­¥éª¤ 5ï¼šå¯åŠ¨æœåŠ¡ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
# å¯åŠ¨åç«¯æœåŠ¡
python -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload

# çœ‹åˆ°ä»¥ä¸‹æç¤ºè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š
# INFO:     Uvicorn running on http://localhost:8000 (Press CTRL+C to quit)
```

### æ­¥éª¤ 6ï¼šè®¿é—® API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

---

## ğŸ¯ ç¬¬ä¸€ä¸ª API è°ƒç”¨

### ç™»å½•è·å– Token

ç³»ç»Ÿæä¾›ä¸¤ä¸ªè¶…çº§ç®¡ç†å‘˜è´¦å·ï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š

**ä¸»ç®¡ç†å‘˜**:
- ç”¨æˆ·åï¼š`yerui`
- å¯†ç ï¼š`ye123456`

**å¤‡ç”¨ç®¡ç†å‘˜**:
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

ä½¿ç”¨ cURL ç™»å½•ï¼ˆä»¥ yerui ä¸ºä¾‹ï¼‰ï¼š

**ä½¿ç”¨ cURL**:
```bash
# ä½¿ç”¨ä¸»ç®¡ç†å‘˜ yerui ç™»å½•
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"yerui","password":"ye123456"}'

# æˆ–ä½¿ç”¨å¤‡ç”¨ç®¡ç†å‘˜ admin ç™»å½•
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

**ä½¿ç”¨ Swagger UI**:
1. è®¿é—® http://localhost:8000/docs
2. æ‰¾åˆ° `/api/v1/auth/login` ç«¯ç‚¹
3. ç‚¹å‡» "Try it out"
4. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
5. ç‚¹å‡» "Execute"
6. å¤åˆ¶è¿”å›çš„ `access_token`

**å“åº”ç¤ºä¾‹**:
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "bearer",
  "user": {
    "id": "...",
    "username": "admin",
    "email": "admin@example.com",
    "role": "superuser"
  }
}
```

### åˆ›å»ºç¬¬ä¸€ä¸ªé¡¹ç›®

ä½¿ç”¨è·å–çš„ Token åˆ›å»ºé¡¹ç›®ï¼š

**ä½¿ç”¨ cURL**:
```bash
curl http://localhost:8000/api/v1/projects/ \
  -H "Authorization: Bearer <your_access_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®",
    "client": "æµ‹è¯•å®¢æˆ·",
    "location": "åŒ—äº¬",
    "type": "public_building",
    "status": "planning"
  }'
```

**ä½¿ç”¨ Swagger UI**:
1. ç‚¹å‡»å³ä¸Šè§’ "Authorize" æŒ‰é’®
2. è¾“å…¥ `Bearer <your_access_token>`ï¼ˆæ³¨æ„ Bearer åæœ‰ç©ºæ ¼ï¼‰
3. ç‚¹å‡» "Authorize"
4. æ‰¾åˆ° `/api/v1/projects/` ç«¯ç‚¹
5. ç‚¹å‡» "Try it out"
6. è¾“å…¥é¡¹ç›®ä¿¡æ¯
7. ç‚¹å‡» "Execute"

**å“åº”ç¤ºä¾‹**:
```json
{
  "id": "...",
  "name": "æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®",
  "client": "æµ‹è¯•å®¢æˆ·",
  "location": "åŒ—äº¬",
  "type": "public_building",
  "status": "planning",
  "created_at": "2026-01-25T10:00:00Z"
}
```

---

## ğŸ” ä¿®æ”¹é»˜è®¤å¯†ç 

âš ï¸ **é‡è¦**: ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

**ä½¿ç”¨ cURL**:
```bash
curl -X POST http://localhost:8000/api/v1/auth/me/change-password \
  -H "Authorization: Bearer <your_access_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "old_password": "admin123",
    "new_password": "your_new_secure_password"
  }'
```

**ä½¿ç”¨ Swagger UI**:
1. æ‰¾åˆ° `/api/v1/auth/me/change-password` ç«¯ç‚¹
2. ç‚¹å‡» "Try it out"
3. è¾“å…¥æ—§å¯†ç å’Œæ–°å¯†ç 
4. ç‚¹å‡» "Execute"

---

## ğŸ“± ä¸‹ä¸€æ­¥ä½“éªŒ

### ä½“éªŒé¡¹ç›®ç®¡ç†

- åˆ›å»ºå¤šä¸ªé¡¹ç›®
- æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨
- æ›´æ–°é¡¹ç›®ä¿¡æ¯
- åˆ é™¤é¡¹ç›®ï¼ˆæ”¯æŒè½¯åˆ é™¤å’Œæ¢å¤ï¼‰

### ä½“éªŒå·¥ç¨‹ç»“æ„

- åˆ›å»ºå»ºç­‘ï¼ˆBuildingï¼‰
- åˆ›å»ºåŒºåŸŸï¼ˆZoneï¼‰
- åˆ›å»ºç³»ç»Ÿï¼ˆSystemï¼‰
- åˆ›å»ºè®¾å¤‡ï¼ˆDeviceï¼‰

### ä½“éªŒå¤šæ¨¡æ€èµ„äº§

- ä¸Šä¼ å›¾ç‰‡èµ„äº§
- æŸ¥çœ‹ OCR è¯†åˆ«ç»“æœ
- æŸ¥çœ‹ GLM-4V åˆ†æç»“æœ
- ä¸Šä¼ è¡¨æ ¼èµ„äº§

### ä½“éªŒè®¤è¯ç³»ç»Ÿ

- åˆ›å»ºæ–°ç”¨æˆ·
- åˆ†é…è§’è‰²å’Œæƒé™
- æµ‹è¯•ä¸åŒè§’è‰²çš„æƒé™
- æŸ¥çœ‹å®¡è®¡æ—¥å¿—

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) could not connect to server
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ PostgreSQL æœåŠ¡æ˜¯å¦è¿è¡Œ
   ```bash
   # Windows
   sc query postgresql-x64-18

   # macOS/Linux
   sudo systemctl status postgresql
   ```

2. æ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“ URL æ˜¯å¦æ­£ç¡®
   ```bash
   BDC_DATABASE_URL=postgresql://admin:password@localhost:5432/bdc_ai
   ```

3. ç¡®è®¤æ•°æ®åº“å·²åˆ›å»º
   ```bash
   psql -U postgres -l
   ```

### é—®é¢˜ 2ï¼šä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
ERROR: Could not find a version that satisfies the requirement ...
```

**è§£å†³æ–¹æ¡ˆ**:
1. å‡çº§ pip
   ```bash
   pip install --upgrade pip
   ```

2. ä½¿ç”¨å›½å†…é•œåƒæº
   ```bash
   pip install -r services/backend/requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

### é—®é¢˜ 3ï¼šJWT å¯†é’¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
jose.exceptions.JWSError: Not enough segments
```

**è§£å†³æ–¹æ¡ˆ**:
æ£€æŸ¥ `.env` ä¸­çš„ JWT å¯†é’¥æ˜¯å¦è®¾ç½®ï¼š
```bash
BDC_JWT_SECRET_KEY=your-secret-key-change-in-production
```

ç”Ÿæˆå®‰å…¨çš„å¯†é’¥ï¼š
```bash
# macOS/Linux
openssl rand -hex 32

# Python
python -c "import secrets; print(secrets.token_hex(32))"
```

### é—®é¢˜ 4ï¼šç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**:
```
OSError: [Errno 48] Address already in use
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ›´æ¢ç«¯å£
   ```bash
   python -m uvicorn services.backend.app.main:app --host localhost --port 8001 --reload
   ```

2. æˆ–è€…åœæ­¢å ç”¨ 8000 ç«¯å£çš„è¿›ç¨‹
   ```bash
   # æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   lsof -i :8000

   # åœæ­¢è¿›ç¨‹
   kill -9 <PID>
   ```

### é—®é¢˜ 5ï¼šè®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
{"detail": "Incorrect username or password"}
```

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ä½¿ç”¨äº†æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç 
   - é»˜è®¤è´¦å·: `admin` / `admin123`

2. é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
   ```bash
   python scripts/init_auth_db.py
   ```

---

## ğŸ“š è¿›é˜¶å­¦ä¹ 

### å®Œæ•´è®¤è¯ç³»ç»ŸæŒ‡å—

ğŸ‘‰ **[è´¦å·æƒé™ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md](./è´¦å·æƒé™ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md)**

åŒ…å«å†…å®¹ï¼š
- Web API ä½¿ç”¨
- Python è„šæœ¬è°ƒç”¨
- Flutter ç§»åŠ¨ç«¯é›†æˆ
- NiceGUI PC ç«¯é›†æˆ
- ç”¨æˆ·å’Œæƒé™ç®¡ç†
- å¸¸è§åœºæ™¯ç¤ºä¾‹

### API å¼€å‘æŒ‡å—

ğŸ‘‰ **[åç«¯APIå¼€å‘æŒ‡å—.md](./åç«¯APIå¼€å‘æŒ‡å—.md)**ï¼ˆå¾…åˆ›å»ºï¼‰

### éƒ¨ç½²è¿ç»´æŒ‡å—

ğŸ‘‰ **[éƒ¨ç½²è¿ç»´æŒ‡å—.md](./éƒ¨ç½²è¿ç»´æŒ‡å—.md)**ï¼ˆå¾…åˆ›å»ºï¼‰

---

## ğŸ‰ æ­å–œ

ä½ å·²ç»æˆåŠŸå®Œæˆäº† BDC-AI çš„å¿«é€Ÿä½“éªŒï¼

**ä½ å­¦ä¼šçš„æŠ€èƒ½**:
- âœ… å®‰è£…å’Œé…ç½® BDC-AI
- âœ… å¯åŠ¨åç«¯æœåŠ¡
- âœ… è°ƒç”¨è®¤è¯ API
- âœ… åˆ›å»ºé¡¹ç›®
- âœ… ä¿®æ”¹å¯†ç 

**ä¸‹ä¸€æ­¥å»ºè®®**:
1. é˜…è¯» **[è´¦å·æƒé™ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md](./è´¦å·æƒé™ç³»ç»Ÿä½¿ç”¨æŒ‡å—.md)** æ·±å…¥å­¦ä¹ è®¤è¯ç³»ç»Ÿ
2. é˜…è¯» **[åç«¯APIå¼€å‘æŒ‡å—.md](./åç«¯APIå¼€å‘æŒ‡å—.md)** å­¦ä¹  API å¼€å‘ï¼ˆå¾…åˆ›å»ºï¼‰
3. é˜…è¯» **[é¡¹ç›®æ€»ç»“.md](../00-é¡¹ç›®æ€»è§ˆ/é¡¹ç›®æ€»ç»“.md)** äº†è§£é¡¹ç›®å…¨è²Œ

---

## ğŸ“ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ–‡æ¡£**: [docs/](../)
2. **æäº¤ Issue**: åœ¨é¡¹ç›®ä»“åº“æäº¤ Issue
3. **è”ç³»å›¢é˜Ÿ**: è”ç³» BDC-AI å¼€å‘å›¢é˜Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2026-01-25
**ç»´æŠ¤è€…**: BDC-AI å¼€å‘å›¢é˜Ÿ
