# BDC-AI 开发启动指南

## 快速启动

### 方式一：启动所有服务（推荐）

双击运行：`start_all.bat`

这会自动启动后端和 PC UI，每个服务在独立窗口中运行。

### 方式二：单独启动服务

**启动后端**：双击 `restart_backend.bat`
**启动 PC UI**：双击 `desktop\nicegui_app\restart_pc_ui.bat`

**停止所有服务**：双击 `stop_all.bat`

---

## 脚本说明

### 1. `start_all.bat` - 完整开发环境
- 自动停止旧进程
- 启动后端服务（端口 8000）
- 启动 PC UI（端口 8080）
- 每个服务在独立窗口中，方便查看日志

### 2. `restart_backend.bat` - 后端服务
- 自动检测并停止占用 8000 端口的进程
- 使用 `--reload` 参数，代码修改后自动重载
- 访问地址：http://localhost:8000/docs

### 3. `restart_pc_ui.bat` - PC UI 服务
- 自动检测并停止占用 8080 端口的进程
- NiceGUI 支持代码修改后自动刷新（按 F5 刷新浏览器）
- 访问地址：http://localhost:8080

### 4. `stop_all.bat` - 停止所有服务
- 一键停止所有 BDC-AI 相关进程
- 清理端口占用

---

## 开发工作流

### 修改 Python 代码（后端）

1. 后端使用 `--reload` 参数，保存文件后**自动重载**
2. 查看后端窗口的日志输出
3. 浏览器访问 http://localhost:8000/docs 测试 API

### 修改 Python 代码（PC UI）

1. PC UI 也支持自动重载（取决于实现）
2. 如果没有自动重载，**关闭 PC UI 窗口后双击 `restart_pc_ui.bat`**
3. 浏览器按 **F5** 刷新页面

### 修改 SQL 模型或配置

需要重启后端：
1. 关闭后端窗口（Ctrl+C 或关闭窗口）
2. 双击 `restart_backend.bat`

---

## 常见问题

### Q: 端口被占用怎么办？
A: 使用 `stop_all.bat` 清理所有进程，然后重新启动。

### Q: 两个进程监听同一端口？
A: 这通常是旧进程未完全释放导致的。使用 `stop_all.bat` 清理即可。

### Q: 修改代码后没有生效？
A:
- **后端**：查看后端窗口，应该显示 "Reloading..."，如果没有，手动重启
- **PC UI**：关闭窗口后重新运行 `restart_pc_ui.bat`，浏览器按 F5

### Q: 想要查看详细日志？
A: 服务在独立窗口中运行，所有日志都显示在对应窗口中。

---

## 手动管理（高级）

如果需要手动管理进程：

```bash
# 查看端口占用
netstat -ano | findstr ":8000"
netstat -ano | findstr ":8080"

# 停止指定进程
taskkill /F /PID <进程ID>

# 启动后端
python -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload

# 启动 PC UI
cd desktop\nicegui_app
python pc_app.py
```

---

## 访问地址

- **后端 API 文档**：http://localhost:8000/docs
- **PC UI 界面**：http://localhost:8080
- **API Root**：http://localhost:8000/api/v1
