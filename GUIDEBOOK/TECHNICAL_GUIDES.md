# æŠ€æœ¯è§£ææ–‡æ¡£

æœ¬æ–‡æ¡£é›†åˆç”¨äºæ·±å…¥è§£æé¡¹ç›®ä¸­å„ä¸ªæ¨¡å—çš„å·¥ä½œåŸç†ã€æŠ€æœ¯ç»†èŠ‚å’Œå®é™…åº”ç”¨ã€‚

---

## ç›®å½•

1. [Backend éª¨æ¶è¯¦è§£](#backend-éª¨æ¶è¯¦è§£)
   - [æ ¸å¿ƒç»„æˆ](#æ ¸å¿ƒç»„æˆ)
   - [ä¾èµ–åº“è¯¦è§£](#ä¾èµ–åº“è¯¦è§£)
   - [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
   - [ä»£ç å±‚é¢è§£æ](#ä»£ç å±‚é¢è§£æ)
   - [å®é™…åº”ç”¨åœºæ™¯](#å®é™…åº”ç”¨åœºæ™¯)
   - [éª¨æ¶çš„è§’è‰²å®šä½](#éª¨æ¶çš„è§’è‰²å®šä½)

2. [å¤šæ¨¡æ€æ•°æ®å¤„ç†è¯¦è§£](#å¤šæ¨¡æ€æ•°æ®å¤„ç†è¯¦è§£)
   - [æ ¸å¿ƒç»„æˆ](#æ ¸å¿ƒç»„æˆ-1)
   - [ä¾èµ–åº“è¯¦è§£](#ä¾èµ–åº“è¯¦è§£-1)
   - [OCR å›¾ç‰‡è¯†åˆ«æµç¨‹](#ocr-å›¾ç‰‡è¯†åˆ«æµç¨‹)
   - [ä»£ç å±‚é¢è§£æ](#ä»£ç å±‚é¢è§£æ-1)
   - [å®é™…åº”ç”¨åœºæ™¯](#å®é™…åº”ç”¨åœºæ™¯-1)
   - [å¸¸è§é—®é¢˜ä¸è§£å†³](#å¸¸è§é—®é¢˜ä¸è§£å†³)

---

# Backend éª¨æ¶è¯¦è§£

## ğŸ“– æ¦‚è¿°

Backend éª¨æ¶æ˜¯æ•´ä¸ª BDC-AI é¡¹ç›®çš„**åŸºç¡€è®¾æ–½å’Œæ ¸å¿ƒæ¡†æ¶**ï¼Œå°±åƒå»ºç­‘çš„åœ°åŸºå’Œæ¡†æ¶ï¼Œä¸ºæ‰€æœ‰ä¸šåŠ¡åŠŸèƒ½æä¾›æ”¯æ’‘ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… æä¾›ç¨³å®šçš„ Web æœåŠ¡èƒ½åŠ›
- âœ… æä¾›æ•°æ®åº“è¿æ¥å’Œ ORM æ”¯æŒ
- âœ… æä¾›é…ç½®ç®¡ç†å’Œç¯å¢ƒé€‚é…
- âœ… æä¾›è§„èŒƒçš„ä»£ç ç»“æ„
- âœ… æ”¯æŒå¿«é€Ÿæ‰©å±•æ–°åŠŸèƒ½

---

## æ ¸å¿ƒç»„æˆ

### é¡¹ç›®ç»“æ„

```
services/backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£ï¼ˆæ€»ç»ç†ï¼‰
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ v1/
â”‚           â””â”€â”€ health.py    # API è·¯ç”±ï¼ˆæœåŠ¡å‘˜ï¼‰
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–æ¸…å•
â””â”€â”€

shared/                      # å…±äº«èµ„æºåº“
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py          # é…ç½®ä¸­å¿ƒ
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ base.py              # æ•°æ®åº“åœ°åŸºï¼ˆORM åŸºç±»ï¼‰
â”‚   â””â”€â”€ session.py           # æ•°æ®åº“è¿æ¥æ± 
â””â”€â”€ utils/                   # å·¥å…·ç®±ï¼ˆå¾…å¼€å‘ï¼‰
```

### ç»„ä»¶èŒè´£

| ç»„ä»¶ | æ–‡ä»¶ | èŒè´£ | ç±»æ¯” |
|------|------|------|------|
| Web æ¡†æ¶ | main.py | ç»Ÿç­¹å…¨å±€ï¼Œç®¡ç†è·¯ç”± | æ€»ç»ç† |
| API è·¯ç”± | health.py | å¤„ç†å…·ä½“è¯·æ±‚ | æœåŠ¡å‘˜ |
| é…ç½®ç®¡ç† | settings.py | ç®¡ç†ç¯å¢ƒé…ç½® | é…ç½®ä¸­å¿ƒ |
| æ•°æ®åº“åŸºç±» | base.py | ORM å£°æ˜å¼åŸºç±» | èŠ±åå†Œæ¨¡æ¿ |
| ä¼šè¯ç®¡ç† | session.py | æ•°æ®åº“è¿æ¥æ±  | è¿æ¥æ± ç®¡ç†å™¨ |

---

## ä¾èµ–åº“è¯¦è§£

### requirements.txt

```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
```

### 1. FastAPI - Web æ¡†æ¶

**ä½œç”¨**ï¼šæä¾› Web æœåŠ¡çš„åŸºç¡€æ¶æ„

**é€šä¿—ç†è§£**ï¼šå°±åƒé¤å…çš„**å»ºç­‘è®¾è®¡å›¾**

```
FastAPI æä¾›ï¼š
â”œâ”€â”€ è·¯ç”±ç³»ç»Ÿï¼šå“ªä¸ªåœ°å€å¯¹åº”å“ªä¸ªåŠŸèƒ½
â”œâ”€â”€ è¯·æ±‚å¤„ç†ï¼šæ¥æ”¶å®¢æˆ·è®¢å•
â”œâ”€â”€ å“åº”æ ¼å¼ï¼šè§„èŒƒè¿”å›æ•°æ®
â”œâ”€â”€ æ•°æ®éªŒè¯ï¼šæ£€æŸ¥è®¢å•æ˜¯å¦åˆæ³•
â””â”€â”€ è‡ªåŠ¨æ–‡æ¡£ï¼šè‡ªåŠ¨ç”Ÿæˆèœå•ï¼ˆSwagger UIï¼‰
```

**ä»£ç ç¤ºä¾‹**ï¼š

```python
from fastapi import FastAPI

app = FastAPI(title="BDC-AI Backend", version="0.1.0")

@app.get("/api/v1/health/")
async def health_check():
    return {"status": "ok"}

# FastAPI è‡ªåŠ¨å¸®ä½ åšï¼š
# âœ“ ç›‘å¬ /api/v1/health/ è¿™ä¸ªåœ°å€
# âœ“ æ”¶åˆ°è¯·æ±‚æ—¶è°ƒç”¨ health_check å‡½æ•°
# âœ“ æŠŠè¿”å›çš„å­—å…¸è½¬æˆ JSON æ ¼å¼
# âœ“ åŠ ä¸Šæ­£ç¡®çš„ HTTP å¤´
# âœ“ è®°å½•è¯·æ±‚æ—¥å¿—
```

### 2. Uvicorn - ASGI æœåŠ¡å™¨

**ä½œç”¨**ï¼šå®é™…è¿è¡Œ Web æœåŠ¡çš„æœåŠ¡å™¨

**é€šä¿—ç†è§£**ï¼šå°±åƒé¤å…çš„**å®ä½“å¨æˆ¿å’Œå¨å¸ˆ**

```
Uvicorn æä¾›ï¼š
â”œâ”€â”€ ç›‘å¬ç«¯å£ï¼šç›¸å½“äº"å¼€é—¨è¥ä¸š"
â”œâ”€â”€ æ¥æ”¶è¿æ¥ï¼šç›¸å½“äº"æ¥å¾…å®¢äºº"
â”œâ”€â”€ å¤„ç†è¯·æ±‚ï¼šç›¸å½“äº"åšèœ"
â”œâ”€â”€ è¿”å›å“åº”ï¼šç›¸å½“äº"ä¸Šèœ"
â””â”€â”€ å¹¶å‘å¤„ç†ï¼šå¯ä»¥åŒæ—¶æ¥å¾…å¤šä¸ªå®¢äºº
```

**ç±»æ¯”**ï¼š
```
FastAPI = é¤å…è®¾è®¡å›¾ï¼ˆçº¸ä¸Šè°ˆå…µï¼‰
Uvicorn = çœŸæ­£çš„å¨æˆ¿ï¼ˆå®é™…å¹²æ´»ï¼‰

å…‰æœ‰è®¾è®¡å›¾æ²¡æ³•è¥ä¸šï¼Œå¿…é¡»æŠŠå¨æˆ¿å»ºèµ·æ¥ã€è¯·å¨å¸ˆã€å¼€ç«
æ‰èƒ½çœŸæ­£æ¥å¾…å®¢äºº
```

**å¯åŠ¨å‘½ä»¤**ï¼š

```bash
python -m uvicorn services.backend.app.main:app --host localhost --port 8000 --reload

# è¿™ä¸ªå‘½ä»¤åšäº†ä»€ä¹ˆï¼š
# 1. æ‰¾åˆ° FastAPI åº”ç”¨ï¼šservices.backend.app.main:app
# 2. åœ¨ localhost çš„ 8000 ç«¯å£å¼€åº—
# 3. å¼€å§‹ç›‘å¬ï¼Œç­‰å¾…å®¢äººï¼ˆç”¨æˆ·è¯·æ±‚ï¼‰
# 4. æ”¶åˆ°è¯·æ±‚åï¼ŒæŒ‰ç…§ FastAPI å®šä¹‰çš„å¤„ç†
# 5. å¤„ç†å®Œè¿”å›ç»“æœ

# --reloadï¼šä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡å¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
```

### 3. SQLAlchemy - ORM å·¥å…·

**ä½œç”¨**ï¼šPython å¯¹è±¡ä¸æ•°æ®åº“ä¹‹é—´çš„ç¿»è¯‘å®˜

**é€šä¿—ç†è§£**ï¼šå°±åƒ**æ•°æ®åº“ç¿»è¯‘å®˜**

```
SQLAlchemy æä¾›ï¼š
â”œâ”€â”€ Python ç±» â†’ æ•°æ®åº“è¡¨ï¼ˆç¿»è¯‘ï¼‰
â”œâ”€â”€ Python å¯¹è±¡ â†’ æ•°æ®åº“è®°å½•ï¼ˆç¿»è¯‘ï¼‰
â”œâ”€â”€ Python æ“ä½œ â†’ SQL è¯­å¥ï¼ˆç¿»è¯‘ï¼‰

ç±»æ¯”ï¼š
ä½ ï¼ˆPython ç¨‹åºå‘˜ï¼‰ï¼šåªä¼šè¯´ Python
æ•°æ®åº“ï¼ˆPostgreSQLï¼‰ï¼šåªå¬å¾—æ‡‚ SQL
SQLAlchemyï¼ˆç¿»è¯‘å®˜ï¼‰ï¼šäº’ç›¸ç¿»è¯‘
```

**ä»£ç å¯¹æ¯”**ï¼š

```python
# âŒ æ²¡æœ‰ SQLAlchemyï¼ˆæ‰‹åŠ¨å†™ SQLï¼‰ï¼š
import psycopg2

def create_project(name, location):
    conn = psycopg2.connect(...)
    cursor = conn.cursor()

    # æ‰‹å†™ SQLï¼ˆå®¹æ˜“å‡ºé”™ï¼‰
    sql = """
        INSERT INTO projects (name, location, created_at)
        VALUES (%s, %s, NOW())
        RETURNING id
    """
    cursor.execute(sql, (name, location))
    project_id = cursor.fetchone()[0]
    conn.commit()
    return project_id

# âœ“ æœ‰ SQLAlchemyï¼ˆç”¨ Python å¯¹è±¡ï¼‰ï¼š
from shared.db.session import SessionLocal
from shared.db.models import Project

def create_project(name, location):
    db = SessionLocal()
    project = Project(name=name, location=location)
    db.add(project)
    db.commit()
    db.refresh(project)
    return project.id
```

---

## å·¥ä½œæµç¨‹

### å®Œæ•´è¯·æ±‚å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰                           â”‚
â”‚                  è®¿é—® http://localhost:8000/api/v1/health/  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 1. HTTP è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Uvicorn æœåŠ¡å™¨ï¼ˆç›‘å¬ 8000 ç«¯å£ï¼‰                â”‚
â”‚  å·¥ä½œï¼šç›‘å¬ç«¯å£ï¼Œç­‰å¾…è¯·æ±‚ï¼Œæ”¶åˆ°åè½¬äº¤ç»™ FastAPI              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 2. ä¼ é€’è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FastAPI åº”ç”¨ï¼ˆmain.py ä¸­çš„ appï¼‰                â”‚
â”‚  å·¥ä½œï¼šæŸ¥çœ‹è·¯ç”±è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 3. è°ƒç”¨å¤„ç†å‡½æ•°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          health.py ä¸­çš„ health_check() å‡½æ•°                  â”‚
â”‚  å·¥ä½œï¼šæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ç»“æœå­—å…¸                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 4. è¿”å›ç»“æœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI åº”ç”¨                              â”‚
â”‚  å·¥ä½œï¼šè½¬æˆ JSONï¼Œæ·»åŠ çŠ¶æ€ç å’Œå“åº”å¤´                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 5. HTTP å“åº”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æµè§ˆå™¨                                 â”‚
â”‚              æ˜¾ç¤ºï¼š{"status":"ok"}                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¶é—´çº¿

```
T0: ç”¨æˆ·åœ¨æµè§ˆå™¨è¾“å…¥ URL å¹¶å›è½¦
T1: Uvicorn æ”¶åˆ° HTTP è¯·æ±‚
T2: FastAPI æŸ¥æ‰¾è·¯ç”±å¤„ç†å™¨
T3: è°ƒç”¨ health_check() å‡½æ•°
T4: health_check() è¿”å› {"status":"ok"}
T5: FastAPI æ„é€  HTTP å“åº”
T6: Uvicorn å‘é€å“åº”ç»™æµè§ˆå™¨

æ€»è€—æ—¶ï¼šé€šå¸¸ < 10 æ¯«ç§’
```

---

## ä»£ç å±‚é¢è§£æ

### 1. main.py - åº”ç”¨å…¥å£

**ä½ç½®**ï¼š`services/backend/app/main.py`

**ä»£ç **ï¼š

```python
from fastapi import FastAPI
from .api.v1 import health

# åˆ›å»º FastAPI åº”ç”¨å®ä¾‹
# å°±åƒæ³¨å†Œä¸€å®¶å…¬å¸ï¼Œé¢†å–è¥ä¸šæ‰§ç…§
app = FastAPI(title="BDC-AI Backend", version="0.1.0")

# æ³¨å†Œè·¯ç”±ï¼ˆæŒ‚è½½æœåŠ¡å°ï¼‰
# å°±åƒåœ¨å…¬å¸å¤§å…è®¾ç½®æœåŠ¡å°
app.include_router(
    health.router,           # å“ªä¸ªæœåŠ¡å°
    prefix="/api/v1/health", # åœ¨å“ªä¸ªä½ç½®
    tags=["health"]          # æœåŠ¡ç±»å‹æ ‡ç­¾
)

# æ ¹è·¯å¾„å¤„ç†
@app.get("/")
async def read_root() -> dict:
    return {"status": "ok"}
```

**æ‰§è¡Œè¿‡ç¨‹**ï¼š

```
å¯åŠ¨æ—¶ï¼š
1. FastAPI() åˆ›å»ºåº”ç”¨å¯¹è±¡
   â†’ åˆ›å»º"è·¯ç”±è¡¨"ï¼ˆç©ºçš„ï¼‰

2. app.include_router(health.router, ...)
   â†’ æŠŠ health.py çš„è·¯ç”±æ·»åŠ åˆ°è·¯ç”±è¡¨
   â†’ è·¯ç”±è¡¨ç°åœ¨æœ‰ï¼š
   â”œâ”€â”€ /api/v1/health/ â†’ health_check()
   â””â”€â”€ / â†’ read_root()

3. Uvicorn å¯åŠ¨ï¼Œå¼€å§‹ç›‘å¬ç«¯å£

è¿è¡Œæ—¶ï¼š
1. ç”¨æˆ·è®¿é—® http://localhost:8000/api/v1/health/
2. Uvicorn æ”¶åˆ°è¯·æ±‚ï¼Œäº¤ç»™ FastAPI
3. FastAPI æŸ¥è·¯ç”±è¡¨ï¼šæ‰¾åˆ°äº†ï¼æ˜¯ health_check()
4. è°ƒç”¨ health_check()
5. æ”¶åˆ°è¿”å›å€¼ {"status": "ok"}
6. è½¬æˆ JSONï¼Œå‘é€ç»™ç”¨æˆ·
```

**å…³é”®æ¦‚å¿µ**ï¼š

- **Routerï¼ˆè·¯ç”±å™¨ï¼‰**ï¼šç»„ç»‡ç›¸å…³ API ç«¯ç‚¹çš„å·¥å…·
- **Prefixï¼ˆå‰ç¼€ï¼‰**ï¼šURL è·¯å¾„å‰ç¼€ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†
- **Tagsï¼ˆæ ‡ç­¾ï¼‰**ï¼šç”¨äº API æ–‡æ¡£åˆ†ç»„

### 2. health.py - API è·¯ç”±

**ä½ç½®**ï¼š`services/backend/app/api/v1/health.py`

**ä»£ç **ï¼š

```python
from fastapi import APIRouter

# åˆ›å»ºè·¯ç”±å™¨
# å°±åƒåœ¨æœåŠ¡å°å®‰è£…ä¸€ä¸ªåˆ†æœº
router = APIRouter()

# å®šä¹‰å¤„ç†å‡½æ•°
@router.get("/", summary="Health check")
async def health_check() -> dict:
    return {"status": "ok"}
```

**è£…é¥°å™¨è¯¦è§£**ï¼š

```python
@router.get("/", summary="Health check")
#         â†‘      â†‘
#         â”‚      â””â”€â”€ æ–‡æ¡£è¯´æ˜ï¼ˆåœ¨ /docs æ˜¾ç¤ºï¼‰
#         â””â”€â”€ HTTP æ–¹æ³• + è·¯å¾„

# ç­‰ä»·äºï¼š
# "å¦‚æœæœ‰äººç”¨ GET æ–¹æ³•è®¿é—®è¿™ä¸ªè·¯å¾„ï¼Œå°±è°ƒç”¨è¿™ä¸ªå‡½æ•°"
```

**async çš„ä½œç”¨**ï¼š

```python
async def health_check():
    # å¼‚æ­¥å‡½æ•°
    # ä¼˜åŠ¿ï¼šå¯ä»¥å¤„ç†å¹¶å‘è¯·æ±‚
    # åœºæ™¯ï¼š100ä¸ªäººåŒæ—¶è®¿é—®å¥åº·æ£€æŸ¥
    #       å¼‚æ­¥ï¼šå¯ä»¥åŒæ—¶å¤„ç†
    #       åŒæ­¥ï¼šè¦æ’é˜Ÿï¼Œä¸€ä¸ªä¸€ä¸ªå¤„ç†
```

### 3. settings.py - é…ç½®ç®¡ç†

**ä½ç½®**ï¼š`shared/config/settings.py`

**ä»£ç **ï¼š

```python
import os
from functools import lru_cache

class Settings:
    def __init__(self) -> None:
        # ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨é»˜è®¤å€¼
        self.database_url = os.getenv(
            "BDC_DATABASE_URL",
            "postgresql://admin:password@localhost:5432/bdc_ai"
        )
        self.minio_endpoint = os.getenv("BDC_MINIO_ENDPOINT", "localhost:9000")

# ä½¿ç”¨ lru_cache è£…é¥°å™¨å®ç°å•ä¾‹æ¨¡å¼
@lru_cache()
def get_settings() -> Settings:
    return Settings()
```

**ä¸ºä»€ä¹ˆç”¨ lru_cacheï¼Ÿ**

```python
# æ²¡æœ‰ cacheï¼š
settings1 = Settings()  # åˆ›å»ºå¯¹è±¡1
settings2 = Settings()  # åˆ›å»ºå¯¹è±¡2
# é—®é¢˜ï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡ï¼Œæµªè´¹å†…å­˜

# æœ‰ cacheï¼š
settings1 = get_settings()  # åˆ›å»ºå¯¹è±¡ï¼Œç¼“å­˜
settings2 = get_settings()  # è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼ˆåŒä¸€ä¸ªï¼‰
# å¥½å¤„ï¼šå…¨å±€å”¯ä¸€ï¼ŒèŠ‚çœèµ„æºï¼Œé…ç½®ä¸€è‡´
```

**å®é™…ä½¿ç”¨**ï¼š

```python
from shared.config.settings import get_settings

settings = get_settings()
print(settings.database_url)
# â†’ "postgresql://admin:password@localhost:5432/bdc_ai"

# ä¿®æ”¹ç¯å¢ƒå˜é‡åé‡å¯ï¼š
# è®¾ç½® BDC_DATABASE_URL=æ–°åœ°å€
# é‡å¯ç¨‹åºï¼Œè‡ªåŠ¨è¯»å–æ–°é…ç½®
```

### 4. base.py - æ•°æ®åº“åŸºç±»

**ä½ç½®**ï¼š`shared/db/base.py`

**ä»£ç **ï¼š

```python
from sqlalchemy.orm import declarative_base

# åˆ›å»ºå£°æ˜å¼åŸºç±»
# å°±åƒå‡†å¤‡ä¸€æœ¬"èŠ±åå†Œæ¨¡æ¿"
Base = declarative_base()
```

**Base çš„ä½œç”¨**ï¼š

```python
# Base æ˜¯æ‰€æœ‰æ•°æ®æ¨¡å‹çš„"çˆ¶ç±»"

# å°†æ¥åˆ›å»ºæ•°æ®æ¨¡å‹æ—¶ï¼š
from shared.db.base import Base
from sqlalchemy import Column, Integer, String

class Project(Base):  # ç»§æ‰¿ Base
    __tablename__ = "projects"  # è¡¨å

    id = Column(Integer, primary_key=True)
    name = Column(String(100))
    location = Column(String(200))

# Base ä¼šè‡ªåŠ¨ï¼š
# 1. è®°å½•è¿™ä¸ªç±»ï¼ˆProjectï¼‰
# 2. æŠŠå®ƒå’Œæ•°æ®åº“è¡¨ï¼ˆprojectsï¼‰å…³è”
# 3. æä¾› create_all() ç­‰æ–¹æ³•
# 4. æä¾› ORM æ˜ å°„ï¼ˆå¯¹è±¡ â†’ è¡¨è®°å½•ï¼‰
```

**å®é™…ä½¿ç”¨**ï¼š

```python
# åˆ›å»ºæ‰€æœ‰è¡¨
from shared.db.base import Base
from shared.db.session import engine

Base.metadata.create_all(bind=engine)
# â†’ è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰ç»§æ‰¿ Base çš„ç±»å¯¹åº”çš„è¡¨

# ç›¸å½“äºæ‰§è¡Œ SQLï¼š
# CREATE TABLE projects (
#     id SERIAL PRIMARY KEY,
#     name VARCHAR(100),
#     location VARCHAR(200)
# );
```

### 5. session.py - æ•°æ®åº“ä¼šè¯

**ä½ç½®**ï¼š`shared/db/session.py`

**ä»£ç **ï¼š

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from shared.config.settings import get_settings

settings = get_settings()

# åˆ›å»ºå¼•æ“
engine = create_engine(settings.database_url, future=True)
#                            â†‘
#                            future=True: å¯ç”¨ SQLAlchemy 2.0 æ–°ç‰¹æ€§

# åˆ›å»ºä¼šè¯å·¥å‚
SessionLocal = sessionmaker(
    bind=engine,
    autocommit=False,   # ä¸è‡ªåŠ¨æäº¤ï¼ˆéœ€è¦æ‰‹åŠ¨ commitï¼‰
    autoflush=False,    # ä¸è‡ªåŠ¨åˆ·æ–°
    future=True         # SQLAlchemy 2.0 æ¨¡å¼
)

# ä¾èµ–æ³¨å…¥å‡½æ•°
def get_db() -> Generator:
    db = SessionLocal()  # åˆ›å»ºä¼šè¯ï¼ˆä»è¿æ¥æ± æ‹¿ä¸€ä¸ªè¿æ¥ï¼‰
    try:
        yield db         # æä¾›ç»™ä½¿ç”¨
    finally:
        db.close()       # ç”¨å®Œåå½’è¿˜è¿æ¥æ± 
```

**Engineï¼ˆå¼•æ“ï¼‰çš„å·¥ä½œåŸç†**ï¼š

```python
engine = create_engine("postgresql://...", pool_size=5, max_overflow=10)
#                                              â†‘            â†‘
#                                          è¿æ¥æ± å¤§å°    æœ€å¤§æº¢å‡º

# å¼•æ“ç»´æŠ¤ä¸€ä¸ªè¿æ¥æ± ï¼š
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ è¿æ¥1   â”‚ è¿æ¥2   â”‚ è¿æ¥3   â”‚ è¿æ¥4   â”‚ è¿æ¥5   â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# å½“ä½ è°ƒç”¨ SessionLocal()ï¼š
# â†’ ä»æ± å­é‡Œæ‹¿ä¸€ä¸ªç©ºé—²è¿æ¥ç»™ä½ 
#
# å½“ä½ è°ƒç”¨ db.close()ï¼š
# â†’ æŠŠè¿æ¥å½’è¿˜æ± å­ï¼Œç»™å…¶ä»–äººç”¨
```

**è¿æ¥æ± çš„ä¼˜åŠ¿**ï¼š

```
âŒ æ¯æ¬¡åˆ›å»ºæ–°è¿æ¥ï¼š
def get_project(project_id):
    conn = create_connection()  # åˆ›å»ºè¿æ¥ï¼ˆè€—æ—¶ï¼Œçº¦100msï¼‰
    result = conn.query(...)
    conn.close()
# é—®é¢˜ï¼šé¢‘ç¹åˆ›å»º/å…³é—­è¿æ¥ï¼Œå¾ˆæ…¢

âœ“ ä½¿ç”¨è¿æ¥æ± ï¼š
engine = create_engine(..., pool_size=5)
# â†’ å¯åŠ¨æ—¶åˆ›å»º5ä¸ªè¿æ¥
# â†’ åç»­å¤ç”¨è¿™äº›è¿æ¥

def get_project(project_id):
    db = SessionLocal()  # ä»æ± ä¸­æ‹¿è¿æ¥ï¼ˆå¿«ï¼Œçº¦1msï¼‰
    result = db.query(...)
    db.close()
# å¥½å¤„ï¼šä¸ç”¨é¢‘ç¹åˆ›å»ºï¼Œæ€§èƒ½æå‡100å€
```

**ä¾èµ–æ³¨å…¥å·¥ä½œåŸç†**ï¼š

```python
from fastapi import Depends
from shared.db.session import get_db
from sqlalchemy.orm import Session

@app.get("/api/v1/projects/{project_id}")
def get_project(project_id: int, db: Session = Depends(get_db)):
    #                    â†‘
    #                    FastAPI è‡ªåŠ¨è°ƒç”¨ get_db()
    #                    æŠŠè¿”å›çš„ db æ³¨å…¥åˆ°è¿™é‡Œ

    project = db.query(Project).filter(Project.id == project_id).first()
    return project

# æ‰§è¡Œæµç¨‹ï¼š
# 1. æ”¶åˆ°è¯·æ±‚ï¼šGET /api/v1/projects/123
# 2. FastAPI çœ‹åˆ° db: Session = Depends(get_db)
# 3. è°ƒç”¨ get_db()ï¼š
#    â†’ db = SessionLocal()
#    â†’ yield db
# 4. æ‰§è¡Œ get_project(project_id=123, db=<åˆšæ‰çš„db>)
# 5. å‡½æ•°æ‰§è¡Œå®Œ
# 6. FastAPI è‡ªåŠ¨æ‰§è¡Œ db.close()ï¼ˆfinally å—ï¼‰
```

---

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæŸ¥è¯¢é¡¹ç›®åˆ—è¡¨

**ç›®æ ‡**ï¼šåˆ›å»º API ç«¯ç‚¹è¿”å›æ‰€æœ‰é¡¹ç›®åˆ—è¡¨

**å®Œæ•´å®ç°**ï¼š

```python
# 1. å®šä¹‰æ•°æ®æ¨¡å‹
# shared/db/models/project.py

from sqlalchemy import Column, Integer, String, DateTime
from shared.db.base import Base

class Project(Base):
    __tablename__ = "projects"

    id = Column(Integer, primary_key=True)
    name = Column(String(100), nullable=False)
    location = Column(String(200))
    created_at = Column(DateTime, server_default="NOW()")

# 2. å®šä¹‰ API è·¯ç”±
# services/backend/app/api/v1/projects.py

from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from shared.db.session import get_db
from shared.db.models.project import Project

router = APIRouter()

@router.get("/")
def list_projects(db: Session = Depends(get_db)):
    # æŸ¥è¯¢æ‰€æœ‰é¡¹ç›®
    projects = db.query(Project).all()

    # è¿”å›åˆ—è¡¨
    return [
        {
            "id": p.id,
            "name": p.name,
            "location": p.location,
            "created_at": p.created_at
        }
        for p in projects
    ]

# 3. æ³¨å†Œè·¯ç”±
# services/backend/app/main.py

from .api.v1 import projects

app.include_router(
    projects.router,
    prefix="/api/v1/projects",
    tags=["projects"]
)
```

**è¯·æ±‚æµç¨‹**ï¼š

```
ç”¨æˆ·æ“ä½œï¼š
1. æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8000/api/v1/projects/

åå°å¤„ç†ï¼š
2. Uvicorn æ”¶åˆ° GET /api/v1/projects/
3. â†’ FastAPI è·¯ç”±åŒ¹é…ï¼šæ‰¾åˆ° list_projects()
4. â†’ çœ‹åˆ° db: Session = Depends(get_db)
5. â†’ è°ƒç”¨ get_db()ï¼šä»è¿æ¥æ± æ‹¿è¿æ¥
6. â†’ è°ƒç”¨ list_projects(db=<è¿æ¥>)
7.     â†’ db.query(Project).all()
8.     â†’ SQLAlchemy ç¿»è¯‘æˆ SQLï¼šSELECT * FROM projects
9.     â†’ å‘é€åˆ°æ•°æ®åº“
10.    â†’ æ•°æ®åº“è¿”å›ç»“æœ
11.    â†’ SQLAlchemy è½¬æˆ Python å¯¹è±¡åˆ—è¡¨
12. â†’ FastAPI è½¬æˆ JSON
13. â†’ Uvicorn å‘é€å“åº”

ç”¨æˆ·çœ‹åˆ°ï¼š
14. [{"id":1,"name":"é¡¹ç›®A",...}, {"id":2,"name":"é¡¹ç›®B",...}]
```

### åœºæ™¯ 2ï¼šåˆ›å»ºé¡¹ç›®å¹¶ä¸Šä¼ æ–‡ä»¶

**ç›®æ ‡**ï¼šåˆ›å»ºé¡¹ç›®å¹¶ä¸Šä¼ ç›¸å…³èµ„æ–™åˆ°å¯¹è±¡å­˜å‚¨

**å®Œæ•´å®ç°**ï¼š

```python
# services/backend/app/api/v1/assets.py

from fastapi import APIRouter, Depends, UploadFile, File, HTTPException
from sqlalchemy.orm import Session
from shared.db.session import get_db
from shared.db.models.project import Project
from shared.db.models.asset import Asset
from shared.config.settings import get_settings
import minio

router = APIRouter()
settings = get_settings()

@router.post("/upload")
async def upload_asset(
    project_id: int,
    file: UploadFile = File(...),
    db: Session = Depends(get_db)
):
    # æ­¥éª¤ 1ï¼šéªŒè¯é¡¹ç›®æ˜¯å¦å­˜åœ¨ï¼ˆæ•°æ®åº“æ“ä½œï¼‰
    project = db.query(Project).filter(Project.id == project_id).first()
    if not project:
        raise HTTPException(status_code=404, detail="é¡¹ç›®ä¸å­˜åœ¨")

    # æ­¥éª¤ 2ï¼šä¸Šä¼ æ–‡ä»¶åˆ° MinIOï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰
    client = minio.Minio(
        settings.minio_endpoint,
        access_key="minioadmin",
        secret_key="minioadmin"
    )

    file_path = f"projects/{project_id}/{file.filename}"
    client.put_object(
        "bdc-assets",           # æ¡¶å
        file_path,              # å­˜å‚¨è·¯å¾„
        file.file,              # æ–‡ä»¶å†…å®¹
        length=file.size
    )

    # æ­¥éª¤ 3ï¼šåˆ›å»ºèµ„äº§è®°å½•ï¼ˆæ•°æ®åº“æ“ä½œï¼‰
    asset = Asset(
        project_id=project_id,
        file_path=file_path,
        modality="image",
        status="uploaded"
    )
    db.add(asset)
    db.commit()
    db.refresh(asset)

    # æ­¥éª¤ 4ï¼šè¿”å›ç»“æœ
    return {
        "asset_id": asset.id,
        "file_url": f"http://minio:9000/bdc-assets/{file_path}",
        "project_id": project_id
    }
```

**éª¨æ¶å¦‚ä½•åè°ƒå„ä¸ªç»„ä»¶**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¯·æ±‚æµç¨‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¯·æ±‚ï¼ˆä¸Šä¼ æ–‡ä»¶ï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI (æ¡†æ¶å±‚)                                        â”‚
â”‚  â€¢ æ¥æ”¶æ–‡ä»¶ä¸Šä¼                                           â”‚
â”‚  â€¢ éªŒè¯å‚æ•°                                              â”‚
â”‚  â€¢ è°ƒç”¨å¤„ç†å‡½æ•°                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é€»è¾‘å±‚                                              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æ­¥éª¤1:       â”‚ æ­¥éª¤2:       â”‚ æ­¥éª¤3:       â”‚        â”‚
â”‚  â”‚ æŸ¥è¯¢æ•°æ®åº“   â”‚ ä¸Šä¼ æ–‡ä»¶     â”‚ ä¿å­˜è®°å½•     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â†“              â†“              â†“                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“              â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ•°æ®åº“   â”‚   â”‚ MinIO    â”‚   â”‚ æ•°æ®åº“   â”‚
    â”‚ (SQL     â”‚   â”‚ (å¯¹è±¡    â”‚   â”‚ (SQL     â”‚
    â”‚ Alchemy) â”‚   â”‚  å­˜å‚¨)   â”‚   â”‚ Alchemy) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“              â†“              â†“
    éª¨æ¶æä¾›ï¼š
    â€¢ session.py    â€¢ settings.py   â€¢ session.py
      æä¾›           é…ç½®             æä¾›
      æ•°æ®åº“è¿æ¥     MinIOåœ°å€        æ•°æ®åº“è¿æ¥
```

---

## éª¨æ¶çš„è§’è‰²å®šä½

### è§’è‰² 1ï¼šæ¡†æ¶ - æä¾›ç»“æ„å’Œè§„èŒƒ

```
å°±åƒç›–æˆ¿å­çš„æ¡†æ¶ï¼š
â”œâ”€â”€ è§„å®šå“ªé‡Œæ˜¯æ‰¿é‡å¢™ï¼ˆä¸èƒ½ä¹±æ”¹ï¼‰
â”œâ”€â”€ è§„å®šå“ªé‡Œæ˜¯é—¨ï¼ˆè¿æ¥å¤–ç•Œï¼‰
â”œâ”€â”€ è§„å®šå“ªé‡Œæ˜¯çª—ï¼ˆé‡‡å…‰é€šé£ï¼‰
â””â”€â”€ ä¿è¯æˆ¿å­ç»“æ„ç¨³å›º

FastAPI + Uvicorn = Web æœåŠ¡æ¡†æ¶ï¼š
â”œâ”€â”€ è§„å®šè¯·æ±‚æ€ä¹ˆæ¥æ”¶ï¼ˆè·¯ç”±ç³»ç»Ÿï¼‰
â”œâ”€â”€ è§„å®šå“åº”æ€ä¹ˆè¿”å›ï¼ˆJSON æ ¼å¼ï¼‰
â”œâ”€â”€ è§„å®šé”™è¯¯æ€ä¹ˆå¤„ç†ï¼ˆå¼‚å¸¸æœºåˆ¶ï¼‰
â””â”€â”€ ä¿è¯æœåŠ¡ç¨³å®šè¿è¡Œ
```

### è§’è‰² 2ï¼šè¿æ¥å™¨ - è¿æ¥å„ä¸ªç»„ä»¶

```
å°±åƒæ°´ç”µç®¡ç½‘è¿æ¥å„ä¸ªæˆ¿é—´ï¼š
â”œâ”€â”€ æ°´ç®¡è¿æ¥å¨æˆ¿å’Œæµ´å®¤
â”œâ”€â”€ ç”µçº¿è¿æ¥å„ä¸ªæˆ¿é—´å’Œæ’åº§
â”œâ”€â”€ ç½‘çº¿è¿æ¥å„ä¸ªè®¾å¤‡

éª¨æ¶è¿æ¥ï¼š
â”œâ”€â”€ settings.py â”€â”€â”€â”€â”€â”
â”‚   é…ç½®æ•°æ®         â”œâ”€â”€â†’ è¿æ¥é…ç½®å’Œä»£ç 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”œâ”€â”€ session.py â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åº“ä¼šè¯       â”œâ”€â”€â†’ è¿æ¥ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åº“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”œâ”€â”€ base.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ORM åŸºç±»         â”œâ”€â”€â†’ è¿æ¥ Python ç±»å’Œæ•°æ®åº“è¡¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”œâ”€â”€ main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å…¥å£         â”œâ”€â”€â†’ è¿æ¥å„ä¸ªè·¯ç”±æ¨¡å—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§’è‰² 3ï¼šåŸºç¡€è®¾æ–½ - æä¾›åŸºç¡€èƒ½åŠ›

```
å°±åƒåŸå¸‚çš„åŸºç¡€è®¾æ–½ï¼š
â”œâ”€â”€ é“è·¯ï¼šæä¾›é€šè¡Œèƒ½åŠ›
â”œâ”€â”€ æ°´ç”µï¼šæä¾›èƒ½æºä¾›åº”
â”œâ”€â”€ é€šä¿¡ï¼šæä¾›ä¿¡æ¯ä¼ è¾“

éª¨æ¶æä¾›ï¼š
â”œâ”€â”€ Web æœåŠ¡èƒ½åŠ›ï¼ˆFastAPIï¼‰
â”œâ”€â”€ å¹¶å‘å¤„ç†èƒ½åŠ›ï¼ˆUvicornï¼‰
â”œâ”€â”€ æ•°æ®æŒä¹…åŒ–èƒ½åŠ›ï¼ˆSQLAlchemyï¼‰
â”œâ”€â”€ é…ç½®ç®¡ç†èƒ½åŠ›ï¼ˆsettingsï¼‰
â””â”€â”€ ä¾èµ–æ³¨å…¥èƒ½åŠ›ï¼ˆFastAPI Dependsï¼‰
```

---

## æŠ€æœ¯äº®ç‚¹

### 1. SQLAlchemy 2.0 æ–°ç‰¹æ€§

```python
# future=True å¯ç”¨ SQLAlchemy 2.0
engine = create_engine(url, future=True)

# æ–°ç‰¹æ€§ï¼š
# 1. æ›´å¥½çš„ç±»å‹æç¤º
# 2. æ›´ç®€æ´çš„æŸ¥è¯¢è¯­æ³•
# 3. æ›´å¥½çš„å¼‚æ­¥æ”¯æŒ
# 4. æ›´æ˜ç¡®çš„é”™è¯¯æç¤º
```

### 2. ä¾èµ–æ³¨å…¥æ¨¡å¼

```python
# FastAPI çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿ
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

# è‡ªåŠ¨ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
# æ— éœ€æ‰‹åŠ¨å…³é—­è¿æ¥
```

### 3. é…ç½®ç®¡ç†å•ä¾‹æ¨¡å¼

```python
@lru_cache()
def get_settings() -> Settings:
    return Settings()

# å…¨å±€å”¯ä¸€é…ç½®å¯¹è±¡
# èŠ‚çœå†…å­˜ï¼Œä¿è¯ä¸€è‡´æ€§
```

### 4. æ¨¡å—åŒ–è·¯ç”±è®¾è®¡

```python
# æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡è·¯ç”±
app.include_router(projects.router, prefix="/api/v1/projects")
app.include_router(assets.router, prefix="/api/v1/assets")
app.include_router(analysis.router, prefix="/api/v1/analysis")

# ä¾¿äºç»´æŠ¤å’Œæ‰©å±•
```

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†é…ç½®

```bash
# .env æ–‡ä»¶
BDC_DATABASE_URL=postgresql://user:pass@localhost:5432/db
BDC_MINIO_ENDPOINT=localhost:9000
```

### 2. ä½¿ç”¨ä¾èµ–æ³¨å…¥è·å–æ•°æ®åº“ä¼šè¯

```python
# âœ“ æ¨è
def create_item(item: Item, db: Session = Depends(get_db)):
    db.add(item)
    db.commit()

# âœ— ä¸æ¨è
def create_item(item: Item):
    db = SessionLocal()
    db.add(item)
    db.commit()
    db.close()
```

### 3. ä½¿ç”¨å¼‚æ­¥å¤„ç† IO å¯†é›†å‹æ“ä½œ

```python
# âœ“ æ¨èï¼ˆå¼‚æ­¥ï¼‰
@router.get("/")
async def list_items(db: Session = Depends(get_db)):
    items = db.query(Item).all()
    return items

# âœ— ä¸æ¨èï¼ˆåŒæ­¥ï¼Œé˜»å¡ï¼‰
@router.get("/")
def list_items(db: Session = Depends(get_db)):
    items = db.query(Item).all()
    return items
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéœ€è¦ SQLAlchemyï¼Œä¸èƒ½ç›´æ¥å†™ SQLï¼Ÿ

**A**ï¼š
- âœ… SQLAlchemy æä¾›ç±»å‹å®‰å…¨
- âœ… è‡ªåŠ¨å¤„ç†è¿æ¥æ± 
- âœ… é˜²æ­¢ SQL æ³¨å…¥
- âœ… æ”¯æŒå¤šç§æ•°æ®åº“
- âœ… ä»£ç æ›´æ˜“ç»´æŠ¤

### Q2: Engine å’Œ Session çš„åŒºåˆ«ï¼Ÿ

**A**ï¼š
```
Engine = è¿æ¥æ± ç®¡ç†å™¨
â”œâ”€â”€ å¯åŠ¨æ—¶åˆ›å»º
â”œâ”€â”€ å…¨å±€å”¯ä¸€
â””â”€â”€ ç®¡ç†å¤šä¸ªè¿æ¥

Session = å•ä¸ªæ•°æ®åº“ä¼šè¯
â”œâ”€â”€ æ¯æ¬¡è¯·æ±‚åˆ›å»º
â”œâ”€â”€ ä»è¿æ¥æ± è·å–è¿æ¥
â””â”€â”€ ç”¨å®Œåå½’è¿˜
```

### Q3: ä»€ä¹ˆæ—¶å€™ç”¨ Dependsï¼Ÿ

**A**ï¼š
```
ä½¿ç”¨ Depends çš„åœºæ™¯ï¼š
âœ“ éœ€è¦æ•°æ®åº“ä¼šè¯
âœ“ éœ€è¦è®¤è¯ä¿¡æ¯
âœ“ éœ€è¦å…±äº«é€»è¾‘
âœ“ éœ€è¦è‡ªåŠ¨ç®¡ç†èµ„æº

ä¸éœ€è¦ Depends çš„åœºæ™¯ï¼š
âœ— ç®€å•çš„å‚æ•°éªŒè¯
âœ— ä¸éœ€è¦å…±äº«çš„é€»è¾‘
```

---

## æ€»ç»“

Backend éª¨æ¶æ˜¯æ•´ä¸ªé¡¹ç›®çš„**åŸºç¡€è®¾æ–½**ï¼Œæä¾›ï¼š

| èƒ½åŠ› | å®ç°æ–¹å¼ |
|------|----------|
| Web æœåŠ¡ | FastAPI + Uvicorn |
| æ•°æ®åº“è®¿é—® | SQLAlchemy + Session |
| é…ç½®ç®¡ç† | Settings + ç¯å¢ƒå˜é‡ |
| ä¾èµ–æ³¨å…¥ | FastAPI Depends |
| æ¨¡å—åŒ–è®¾è®¡ | Router ç³»ç»Ÿ |

**ç®€å•è¯´**ï¼šè¿™ä¸ªéª¨æ¶è®©"ä»€ä¹ˆéƒ½ä¸è¡Œ"çš„ç©ºé¡¹ç›®ï¼Œå˜æˆäº†"éšæ—¶å¯ä»¥å¼€å§‹åšåŠŸèƒ½"çš„å¹³å°ï¼

---

# å¤šæ¨¡æ€æ•°æ®å¤„ç†è¯¦è§£

## ğŸ“– æ¦‚è¿°

å¤šæ¨¡æ€æ•°æ®å¤„ç†æ˜¯ BDC-AI é¡¹ç›®çš„**æ ¸å¿ƒèƒ½åŠ›å±‚**ï¼Œå°±åƒ"çœ¼ç›"å’Œ"å¤§è„‘"ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿçœ‹æ‡‚å›¾ç‰‡ã€è¯»æ‡‚æ–‡æ¡£ã€ç†è§£å†…å®¹ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… å›¾ç‰‡æ–‡å­—è¯†åˆ«ï¼ˆOCRï¼‰ï¼šæå–è®¾å¤‡é“­ç‰Œã€ä»ªè¡¨è¯»æ•°ç­‰å…³é”®ä¿¡æ¯
- âœ… æ–‡æ¡£è§£æå¤„ç†ï¼šä» PDF ä¸­æå–è¡¨æ ¼ã€æ–‡æœ¬ã€å›¾ç‰‡
- âœ… ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼šå°†éç»“æ„åŒ–æ•°æ®è½¬ä¸ºå¯æŸ¥è¯¢çš„ç»“æ„åŒ–æ•°æ®
- âœ… å¤šç‰ˆæœ¬ç®¡ç†ï¼šä¿ç•™è§£æå†å²ï¼Œæ”¯æŒè¿½æº¯å’Œå¯¹æ¯”

**é€šä¿—ç†è§£**ï¼š
```
å¤šæ¨¡æ€æ•°æ®å¤„ç†å™¨ = è¶…çº§ç¿»è¯‘å®˜

è¾“å…¥ï¼šå„ç§"çœ‹ä¸æ‡‚"çš„ä¸œè¥¿
â”œâ”€â”€ å›¾ç‰‡ï¼ˆè®¾å¤‡é“­ç‰Œã€ç°åœºç…§ç‰‡ï¼‰
â”œâ”€â”€ PDF æ–‡æ¡£ï¼ˆè¯´æ˜ä¹¦ã€å›¾çº¸ï¼‰
â””â”€â”€ æ‰«æä»¶ï¼ˆåˆåŒã€æŠ¥è¡¨ï¼‰

è¾“å‡ºï¼šæœºå™¨èƒ½"è¯»æ‡‚"çš„æ•°æ®
â”œâ”€â”€ æ–‡å­—å†…å®¹ï¼ˆ"7032 kW"ã€"2013/07"ï¼‰
â”œâ”€â”€ ä½ç½®åæ ‡ï¼ˆæ–‡å­—åœ¨å“ªé‡Œï¼‰
â”œâ”€â”€ ç½®ä¿¡åº¦ï¼ˆè¯†åˆ«çš„å¯ä¿¡ç¨‹åº¦ï¼‰
â””â”€â”€ ç»“æ„åŒ– JSONï¼ˆå­˜æ•°æ®åº“ï¼‰
```

---

## æ ¸å¿ƒç»„æˆ

### é¡¹ç›®ç»“æ„

```
services/backend/
â””â”€â”€ app/
    â””â”€â”€ services/
        â””â”€â”€ image_pipeline.py      # å›¾ç‰‡ OCR å¤„ç†æµæ°´çº¿

shared/
â””â”€â”€ db/
    â””â”€â”€ models_asset.py            # Asset æ•°æ®æ¨¡å‹
```

### ç»„ä»¶èŒè´£

| ç»„ä»¶ | æ–‡ä»¶ | èŒè´£ | ç±»æ¯” |
|------|------|------|------|
| OCR æµæ°´çº¿ | image_pipeline.py | å›¾ç‰‡æ–‡å­—è¯†åˆ« | ç¿»è¯‘å®˜ |
| æ•°æ®æ¨¡å‹ | models_asset.py | å­˜å‚¨è¯†åˆ«ç»“æœ | æ¡£æ¡ˆæŸœ |
| API æ¥å£ | assets.py | æ¥æ”¶ä¸Šä¼ ã€è¿”å›ç»“æœ | æœåŠ¡çª—å£ |

---

## ä¾èµ–åº“è¯¦è§£

### requirements.txtï¼ˆæ–°å¢éƒ¨åˆ†ï¼‰

```txt
# OCR ä¸å›¾åƒå¤„ç†
paddleocr==2.7.0.3          # ç™¾åº¦ OCR å¼•æ“
paddlepaddle==2.6.2         # æ·±åº¦å­¦ä¹ æ¡†æ¶åç«¯
pymupdf==1.26.7             # PDF æ–‡æ¡£è§£æ
opencv-python<=4.6.0.66     # å›¾åƒå¤„ç†åº“
```

### 1. PaddleOCR - æ–‡å­—è¯†åˆ«å¼•æ“

**ä½œç”¨**ï¼šä»å›¾ç‰‡ä¸­æå–æ–‡å­—ä¿¡æ¯

**é€šä¿—ç†è§£**ï¼šå°±åƒ**äººç±»çš„çœ¼ç› + å¤§è„‘**

```
PaddleOCR çš„å·¥ä½œè¿‡ç¨‹ï¼š
â”œâ”€â”€ æ–‡å­—æ£€æµ‹ï¼šæ‰¾åˆ°æ–‡å­—åœ¨å“ªé‡Œï¼ˆåƒçœ¼ç›æ‰¾å­—ï¼‰
â”œâ”€â”€ æ–‡å­—åˆ†ç±»ï¼šåˆ¤æ–­æ–‡å­—æ–¹å‘ï¼ˆåƒæ­ªå¤´çœ‹ä¹¦ï¼‰
â”œâ”€â”€ æ–‡å­—è¯†åˆ«ï¼šè¯†åˆ«æ˜¯ä»€ä¹ˆå­—ï¼ˆåƒå¤§è„‘è®¤å­—ï¼‰
â””â”€â”€ ç»“æœè¾“å‡ºï¼šæ–‡å­— + åæ ‡ + ç½®ä¿¡åº¦
```

**ä¸ºä»€ä¹ˆé€‰æ‹© PaddleOCRï¼Ÿ**

| OCR æ–¹æ¡ˆ | ä¸­æ–‡ç²¾åº¦ | é€Ÿåº¦ | æˆæœ¬ | æ¨èåœºæ™¯ |
|---------|---------|------|------|----------|
| **PaddleOCR** | â­â­â­â­â­ | â­â­â­â­ | å…è´¹ | ä¸­è‹±æ··åˆã€å·¥ä¸šåœºæ™¯ |
| Tesseract | â­â­ | â­â­ | å…è´¹ | çº¯è‹±æ–‡ã€ç®€å•åœºæ™¯ |
| Azure OCR | â­â­â­â­â­ | â­â­â­ | æŒ‰æ¬¡ä»˜è´¹ | é«˜é¢„ç®—ã€ä½é¢‘ä½¿ç”¨ |
| Google Vision | â­â­â­â­â­ | â­â­â­ | æŒ‰æ¬¡ä»˜è´¹ | æµ·å¤–é¡¹ç›® |

**ä»£ç ç¤ºä¾‹**ï¼š

```python
from paddleocr import PaddleOCR

# åˆå§‹åŒ– OCRï¼ˆé¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼‰
ocr = PaddleOCR(
    use_angle_cls=True,    # å¯ç”¨æ–‡å­—æ–¹å‘åˆ†ç±»
    lang='ch'              # ä¸­æ–‡æ¨¡å‹ï¼ˆä¹Ÿæ”¯æŒè‹±æ–‡ï¼‰
)

# è¯†åˆ«å›¾ç‰‡
result = ocr.ocr('chiller_nameplate.jpg', cls=True)

# è¿”å›ç»“æœæ ¼å¼ï¼š
# [
#   [
#     [[x1, y1], [x2, y2], [x3, y3], [x4, y4]],  # æ–‡å­—æ¡†åæ ‡
#     ('å†·æ°´æœºç»„', 0.998)                            # (æ–‡å­—, ç½®ä¿¡åº¦)
#   ],
#   [
#     [[x1, y1], [x2, y2], [x3, y3], [x4, y4]],
#     ('7032', 0.996)
#   ],
#   # ... æ›´å¤šæ–‡å­—è¡Œ
# ]
```

**æ€§èƒ½æŒ‡æ ‡**ï¼ˆCPU æ¨¡å¼ï¼ŒIntel i7ï¼‰ï¼š
- æ–‡å­—æ£€æµ‹ï¼š~0.6 ç§’
- æ–‡å­—åˆ†ç±»ï¼š~0.25 ç§’
- æ–‡å­—è¯†åˆ«ï¼š~3.3 ç§’
- **æ€»è€—æ—¶**ï¼šçº¦ 4.2 ç§’/å¼ 

### 2. PaddlePaddle - æ·±åº¦å­¦ä¹ æ¡†æ¶

**ä½œç”¨**ï¼šPaddleOCR çš„"å‘åŠ¨æœº"

**é€šä¿—ç†è§£**ï¼šå°±åƒ**æ±½è½¦çš„å‘åŠ¨æœº**

```
PaddlePaddle æä¾›ï¼š
â”œâ”€â”€ æ¨¡å‹åŠ è½½ï¼šåŠ è½½è®­ç»ƒå¥½çš„ OCR æ¨¡å‹
â”œâ”€â”€ æ¨ç†å¼•æ“ï¼šè¿è¡Œç¥ç»ç½‘ç»œè®¡ç®—
â”œâ”€â”€ GPU åŠ é€Ÿï¼šæ”¯æŒæ˜¾å¡åŠ é€Ÿï¼ˆå¯é€‰ï¼‰
â””â”€â”€ å†…å­˜ç®¡ç†ï¼šä¼˜åŒ–è®¡ç®—èµ„æºä½¿ç”¨

ç±»æ¯”ï¼š
PaddleOCR = æ±½è½¦ï¼ˆç”¨æˆ·çœ‹åˆ°çš„éƒ¨åˆ†ï¼‰
PaddlePaddle = å‘åŠ¨æœºï¼ˆæ ¸å¿ƒåŠ¨åŠ›ï¼‰
æ²¡æœ‰å‘åŠ¨æœºï¼Œæ±½è½¦åŠ¨ä¸äº†
```

**ç‰ˆæœ¬å…¼å®¹æ€§**ï¼ˆé‡è¦ï¼ï¼‰ï¼š

```python
# âœ“ æ¨èç»„åˆï¼ˆç¨³å®šï¼‰
paddlepaddle==2.6.2
paddleocr==2.7.0.3

# âœ— é—®é¢˜ç»„åˆï¼ˆä¸å…¼å®¹ï¼‰
paddlepaddle==3.3.0
paddleocr==2.7.0.3
# ä¼šæŠ¥é”™ï¼šNotImplementedError: ConvertPirAttribute2RuntimeAttribute

# âœ— ä¸æ¨è
python 3.12 + ä»»æ„ç‰ˆæœ¬
# Python 3.12 å¯¹ PaddleOCR æ”¯æŒè¾ƒå·®
```

**ç‰ˆæœ¬å…¼å®¹çŸ©é˜µ**ï¼š

| Python | PaddlePaddle | PaddleOCR | çŠ¶æ€ |
|--------|--------------|-----------|------|
| 3.11 | 2.6.2 | 2.7.0.3 | âœ… æ¨èé…ç½® |
| 3.11 | 3.3.0 | 2.7.0.3 | âŒ ä¸å…¼å®¹ |
| 3.12 | ä»»æ„ | 2.7.0.3 | âŒ ä¸æ¨è |

### 3. PyMuPDF - PDF æ–‡æ¡£è§£æ

**ä½œç”¨**ï¼šä» PDF ä¸­æå–æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼

**é€šä¿—ç†è§£**ï¼šå°±åƒ**æ‹†ä¹¦å·¥å…·**

```
PyMuPDF çš„å·¥ä½œè¿‡ç¨‹ï¼š
â”œâ”€â”€ æ‰“å¼€ PDFï¼šåƒæ‰“å¼€ä¸€æœ¬ä¹¦
â”œâ”€â”€ é€é¡µå¤„ç†ï¼šä¸€é¡µä¸€é¡µç¿»
â”œâ”€â”€ æå–å†…å®¹ï¼š
â”‚   â”œâ”€â”€ æ–‡æœ¬ï¼šæå–æ–‡å­—å†…å®¹
â”‚   â”œâ”€â”€ å›¾ç‰‡ï¼šæå–åµŒå…¥çš„å›¾ç‰‡
â”‚   â”œâ”€â”€ è¡¨æ ¼ï¼šè¯†åˆ«è¡¨æ ¼ç»“æ„
â”‚   â””â”€â”€ å…ƒæ•°æ®ï¼šä½œè€…ã€æ ‡é¢˜ã€åˆ›å»ºæ—¶é—´
â””â”€â”€ ç»“æ„åŒ–è¾“å‡ºï¼šè½¬ä¸ºæœºå™¨å¯è¯»æ ¼å¼
```

**ä»£ç ç¤ºä¾‹**ï¼š

```python
import pymupdf  # PyMuPDF

# æ‰“å¼€ PDF æ–‡æ¡£
doc = pymupdf.open("chiller_manual.pdf")

# æå–æ–‡æœ¬
for page_num, page in enumerate(doc):
    text = page.get_text()
    print(f"ç¬¬ {page_num + 1} é¡µæ–‡æœ¬ï¼š\n{text}\n")

# æå–å›¾ç‰‡
for page_num, page in enumerate(doc):
    image_list = page.get_images()
    for img_index, img in enumerate(image_list):
        xref = img[0]
        base_image = doc.extract_image(xref)
        image_bytes = base_image["image"]
        with open(f"page{page_num}_img{img_index}.png", "wb") as f:
            f.write(image_bytes)

# è·å–æ–‡æ¡£å…ƒæ•°æ®
metadata = doc.metadata
print(f"ä½œè€…: {metadata['author']}")
print(f"æ ‡é¢˜: {metadata['title']}")
print(f"åˆ›å»ºæ—¶é—´: {metadata['creationDate']}")
```

---

## OCR å›¾ç‰‡è¯†åˆ«æµç¨‹

### å®Œæ•´å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡                              â”‚
â”‚              é€‰æ‹©è®¾å¤‡é“­ç‰Œç…§ç‰‡ â†’ ç‚¹å‡»ä¸Šä¼                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 1. æ–‡ä»¶ä¸Šä¼ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API: POST /api/v1/assets/upload                â”‚
â”‚  å·¥ä½œï¼šæ¥æ”¶æ–‡ä»¶ï¼Œä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œåˆ›å»º Asset è®°å½•              â”‚
â”‚  ç»“æœï¼šè¿”å› asset_id                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 2. è§¦å‘ OCR
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API: POST /api/v1/assets/{id}/parse_image         â”‚
â”‚  å·¥ä½œï¼šè¯»å–æ–‡ä»¶è·¯å¾„ï¼Œè°ƒç”¨ OCR æµæ°´çº¿                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 3. OCR å¤„ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PaddleOCR æ–‡å­—è¯†åˆ«ï¼ˆæ ¸å¿ƒæ­¥éª¤ï¼‰                   â”‚
â”‚  æ­¥éª¤ 1: æ–‡å­—æ£€æµ‹ï¼ˆ0.6ç§’ï¼‰                                    â”‚
â”‚      â†’ æ‰¾åˆ°æ‰€æœ‰æ–‡å­—æ¡†ä½ç½®                                     â”‚
â”‚  æ­¥éª¤ 2: æ–‡å­—åˆ†ç±»ï¼ˆ0.25ç§’ï¼‰                                   â”‚
â”‚      â†’ åˆ¤æ–­æ–‡å­—æ˜¯å¦éœ€è¦æ—‹è½¬                                   â”‚
â”‚  æ­¥éª¤ 3: æ–‡å­—è¯†åˆ«ï¼ˆ3.3ç§’ï¼‰                                    â”‚
â”‚      â†’ è¯†åˆ«æ¯ä¸ªæ–‡å­—æ¡†çš„å†…å®¹                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 4. ç»“æœå¤„ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ„é€ ç»“æ„åŒ– JSON æ•°æ®                             â”‚
â”‚  {                                                          â”‚
â”‚    "annotations": {                                         â”‚
â”‚      "ocr_lines": [                                         â”‚
â”‚        {"text": "å†·æ°´æœºç»„", "bbox": [...], "confidence": 0.998},â”‚
â”‚        {"text": "7032 kW", "bbox": [...], "confidence": 0.996} â”‚
â”‚      ]                                                      â”‚
â”‚    },                                                       â”‚
â”‚    "stats": {"avg_confidence": 0.967, "engine": "paddleocr"} â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 5. ä¿å­˜åˆ°æ•°æ®åº“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åˆ›å»º AssetStructuredPayload è®°å½•                      â”‚
â”‚  â€¢ schema_type: "image_annotation"                           â”‚
â”‚  â€¢ version: 1.0                                              â”‚
â”‚  â€¢ payload: <ä¸Šé¢æ„é€ çš„ JSON>                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 6. æ›´æ–°çŠ¶æ€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ›´æ–° Asset.status å­—æ®µ                          â”‚
â”‚  â€¢ å¦‚æœå¹³å‡ç½®ä¿¡åº¦ >= 0.8: "parsed_ocr_ok"                    â”‚
â”‚  â€¢ å¦‚æœå¹³å‡ç½®ä¿¡åº¦ < 0.8: "parsed_ocr_low_conf"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“ 7. è¿”å›ç»“æœ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è¿”å›ç»™ç”¨æˆ·                                â”‚
â”‚  {                                                          â”‚
â”‚    "id": "asset-uuid",                                      â”‚
â”‚    "status": "parsed_ocr_ok",                               â”‚
â”‚    "structured_payloads": [...]                            â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¶é—´çº¿

```
T0: ç”¨æˆ·é€‰æ‹©å›¾ç‰‡ï¼Œç‚¹å‡»ä¸Šä¼ 
T1: å‰ç«¯å‘é€ POST /api/v1/assets/upload
T2: åç«¯ä¿å­˜æ–‡ä»¶ï¼Œè¿”å› asset_id
T3: å‰ç«¯å‘é€ POST /api/v1/assets/{id}/parse_image
T4: åç«¯è°ƒç”¨ PaddleOCR.ocr()
T5: æ–‡å­—æ£€æµ‹å®Œæˆï¼ˆ0.6ç§’ï¼‰
T6: æ–‡å­—åˆ†ç±»å®Œæˆï¼ˆ0.25ç§’ï¼‰
T7: æ–‡å­—è¯†åˆ«å®Œæˆï¼ˆ3.3ç§’ï¼‰
T8: æ„é€  JSONï¼Œä¿å­˜åˆ°æ•°æ®åº“
T9: æ›´æ–° Asset çŠ¶æ€
T10: è¿”å›ç»“æœç»™å‰ç«¯

æ€»è€—æ—¶ï¼šçº¦ 4.2 ç§’ + ç½‘ç»œä¼ è¾“æ—¶é—´
```

---

## ä»£ç å±‚é¢è§£æ

### 1. image_pipeline.py - OCR æµæ°´çº¿

**ä½ç½®**ï¼š`services/backend/app/services/image_pipeline.py`

**æ ¸å¿ƒä»£ç **ï¼š

```python
from paddleocr import PaddleOCR
import logging

logger = logging.getLogger(__name__)

# å•ä¾‹æ¨¡å¼ï¼šå…¨å±€åªåˆ›å»ºä¸€ä¸ª OCR å®ä¾‹
# ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºåŠ è½½æ¨¡å‹å¾ˆæ…¢ï¼ˆçº¦2-3ç§’ï¼‰ï¼Œé‡å¤åˆ›å»ºæµªè´¹èµ„æº
_ocr_client = None

def _get_ocr_client():
    """
    è·å– OCR å®¢æˆ·ç«¯ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰

    å°±åƒå€Ÿä¹¦ï¼š
    â€¢ ç¬¬ä¸€æ¬¡æ¥ï¼šæ³¨å†ŒåŠå¡ï¼Œç»™ä½ ä¸€æœ¬ä¹¦ï¼ˆåˆ›å»ºå®ä¾‹ï¼‰
    â€¢ ä¹‹åæ¥ï¼šç›´æ¥å€Ÿä¹¦ï¼ˆè¿”å›ç¼“å­˜çš„å®ä¾‹ï¼‰

    å¥½å¤„ï¼š
    â€¢ çœæ—¶é—´ï¼šä¸ç”¨æ¯æ¬¡éƒ½åˆ›å»ºï¼ˆçº¦2-3ç§’ï¼‰
    â€¢ çœå†…å­˜ï¼šå…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹
    """
    global _ocr_client

    if _ocr_client is None:
        logger.info("åˆå§‹åŒ– PaddleOCR å®¢æˆ·ç«¯...")
        try:
            _ocr_client = PaddleOCR(
                use_angle_cls=True,    # å¯ç”¨æ–‡å­—æ–¹å‘åˆ†ç±»
                lang='ch',              # ä¸­æ–‡æ¨¡å‹
                show_log=False,         # å…³é—­è¯¦ç»†æ—¥å¿—
            )
            logger.info("PaddleOCR å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ")
        except Exception as e:
            logger.error(f"PaddleOCR åˆå§‹åŒ–å¤±è´¥: {e}")
            raise RuntimeError(
                "PaddleOCR is not installed. "
                "Please install 'paddleocr' and its dependencies."
            )

    return _ocr_client


def _run_paddle_ocr(image_path: str) -> List[Dict]:
    """
    è¿è¡Œ PaddleOCR è¯†åˆ«å›¾ç‰‡

    Args:
        image_path: å›¾ç‰‡æ–‡ä»¶è·¯å¾„

    Returns:
        List[OcrLine]: OCR è¯†åˆ«ç»“æœåˆ—è¡¨
        [
            {
                "text": "å†·æ°´æœºç»„",
                "bbox": [[x1,y1], [x2,y2], [x3,y3], [x4,y4]],
                "confidence": 0.998
            },
            ...
        ]
    """
    ocr = _get_ocr_client()

    # æ‰§è¡Œ OCR
    # cls=True: å¯ç”¨æ–‡å­—æ–¹å‘åˆ†ç±»
    result = ocr.ocr(image_path, cls=True)

    # PaddleOCR è¿”å›æ ¼å¼ï¼š
    # result[0] = ç¬¬ä¸€é¡µçš„è¯†åˆ«ç»“æœï¼ˆåˆ—è¡¨ï¼‰
    # æ¯ä¸ªå…ƒç´ æ˜¯ [bbox, (text, confidence)]
    if not result or not result[0]:
        return []

    ocr_lines = []
    for line in result[0]:
        bbox, (text, confidence) = line

        ocr_lines.append({
            "text": text,
            "bbox": bbox,  # å››ä¸ªåæ ‡ç‚¹ï¼šå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹
            "confidence": float(confidence)
        })

    return ocr_lines


def process_image_with_ocr(db: Session, asset_id: UUID) -> AssetStructuredPayload:
    """
    å¤„ç†å›¾ç‰‡ OCR çš„å®Œæ•´æµç¨‹

    å°±åƒå·¥å‚æµæ°´çº¿ï¼š
    1. å–åŸæ–™ï¼ˆè¯»å– Asset è®°å½•ï¼‰
    2. åŠ å·¥ï¼ˆè°ƒç”¨ OCR è¯†åˆ«ï¼‰
    3. è´¨æ£€ï¼ˆè®¡ç®—å¹³å‡ç½®ä¿¡åº¦ï¼‰
    4. æ‰“åŒ…ï¼ˆæ„é€  JSONï¼‰
    5. å…¥åº“ï¼ˆä¿å­˜åˆ°æ•°æ®åº“ï¼‰
    6. è´´æ ‡ç­¾ï¼ˆæ›´æ–° Asset çŠ¶æ€ï¼‰
    """
    # æ­¥éª¤ 1: æŸ¥è¯¢ Asset è®°å½•
    asset = db.query(Asset).filter(Asset.id == asset_id).one()
    file_blob = db.query(FileBlob).filter(FileBlob.id == asset.file_id).one()

    # æ­¥éª¤ 2: è·å–å›¾ç‰‡ç»å¯¹è·¯å¾„
    # file_blob.path æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦æ‹¼æ¥å®Œæ•´è·¯å¾„
    from shared.config.settings import get_settings
    settings = get_settings()
    abs_path = str(settings.local_storage_dir / file_blob.path)

    logger.info(f"å¼€å§‹ OCR å¤„ç†: {abs_path}")

    # æ­¥éª¤ 3: æ‰§è¡Œ OCR è¯†åˆ«
    ocr_lines = _run_paddle_ocr(abs_path)

    # æ­¥éª¤ 4: è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    if ocr_lines:
        total_conf = sum(line['confidence'] for line in ocr_lines)
        avg_conf = total_conf / len(ocr_lines)
    else:
        avg_conf = 0.0

    logger.info(f"OCR è¯†åˆ«å®Œæˆ: {len(ocr_lines)} è¡Œ, å¹³å‡ç½®ä¿¡åº¦: {avg_conf:.3f}")

    # æ­¥éª¤ 5: æ„é€ ç»“æ„åŒ–æ•°æ®
    payload_data = {
        "image_meta": {
            "path": file_blob.path,
            "file_name": file_blob.file_name
        },
        "annotations": {
            "ocr_lines": ocr_lines,
            "global_tags": []  # é¢„ç•™ï¼šæœªæ¥å¯ä»¥æ·»åŠ å…¨å±€æ ‡ç­¾
        },
        "derived_text": "\n".join(line['text'] for line in ocr_lines),
        "stats": {
            "avg_confidence": avg_conf,
            "engine": "paddleocr"
        }
    }

    # æ­¥éª¤ 6: åˆ›å»º AssetStructuredPayload è®°å½•
    structured = AssetStructuredPayload(
        asset_id=asset_id,
        schema_type="image_annotation",  # Schema ç±»å‹ï¼šå›¾ç‰‡æ ‡æ³¨
        version=1.0,                      # ç‰ˆæœ¬å·
        payload=payload_data,
        created_by="paddleocr"
    )
    db.add(structured)

    # æ­¥éª¤ 7: æ›´æ–° Asset çŠ¶æ€
    if avg_conf >= 0.8:
        asset.status = "parsed_ocr_ok"
    else:
        asset.status = "parsed_ocr_low_conf"

    # æ­¥éª¤ 8: æäº¤äº‹åŠ¡
    db.commit()
    db.refresh(structured)

    logger.info(f"OCR ç»“æœå·²ä¿å­˜: {structured.id}")

    return structured
```

**å…³é”®è®¾è®¡ç‚¹**ï¼š

```python
# 1. å•ä¾‹æ¨¡å¼ï¼ˆ_ocr_clientï¼‰
#    å¥½å¤„ï¼šé¿å…é‡å¤åŠ è½½æ¨¡å‹ï¼ˆèŠ‚çœ 2-3 ç§’åˆå§‹åŒ–æ—¶é—´ï¼‰

# 2. ç»“æ„åŒ–æ•°æ®è®¾è®¡
payload_data = {
    "image_meta": {...},      # åŸå§‹å›¾ç‰‡ä¿¡æ¯
    "annotations": {...},     # OCR è¯†åˆ«ç»“æœ
    "derived_text": "...",    # æ‹¼æ¥çš„çº¯æ–‡æœ¬ï¼ˆæ–¹ä¾¿æœç´¢ï¼‰
    "stats": {...}            # ç»Ÿè®¡ä¿¡æ¯
}

# 3. å¤šç‰ˆæœ¬ç®¡ç†
#    æ¯æ¬¡è§£æåˆ›å»ºæ–°çš„ AssetStructuredPayload è®°å½•
#    ä¿ç•™æ‰€æœ‰å†å²ç‰ˆæœ¬ï¼Œé€šè¿‡ created_at æ’åºè·å–æœ€æ–°ç‰ˆ

# 4. çŠ¶æ€ç®¡ç†
#    æ ¹æ® avg_confidence å†³å®šçŠ¶æ€ï¼š
#    â€¢ >= 0.8: parsed_ocr_okï¼ˆè´¨é‡å¥½ï¼‰
#    â€¢ < 0.8: parsed_ocr_low_confï¼ˆè´¨é‡å·®ï¼Œéœ€äººå·¥å¤æ ¸ï¼‰
```

### 2. assets.py - API æ¥å£

**ä½ç½®**ï¼š`services/backend/app/api/v1/assets.py`

**æ ¸å¿ƒä»£ç **ï¼š

```python
from fastapi import APIRouter, Depends, UploadFile, File
from sqlalchemy.orm import Session
from shared.db.session import get_db
from app.services.image_pipeline import process_image_with_ocr

router = APIRouter()


@router.post("/upload")
async def upload_asset(
    project_id: str,           # ä» URL å‚æ•°è·å–
    modality: str,             # æ¨¡æ€ç±»å‹ï¼šimage / document / table
    source: str,               # æ¥æºï¼šmobile / web / api
    file: UploadFile = File(...),  # ä¸Šä¼ çš„æ–‡ä»¶
    db: Session = Depends(get_db)
):
    """
    ä¸Šä¼  Asset æ–‡ä»¶

    æµç¨‹ï¼š
    1. éªŒè¯é¡¹ç›®æ˜¯å¦å­˜åœ¨
    2. ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°å­˜å‚¨
    3. åˆ›å»º FileBlob è®°å½•
    4. åˆ›å»º Asset è®°å½•
    5. è¿”å› Asset ä¿¡æ¯
    """
    # æ­¥éª¤ 1: æŸ¥è¯¢é¡¹ç›®
    project = db.query(Project).filter(
        Project.id == uuid.UUID(project_id)
    ).first()
    if not project:
        raise HTTPException(status_code=404, detail="é¡¹ç›®ä¸å­˜åœ¨")

    # æ­¥éª¤ 2: ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆUUID + åŸæ‰©å±•åï¼‰
    ext = Path(file.filename).suffix
    unique_filename = f"{uuid.uuid4()}{ext}"

    # æ­¥éª¤ 3: æ„é€ å­˜å‚¨è·¯å¾„
    # è·¯å¾„æ ¼å¼ï¼šdata/assets/{project_id}/{uuid}.jpg
    settings = get_settings()
    rel_path = f"{project_id}/{unique_filename}"
    full_path = settings.local_storage_dir / rel_path

    # ç¡®ä¿ç›®å½•å­˜åœ¨
    full_path.parent.mkdir(parents=True, exist_ok=True)

    # æ­¥éª¤ 4: ä¿å­˜æ–‡ä»¶
    with open(full_path, "wb") as f:
        content = await file.read()  # å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹
        f.write(content)

    logger.info(f"æ–‡ä»¶å·²ä¿å­˜: {full_path}")

    # æ­¥éª¤ 5: åˆ›å»º FileBlob è®°å½•
    file_blob = FileBlob(
        storage_type="local",
        bucket="assets",
        path=rel_path,
        file_name=file.filename,
        content_type=file.content_type,
        size=len(content)
    )
    db.add(file_blob)
    db.flush()  # è·å– file_blob.id

    # æ­¥éª¤ 6: åˆ›å»º Asset è®°å½•
    asset = Asset(
        project_id=project.id,
        file_id=file_blob.id,
        modality=modality,
        source=source,
        status="uploaded"  # åˆå§‹çŠ¶æ€ï¼šå·²ä¸Šä¼ 
    )
    db.add(asset)
    db.commit()
    db.refresh(asset)

    return asset


@router.post("/{asset_id}/parse_image")
async def parse_image_asset(
    asset_id: UUID,  # FastAPI è‡ªåŠ¨è½¬æ¢å­—ç¬¦ä¸²ä¸º UUID
    db: Session = Depends(get_db)
):
    """
    è§¦å‘å›¾ç‰‡ OCR è§£æ

    æµç¨‹ï¼š
    1. æŸ¥è¯¢ Asset è®°å½•
    2. è°ƒç”¨ OCR æµæ°´çº¿
    3. è¿”å›è§£æåçš„ Asset
    """
    # æŸ¥è¯¢ Asset
    asset = db.query(Asset).filter(Asset.id == asset_id).first()
    if not asset:
        raise HTTPException(status_code=404, detail="Asset ä¸å­˜åœ¨")

    # æ£€æŸ¥æ¨¡æ€ç±»å‹
    if asset.modality != "image":
        raise HTTPException(
            status_code=400,
            detail=f"ä¸æ”¯æŒçš„æ¨¡æ€ç±»å‹: {asset.modality}"
        )

    # è°ƒç”¨ OCR å¤„ç†
    structured: AssetStructuredPayload = process_image_with_ocr(db, asset_id)

    # åˆ·æ–° Asset è·å–æœ€æ–°çŠ¶æ€
    db.refresh(asset)

    return asset
```

**å·¥ä½œæµç¨‹**ï¼š

```
ä¸Šä¼ å›¾ç‰‡æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /assets/upload     â”‚
â”‚ â€¢ project_id: uuid      â”‚
â”‚ â€¢ modality: "image"     â”‚
â”‚ â€¢ source: "mobile"      â”‚
â”‚ â€¢ file: <binary>        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨ä¿å­˜æ–‡ä»¶          â”‚
â”‚ â€¢ ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å        â”‚
â”‚ â€¢ ä¿å­˜åˆ° data/assets/   â”‚
â”‚ â€¢ åˆ›å»º FileBlob è®°å½•    â”‚
â”‚ â€¢ åˆ›å»º Asset è®°å½•       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å› Asset ä¿¡æ¯         â”‚
â”‚ {                       â”‚
â”‚   "id": "asset-uuid",   â”‚
â”‚   "status": "uploaded"  â”‚
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OCR è§£ææµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»"è¯†åˆ«"â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /assets/{id}/parse    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯»å– Asset              â”‚
â”‚ 2. è·å–æ–‡ä»¶è·¯å¾„            â”‚
â”‚ 3. è°ƒç”¨ PaddleOCR          â”‚
â”‚ 4. æ„é€  JSON               â”‚
â”‚ 5. ä¿å­˜åˆ°æ•°æ®åº“            â”‚
â”‚ 6. æ›´æ–°çŠ¶æ€                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç»“æœ                   â”‚
â”‚ {                          â”‚
â”‚   "status": "parsed_ocr_ok"â”‚
â”‚   "structured_payloads": []â”‚
â”‚ }                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šè¯†åˆ«å†·æ°´æœºç»„é“­ç‰Œ

**ç›®æ ‡**ï¼šä»è®¾å¤‡é“­ç‰Œå›¾ç‰‡ä¸­æå–å…³é”®å‚æ•°

**è¾“å…¥**ï¼šè®¾å¤‡é“­ç‰Œç…§ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YORK                          â”‚
â”‚  å†·æ°´æœºç»„                      â”‚
â”‚  å‹å·: YKR2R2K45DGG/EE22      â”‚
â”‚  é¢å®šåˆ¶å†·é‡: 7032 kW           â”‚
â”‚  åˆ¶å†·å‰‚: R-134a                â”‚
â”‚  åˆ¶é€ æ—¥æœŸ: 2013/07             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**OCR è¯†åˆ«ç»“æœ**ï¼š

```json
{
  "annotations": {
    "ocr_lines": [
      {"text": "YORK", "confidence": 0.984},
      {"text": "å†·æ°´æœºç»„", "confidence": 0.998},
      {"text": "å‹å·: YKR2R2K45DGG/EE22", "confidence": 0.992},
      {"text": "é¢å®šåˆ¶å†·é‡: 7032 kW", "confidence": 0.996},
      {"text": "åˆ¶å†·å‰‚: R-134a", "confidence": 0.991},
      {"text": "åˆ¶é€ æ—¥æœŸ: 2013/07", "confidence": 0.993}
    ]
  },
  "stats": {
    "avg_confidence": 0.992,
    "engine": "paddleocr"
  }
}
```

**åç»­å¤„ç†**ï¼š

```python
# ç¬¬äºŒå±‚è§£æï¼ˆæœªæ¥å®ç°ï¼‰ï¼šä» OCR æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–æ•°æ®

def extract_chiller_info(ocr_result: dict) -> dict:
    """
    ä» OCR ç»“æœä¸­æå–å†·æ°´æœºç»„å‚æ•°
    """
    ocr_text = ocr_result["derived_text"]

    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ– Claude API æå–å…³é”®ä¿¡æ¯
    info = {
        "brand": "YORK",
        "model": "YKR2R2K45DGG/EE22",
        "cooling_capacity_kw": 7032,
        "refrigerant": "R-134a",
        "manufacture_date": "2013-07"
    }

    return info
```

### åœºæ™¯ 2ï¼šæ‰¹é‡å¤„ç†ç°åœºç…§ç‰‡

**ç›®æ ‡**ï¼šæ‰¹é‡ä¸Šä¼ å¹¶è‡ªåŠ¨è¯†åˆ«å¤šå¼ ç°åœºç…§ç‰‡

**å®ç°**ï¼š

```python
# å‰ç«¯ä»£ç ï¼ˆä¼ªä»£ç ï¼‰
async function batchUpload(projectId, images) {
    const results = [];

    for (const image of images) {
        // 1. ä¸Šä¼ å›¾ç‰‡
        const asset = await uploadAsset(projectId, image);
        const assetId = asset.id;

        // 2. è§¦å‘ OCR
        const parsed = await parseImage(assetId);

        results.push({
            fileName: image.name,
            assetId: assetId,
            status: parsed.status,
            ocrLines: parsed.structured_payloads[0].payload.annotations.ocr_lines
        });
    }

    return results;
}

// ä½¿ç”¨ç¤ºä¾‹
const images = [
    'chiller_01.jpg',
    'chiller_02.jpg',
    'pump_room.jpg'
];

const results = await batchUpload(projectId, images);

console.log(`æˆåŠŸå¤„ç† ${results.length} å¼ å›¾ç‰‡`);
results.forEach(r => {
    console.log(`${r.fileName}: è¯†åˆ« ${r.ocrLines.length} è¡Œæ–‡æœ¬`);
});
```

### åœºæ™¯ 3ï¼šè´¨é‡æ£€æŸ¥ä¸äººå·¥å¤æ ¸

**ç›®æ ‡**ï¼šç­›é€‰ä½è´¨é‡è¯†åˆ«ç»“æœï¼Œæç¤ºäººå·¥å¤æ ¸

**å®ç°**ï¼š

```python
@router.get("/assets/low-confidence")
def list_low_confidence_assets(db: Session = Depends(get_db)):
    """
    æŸ¥è¯¢æ‰€æœ‰ä½ç½®ä¿¡åº¦çš„ Assetï¼ˆéœ€è¦äººå·¥å¤æ ¸ï¼‰

    åˆ¤æ–­æ ‡å‡†ï¼š
    1. status = "parsed_ocr_low_conf"
    2. avg_confidence < 0.8
    """
    # æŸ¥è¯¢æ‰€æœ‰ç»“æ„åŒ–æ•°æ®
    payloads = db.query(AssetStructuredPayload).all()

    low_conf_items = []
    for payload in payloads:
        stats = payload.payload.get("stats", {})
        avg_conf = stats.get("avg_confidence", 1.0)

        if avg_conf < 0.8:
            low_conf_items.append({
                "asset_id": payload.asset_id,
                "avg_confidence": avg_conf,
                "ocr_lines": len(payload.payload["annotations"]["ocr_lines"])
            })

    return low_conf_items
```

---

## å¸¸è§é—®é¢˜ä¸è§£å†³

### âŒ é—®é¢˜ 1ï¼šnumpy ABI ç‰ˆæœ¬ä¸å…¼å®¹

**é”™è¯¯ä¿¡æ¯**ï¼š
```
RuntimeError: module compiled against ABI version 0x1000009
but this version of numpy is 0x2000000
```

**åŸå› **ï¼š
- PaddleOCR ä¾èµ–çš„ä¸€äº›æ‰©å±•åŒ…æ˜¯ç”¨ numpy 1.x ç¼–è¯‘çš„
- numpy 2.0 æ”¹å˜äº† ABIï¼ˆäºŒè¿›åˆ¶æ¥å£ï¼‰
- å¯¼è‡´åŠ è½½æ‰©å±•æ—¶æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é™çº§ numpy åˆ° 1.x ç‰ˆæœ¬
pip install "numpy<2.0"

# éªŒè¯
python -c "import numpy; print(numpy.__version__)"
# åº”è¯¥è¾“å‡ºï¼š1.26.4 æˆ–ç±»ä¼¼ç‰ˆæœ¬
```

### âŒ é—®é¢˜ 2ï¼šPaddlePaddle ç‰ˆæœ¬ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯**ï¼š
```
NotImplementedError: ConvertPirAttribute2RuntimeAttribute not support
```

**åŸå› **ï¼š
- PaddlePaddle 3.3.0 å¤ªæ–°ï¼Œä¸ PaddleOCR 2.7.0.3 ä¸å…¼å®¹
- PaddleOCR 2.7.0.3 æ˜¯åŸºäº PaddlePaddle 2.6.x å¼€å‘çš„

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¸è½½ç°æœ‰ç‰ˆæœ¬
pip uninstall paddlepaddle paddlepaddle-gpu

# å®‰è£…å…¼å®¹ç‰ˆæœ¬
pip install paddlepaddle==2.6.2

# éªŒè¯
python -c "import paddle; print(paddle.__version__)"
# åº”è¯¥è¾“å‡ºï¼š2.6.2
```

### âŒ é—®é¢˜ 3ï¼šPyMuPDF ç¼–è¯‘å¤±è´¥ï¼ˆWindowsï¼‰

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FileNotFoundError: mupdf-1.20.3-source/...
```

**åŸå› **ï¼š
- Windows è·¯å¾„é•¿åº¦é™åˆ¶ï¼ˆMAX_PATH = 260 å­—ç¬¦ï¼‰
- ç¼ºå°‘ Visual Studio ç¼–è¯‘å™¨
- æ—§ç‰ˆæœ¬ PyMuPDF éœ€è¦ç¼–è¯‘

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨æ–°ç‰ˆæœ¬çš„é¢„ç¼–è¯‘ wheel
pip install pymupdf==1.26.7

# å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œæ‰‹åŠ¨ä¸‹è½½ wheel
# https://pypi.org/project/PyMuPDF/#files
# é€‰æ‹©ï¼špymupdf-1.26.7-cp311-cp311-win_amd64.whl
pip install /path/to/pymupdf-1.26.7-cp311-cp311-win_amd64.whl
```

### âŒ é—®é¢˜ 4ï¼šé¦–æ¬¡è¿è¡Œå¾ˆæ…¢

**ç°è±¡**ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨ OCR æ—¶å¡ä½ 2-3 åˆ†é’Ÿ

**åŸå› **ï¼šPaddleOCR é¦–æ¬¡è¿è¡Œéœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶

```
ä¸‹è½½å†…å®¹ï¼š
â”œâ”€â”€ æ£€æµ‹æ¨¡å‹ï¼šch_PP-OCRv4_det_infer.tar (~4.9 MB)
â”œâ”€â”€ è¯†åˆ«æ¨¡å‹ï¼šch_PP-OCRv4_rec_infer.tar (~11 MB)
â””â”€â”€ åˆ†ç±»æ¨¡å‹ï¼šch_ppocr_mobile_v2.0_cls_infer.tar (~2.2 MB)

ä¸‹è½½ä½ç½®ï¼š
C:\Users\<ç”¨æˆ·å>\.paddleocr\whl\
```

**è§£å†³**ï¼š
- âœ… è€å¿ƒç­‰å¾…ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
- âœ… åç»­è¿è¡Œä¼šä½¿ç”¨ç¼“å­˜ï¼Œé€Ÿåº¦å¿«
- âœ… å¯ä»¥æå‰ä¸‹è½½æ¨¡å‹åˆ°ç¦»çº¿ç¯å¢ƒ

### âŒ é—®é¢˜ 5ï¼šè¯†åˆ«è´¨é‡å·®

**ç°è±¡**ï¼šè¯†åˆ«ç»“æœä¸å‡†ç¡®ï¼Œç½®ä¿¡åº¦ä½

**å¯èƒ½åŸå› **ï¼š
1. å›¾ç‰‡æ¨¡ç³Š
2. å…‰çº¿å¤ªæš—æˆ–å¤ªäº®
3. æ–‡å­—å¤ªå°
4. æ‹æ‘„è§’åº¦å€¾æ–œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# å›¾åƒé¢„å¤„ç†ï¼ˆå¯ä»¥æ·»åŠ åˆ° image_pipeline.pyï¼‰

import cv2
import numpy as np

def preprocess_image(image_path: str) -> str:
    """
    å›¾åƒé¢„å¤„ç†ï¼šæé«˜ OCR è¯†åˆ«ç‡

    æ­¥éª¤ï¼š
    1. è¯»å–å›¾ç‰‡
    2. è°ƒæ•´å¯¹æ¯”åº¦
    3. å»å™ª
    4. ä¿å­˜å¤„ç†åçš„å›¾ç‰‡
    """
    img = cv2.imread(image_path)

    # 1. è½¬ç°åº¦å›¾
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    # 2. è‡ªé€‚åº”é˜ˆå€¼ï¼ˆå¢å¼ºæ–‡å­—å¯¹æ¯”åº¦ï¼‰
    binary = cv2.adaptiveThreshold(
        gray, 255,
        cv2.ADAPTIVE_THRESH_GAUSSIAN_C,
        cv2.THRESH_BINARY,
        11, 2
    )

    # 3. å»å™ª
    denoised = cv2.fastNlMeansDenoising(binary)

    # 4. ä¿å­˜
    processed_path = image_path.replace(".jpg", "_processed.jpg")
    cv2.imwrite(processed_path, denoised)

    return processed_path

# ä½¿ç”¨
processed_path = preprocess_image(abs_path)
ocr_lines = _run_paddle_ocr(processed_path)
```

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å¼‚æ­¥å¤„ç†ï¼ˆæ¨èï¼‰

```python
# âœ— åŒæ­¥å¤„ç†ï¼ˆé˜»å¡ APIï¼‰
@router.post("/{asset_id}/parse_image")
def parse_image_asset(asset_id: UUID, db: Session = Depends(get_db)):
    structured = process_image_with_ocr(db, asset_id)  # é˜»å¡ 4 ç§’
    return structured

# âœ“ å¼‚æ­¥å¤„ç†ï¼ˆä¸é˜»å¡ï¼‰
from fastapi import BackgroundTasks

@router.post("/{asset_id}/parse_image")
async def parse_image_asset(
    asset_id: UUID,
    background_tasks: BackgroundTasks,
    db: Session = Depends(get_db)
):
    # ç«‹å³è¿”å›ï¼Œåå°å¤„ç†
    background_tasks.add_task(process_image_with_ocr, db, asset_id)

    return {
        "message": "OCR å¤„ç†å·²å¼€å§‹",
        "asset_id": asset_id,
        "status": "processing"
    }
```

### 2. ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†

```python
# âœ“ æ¨èï¼šä¿ç•™æ‰€æœ‰ç‰ˆæœ¬
def parse_image_v2(db: Session, asset_id: UUID):
    # åˆ›å»ºæ–°ç‰ˆæœ¬ï¼ˆä¸åˆ é™¤æ—§ç‰ˆæœ¬ï¼‰
    structured_v2 = AssetStructuredPayload(
        asset_id=asset_id,
        schema_type="image_annotation",
        version=2.0,  # æ–°ç‰ˆæœ¬å·
        payload=new_result
    )
    db.add(structured_v2)

# âœ— ä¸æ¨èï¼šè¦†ç›–æ—§ç‰ˆæœ¬
def parse_image_bad(db: Session, asset_id: UUID):
    old = db.query(AssetStructuredPayload).filter(
        AssetStructuredPayload.asset_id == asset_id
    ).first()
    old.payload = new_result  # ä¸¢å¤±å†å²æ•°æ®
```

### 3. æ·»åŠ é”™è¯¯å¤„ç†

```python
# âœ“ æ¨èï¼šå®Œå–„çš„é”™è¯¯å¤„ç†
@router.post("/{asset_id}/parse_image")
async def parse_image_asset(asset_id: UUID, db: Session = Depends(get_db)):
    try:
        structured = process_image_with_ocr(db, asset_id)
        return structured
    except FileNotFoundError as e:
        raise HTTPException(status_code=404, detail="å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨")
    except RuntimeError as e:
        raise HTTPException(status_code=500, detail="OCR æœåŠ¡å¼‚å¸¸")
    except Exception as e:
        logger.exception(f"OCR å¤„ç†å¤±è´¥: {e}")
        raise HTTPException(status_code=500, detail="å†…éƒ¨é”™è¯¯")
```

---

## æ€»ç»“

å¤šæ¨¡æ€æ•°æ®å¤„ç†æ¨¡å—æä¾›ï¼š

| èƒ½åŠ› | å®ç°æ–¹å¼ | æ€§èƒ½ |
|------|----------|------|
| å›¾ç‰‡æ–‡å­—è¯†åˆ« | PaddleOCR 2.7.0.3 | 4.2 ç§’/å¼  |
| PDF æ–‡æ¡£è§£æ | PyMuPDF 1.26.7 | å–å†³äºæ–‡æ¡£å¤§å° |
| ç»“æ„åŒ–å­˜å‚¨ | SQLAlchemy + JSON | è‡ªåŠ¨ |
| ç‰ˆæœ¬ç®¡ç† | AssetStructuredPayload | è‡ªåŠ¨ |
| è´¨é‡è¯„ä¼° | ç½®ä¿¡åº¦è®¡ç®— | è‡ªåŠ¨ |

**ç®€å•è¯´**ï¼šè¿™ä¸ªæ¨¡å—è®©"çœ‹ä¸æ‡‚å›¾ç‰‡"çš„è®¡ç®—æœºï¼Œå˜æˆäº†"èƒ½è¯»æ‡‚æ–‡å­—"çš„æ™ºèƒ½åŠ©æ‰‹ï¼

---

## ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®è§„åˆ’æ–‡æ¡£](../PLAN.md)
- [å¼€æºæŠ€æœ¯æ ˆæ¨è](../OPEN_SOURCE_RECOMMENDATIONS.md)
- [README ä¸»æ–‡æ¡£](../README.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-01-18
**ç»´æŠ¤è€…**: BDC-AI å¼€å‘å›¢é˜Ÿ
